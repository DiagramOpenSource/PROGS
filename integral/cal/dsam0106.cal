|FICHEROS;
     dsam0106 #106;
     dsam0107 #107;
     dsam0000 #0;

     espejo1@ #900;
|FIN;

|VARIABLES;
     aTelefono = "";
     aDef      = "";
     aBase     = "";
     aAlfa     = "";
     nSwHay    = 0;
|FIN;

|PROCESO RecogeCliente; |TIPO 0;
     |ABRE #0;
     |SELECT #2#0;
     #0#1 = #106#0;
     |LEE 040#0=;
     |SI FSalida = 0;
         #106#0  = #0#1;    |PINTA #106#0;
         #106#1  = #0#27;   |PINTA #106#1;
         #106#2  = #0#28;   |PINTA #106#2;
     |FINSI;
     |CIERRA #0;
|FPRC;

|PROCESO Borralos;
     |BORRA 020#107a;
     |LIBERA #107;
|FPRC;

|DEFBUCLE dsam0107_1;
     #107#1;
     ;
     #0#1, 00;
     #0#1, 99;
     be;
     NULL, Borralos;
|FIN;

|PROCESO Grabalos;
     |BORRA 020#107a;
     |LIBERA #107;

     #107#0 = #0#1;
     |GRABA 020#107n;
     |LIBERA #107;
|FPRC;

|DEFBUCLE dsam0107_2;
     #107#1;
     ;
     #106#0, 00;
     #106#0, 99;
     be;
     NULL, Grabalos;
|FIN;

|PROCESO PasaAEste;
     nSwHay    = 1;
     #900#0 = #106#0;
     |LEE 101#900=;
     |SI FSalida = 0;
         |BORRA 020#900a;
         |LIBERA #900;
     |FINSI;

     #900#0 = #0#1;
     |LEE 101#900=;
     |SI FSalida ! 0;
         #900#0  = #0#1;
         #900#1  = #0#27;
         #900#2  = #0#28;
         |GRABA 020#900n;
         |LIBERA #900;
     |FINSI;

     |BUCLE dsam0107_1;
     |BUCLE dsam0107_2;
|FPRC;

|DEFBUCLE dsam0000;
     #0#1;
     54;
     00001, aTelefono;
     99999, aTelefono;
     ;
     NULL, PasaAEste;
|FIN;

|PROCESO Chequealos;
     |ABRE #0;
     |SELECT #2#0;
     #0#1 = #106#0;
     |LEE 040#0=;
     |SI FSalida = 0;
         #106#0  = #0#1;
         #106#1  = #0#27;
         #106#2  = #0#28;
         |GRABA 020#106a;
         |LIBERA #106;
         |CIERRA #0;

         |ABRE #107;
         #107#0 = #106#0;
         #107#1 = 1;
         |LEE 101#107=;
         |SI FSalida ! 0;
             #107#0 = #106#0;
             #107#1 = 1;
             #107#2 = "TELEFONO PRINCIPAL";
             #107#4 = #0#54;
             |GRABA 020#107n;
             |LIBERA #107;
         |FINSI;

         #107#0 = #106#0;
         #107#1 = 2;
         |LEE 101#107=;
         |SI FSalida ! 0;
             #107#0 = #106#0;
             #107#1 = 2;
             #107#2 = "TELEFONO DE CONTACTO";
             #107#4 = #0#55;
             |GRABA 020#107n;
             |LIBERA #107;
         |FINSI;

         |CIERRA #107;

         |ACABA;
     |FINSI;
     |CIERRA #0;

     |ABRE #107;
     #107#0 = #106#0;
     #107#1 = 1;
     |LEE 040#107=;
     |SI FSalida = 0;
         |CIERRA #107;
         |SI #107#4 ! "                    ";
             aTelefono = #107#4;
             nSwHay    = 0;
             |BUCLE dsam0000;
             |SI nSwHay = 0;
                 |QBT aTelefono;
                 aTelefono = (aTelefono + "                    ") % 120;
                 |BUCLE dsam0000;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #107;
|FPRC;

|DEFBUCLE dsam0106_1;
     #106#1;
     ;
     "                                        ";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, Chequealos;
|FIN;

|PROCESO BorraVacios;
     #107#0 = #106#0;
     #107#1 = 99;
     |LEE 101#107];
     |SI FSalida = 0;
         |LEE 040#107a;
     |SINO;
         |LEE 040#107u;
     |FINSI;

     |SI #107#0 ! #106#0;
         |BORRA 020#106a;
     |FINSI;
     |LIBERA #106;
|FPRC;

|DEFBUCLE dsam0106_2;
     #106#1;
     ;
     "                                        ";
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, BorraVacios;
|FIN;

|PROCESO MiraCliente;
     |ACABA;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     |DBASE aBase;   |QBT aBase;
     aBase = aBase + "def/";
     aDef  = aBase + "dsam0106.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def dsam0106";
         |MENAV aAlfa;
         |ERROR;
     |FINSI;

     |ABRE #900;
     |BUCLE dsam0106_1;
     |CIERRA #900;

     |DESCARGA_DEF #espejo1@;

     |ABRE #107;
     |BUCLE dsam0106_2;
     |CIERRA #107;
|FPRC;
