|FICHEROS;
     dsaz0002 #0;
     :/basica/def/agim0017 #1;
     dsam0054 #54;
|FIN;

|VARIABLES;
     nCaracter    = 0;
     nPosi        = 0;
     nLong        = 0;
     nSal         = 0;
     nContador    = 0;
     nSeguir      = 0;
     nCanal       = 0;
     nLinea       = 0;

     aNombreIP    = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aAlfa        = "";
     aBase        = "";
     aLong        = "";
     aCaracter    = "";
     aPathDocum   = "";
     aFichOrigen  = "";
     aFichDestino = "";
     aRuta        = "";
     aTextos      = "";
     aDirec       = "";
     aDocumento   = "";


     &enCodUbica      = 0;
     &eaRutaDocumento = "";
     &eaExtension     = "";
|FIN;

|PROCESO DirecTextos;  |TIPO 0;
     |SI FSalida = 10;
         aRuta = "D" + #0Campo;
         |BROWSE aRuta;
         #0Campo = aRuta % 280;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa  = #0Campo > "";   |QBF aAlfa;
     aAlfa1 = aAlfa - "AGICLI\TEXTOS";
     |SI aAlfa = aAlfa1;
         |MENAV "     Ubicacion Erronea";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO CreaDocumento;
     #54#0  = 0;
     #54#1  = 9999;
     |LEE 040#54];
     |SI FSalida = 0;
         |LEE 040#54a;
     |SINO;
         |LEE 040#54u;
     |FINSI;
     |SI FSalida = 0;  |Y #54#0 = 0;
         nLinea = #54#1 + 1;
     |SINO;
         nLinea = 1;
     |FINSI;

     enCodUbica = #0#0;  |HAZ LeeUbicaciones;

     aFichOrigen = #0#2;  |QBF aFichOrigen;
     aFichOrigen = aFichOrigen + "\" + aDocumento + ".txt";

     aAlfa1       = eaRutaDocumento;                  |QBF aAlfa1;
     aAlfa3       = ((eaExtension + "zzz") % 103) + "00000" + (("0000" + nLinea) % -104) + "." + eaExtension;
     aFichDestino = aAlfa1 + "\" + aAlfa3;   |QBF aFichDestino;

     |RCOPIA_FICHERO aFichOrigen, aFichDestino;

     |XABRE "EC", aFichDestino, nCanal;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     |DDEFECTO #54;
     |HORA aAlfa;
     aAlfa1 = aAlfa % 102;
     aAlfa2 = aAlfa % 402;

     #54#0  = 0;
     #54#1  = nLinea;
     #54#2  = #1#1;
     #54#3  = ((eaExtension + "zzz") % 103) + "00000" + (("0000" + #54#1) % -104) + "." + eaExtension;
     #54#4  = ~;
     #54#8  = aAlfa1;
     #54#9  = aAlfa2;
     #54#10 = enCodUbica;
     #54#11 = #1#2;
     #54#12 = #1#3;
     |GRABA 020#54n;
     |LIBERA #54;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     |ABRE #54;

     aDirec  = #0#2 + "/";       |QBT aDirec;
     aTextos = aDirec + "*.txt"; |QBT aTextos;

     |ABRE #1;
     |R_PDIR aTextos;
     |PARA; |SI; |HACIENDO;
         aDocumento = aTextos - aDirec;
         aDocumento = aDocumento - ".txt";
         #1#0 = aDocumento;
         |LEE 040#1=;
         |SI FSalida ! 0;
             #1#0 = aDocumento > " ";
             |LEE 040#1=;
             |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
         |FINSI;

         |HAZ CreaDocumento;

         |R_SDIR aTextos;
         |SI FSalida ! 0; |SAL; |FINSI;
     |SIGUE;
     |CIERRA #1;
     |CIERRA #54;
|FPRC;

|PROGRAMA;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
|FPRO;
