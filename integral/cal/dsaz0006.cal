|FICHEROS;
     dsam0000 #0;
     dsam0010 #10;
     dsaz0006 #999;
     dsaw0034 #900,MANTE;

     :/facturar/def/facemp1    #700;      || Empresa facturar
     :/facturar/def/asclient   #701;      || Clientes facturar
     :/facturar/def/ascuenco   #702;      || Clientes facturar
|FIN;

|VARIABLES;
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";
     aAlfa4      = "";
     aBase       = "";
     aCuenta     = "";

     nNume1      = 0;
     nNume2      = 0;
     nNume3      = 0;
     nPara1      = 0;
     nSw         = 0;
     nSwGraba    = 0;
     &MaximoDigitos = 0;
     &enSwSinMen    = 0;
|FIN;


|RUTINA ClaveBaja999;
    #999#0 = "";
|FRUT;

|RUTINA ClaveAlta999;
    #999#0 = "z" * 12;
|FRUT;

|PROCESO PorMaestra;
     |SI MaximoDigitos = 0; MaximoDigitos = 12; |FINSI;

     aAlfa1   = #999#0; |QBF aAlfa1;
     aAlfa2   = aAlfa1 % 0;
     nNume1   = aAlfa2;

     nSw    = 0;
     aAlfa4 = "";
     |PARA nPara1 = 1; |SI nPara1 [ nNume1; |HACIENDO nPara1 = nPara1 + 1;
           nNume2 = (nPara1 * 100) + 1;
           aAlfa2 = nNume2;
           aAlfa3 = aAlfa1 % aAlfa2;
           |SI aAlfa3 < "0"; |O aAlfa3 > "9";
               aAlfa3 = "0";
               nSw = 1;
           |FINSI;
           aAlfa4 = aAlfa4 + aAlfa3;
     |SIGUE;
     |SI nSw = 1; aAlfa1 = aAlfa4; |FINSI;

     |SI nNume1 ] 8;
         aAlfa2 = aAlfa1 % 103;
         aAlfa3 = aAlfa1 % -105;
         nNume2 = MaximoDigitos - 8;
     |SINO;
         aAlfa2 = aAlfa1 % 102;
         aAlfa3 = aAlfa1 % 306; |QBF aAlfa3;
         nNume2 = MaximoDigitos - nNume1;
     |FINSI;
     |SI nNume2 < 0; nNume2 = 0; |FINSI;

     aAlfa    = "0" * nNume2;
     aAlfa1   = aAlfa2 + aAlfa + aAlfa3;
     #999#3   = aAlfa1;
|FPRC;

|PROCESO dsam0000L;
     |SI #0#103 = "            ";  |ACABA;  |FINSI;

     #999#0 = #0#103;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0 = #0#103;
         #999#1 = #0#103;
         #999#2 = #0#103;
         |HAZ PorMaestra;
         |GRABA 020#999n;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE dsam0000L;
     #0#1;
     ;
     00000;
     99999;
     ;
     NULL, dsam0000L;
|FIN;

|PROCESO dsam0010L;
     |SI #10#15 = "            ";  |ACABA;  |FINSI;

     #999#0 = #10#15;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0 = #10#15;
         #999#1 = #10#15;
         #999#2 = #10#15;
         |HAZ PorMaestra;
         |GRABA 020#999n;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE dsam0010L;
     #10#1;
     ;
     00000, 01;
     99999, 99;
     ;
     NULL, dsam0010L;
|FIN;

|PROCESO ascuencoL;
     |SI #702#3 = "            ";  |ACABA;  |FINSI;
     |SI #702#3 = "DESGLOSE    ";  |ACABA;  |FINSI;

     #999#0 = #702#3;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0 = #702#3;
         #999#1 = #702#3;
         #999#2 = #702#3;
         |HAZ PorMaestra;
         |GRABA 020#999n;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE ascuencoL;
     #702#1;
     ;
     "    ", "  ";
     "zzzz", "zz";
     ;
     NULL, ascuencoL;
|FIN;

|PROCESO asclientL;
     |SI #701#52 = "            ";  |ACABA;  |FINSI;

     #999#0 = #701#52;
     |LEE 101#999=;
     |SI FSalida ! 0;
         |DDEFECTO #999;
         #999#0 = #701#52;
         #999#1 = #701#52;
         #999#2 = #701#52;
         |HAZ PorMaestra;
         |GRABA 020#999n;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE asclientL;
     #701#1;
     ;
     00000;
     99999;
     ;
     NULL, asclientL;
|FIN;

|PROCESO facempL;
     aBase = "";
     |DBASS aBase;  |QBT aBase;
     aBase = aBase + "facturar/fich/";
     aAlfa = aBase + (("00" + #700#0) % -102) + "/";  |QBT aAlfa;

     |PATH_DAT #701 aAlfa;
     |PATH_DAT #702 aAlfa;

     |BUCLE asclientL;
     |BUCLE ascuencoL;
|FPRC;

|DEFBUCLE facempL;
     #700#1;
     ;
     00;
     99;
     ;
     NULL, facempL;
|FIN;

|PROCESO dsaz0006M;
     #999#1 = #999#3;
     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE dsaz0006M;
     #999#1;
     ;
     "            ";
     "zzzzzzzzzzzz";
     be;
     NULL, dsaz0006M;
|FIN;

|PROCESO dsaz0006O;
     #999#1 = #999#2;
     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE dsaz0006O;
     #999#1;
     ;
     "            ";
     "zzzzzzzzzzzz";
     be;
     NULL, dsaz0006O;
|FIN;

|PROCESO dsaz0006C;
     nSwGraba = 0;
     |SI #900#2 = "S";
         aCuenta = #999#1;   |QBF aCuenta;

         |SI #900#3 < #900#5;
             nNume1  = 99 + #900#3;
         |SINO;
             nNume1  = 99 + #900#5;
         |FINSI;
         aAlfa1  = aCuenta % nNume1;        || parte izda.

         nNume1  = (#900#3 * 100) + #900#4;
         aAlfa3  = aCuenta % nNume1;        || parte a desplazar

         nNume1  = #900#5 - #900#3;
         |SI nNume1 < 0; nNume1 = 0; |FINSI;
         aAlfa2  = &32 * nNume1;            || relleno de espacios
         aCuenta = aAlfa1 + aAlfa2 + aAlfa3;

         #999#1  = aCuenta;
         nSwGraba = 1;
   |FINSI;

   |SI #900#6 = "S";
       aCuenta = #999#1;   |QBF aCuenta;
       aAlfa1  = aCuenta % 0;
       nNume2  = aAlfa1;

       nNume1  = 99 + #900#7;
       aAlfa1  = aCuenta % nNume1;         || parte izda.
       nNume1  = #900#8;
       aAlfa2  = "0" * nNume1;             || relleno de ceros
       nNume1  = -((nNume2 - (#900#7 + #900#8 - 1)) + 100);
       aAlfa3  = aCuenta % nNume1;         || parte dcha.
       aCuenta = aAlfa1 + aAlfa2 + aAlfa3;

       #999#1  = aCuenta;
       nSwGraba = 1;
   |FINSI;

   |SI nSwGraba = 1;
       |GRABA 020#999a;
   |FINSI;

   |LIBERA #999;
|FPRC;

|DEFBUCLE dsaz0006C;
     #999#1;
     ;
     #900#0;
     #900#1;
     be;
     NULL, dsaz0006C;
|FIN;

|PROCESO dsam0000G;
     #999#0 = #0#103;
     |LEE 040#999=;
     |SI FSalida = 0;
         #0#103 = #999#1;
         |GRABA 020#0a;
     |FINSI;
     |LIBERA #0;
|FPRC;

|DEFBUCLE dsam0000G;
     #0#1;
     ;
     00000;
     99999;
     be;
     NULL, dsam0000G;
|FIN;

|PROCESO dsam0010G;
     #999#0 = #10#15;
     |LEE 040#999=;
     |SI FSalida = 0;
         #10#15 = #999#1;
         |GRABA 020#10a;
     |FINSI;
     |LIBERA #10;
|FPRC;

|DEFBUCLE dsam0010G;
     #10#1;
     ;
     00000, 01;
     99999, 99;
     be;
     NULL, dsam0010G;
|FIN;

|PROCESO asclientG;
     #999#0 = #701#52;
     |LEE 040#999=;
     |SI FSalida = 0;
         #701#52 = #999#1;
         |GRABA 020#701a;
     |FINSI;
     |LIBERA #701;
|FPRC;

|DEFBUCLE asclientG;
     #701#1;
     ;
     00000;
     99999;
     be;
     NULL, asclientG;
|FIN;

|PROCESO ascuencoG;
     #999#0 = #702#3;
     |LEE 040#999=;
     |SI FSalida = 0;
         #702#3 = #999#1;
         |GRABA 020#702a;
     |FINSI;
     |LIBERA #702;
|FPRC;

|DEFBUCLE ascuencoG;
     #702#1;
     ;
     "    ", "  ";
     "zzzz", "zz";
     be;
     NULL, ascuencoG;
|FIN;

|PROCESO facempG;
     aBase = "";
     |DBASS aBase;  |QBT aBase;
     aBase = aBase + "facturar/fich/";
     aAlfa = aBase + (("00" + #700#0) % -102) + "/";  |QBT aAlfa;

     |PATH_DAT #701 aAlfa;
     |PATH_DAT #702 aAlfa;

     |BUCLE asclientG;
     |BUCLE ascuencoG;
|FPRC;

|DEFBUCLE facempG;
     #700#1;
     ;
     00;
     99;
     ;
     NULL, facempG;
|FIN;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida = 10;
         |LEE 101#999=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |ENCAMPO #1#999;
         |GRABA 020#999a;
         |LIBERA #999;
     |FINSI;

     |SI FSalida = 11;
         |PUSHV 0501 2380;
         |DDEFECTO #900;
         |PINPA #0#900;
         |PINDA #0#900;
         |ENDATOS #1#900;
         |SI FSalida = 0;
             |SI #900#2 = "S"; |O #900#6 = "S";
                 |BUCLE dsaz0006C;

                 |PONCONTROL 23, "SI";
                 |PTEC 812;
             |FINSI;
         |FINSI;
         |POPV;
     |FINSI;

     |SI FSalida = 12;
         |BUCLE dsaz0006O;

         |PONCONTROL 23, "SI";
         |PTEC 812;
     |FINSI;

     |SI FSalida = 13;
         |BUCLE dsaz0006M;

         |PONCONTROL 23, "SI";
         |PTEC 812;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #999;
     |LEE 000#999p;
     |SI FSalida = 0;
         |MENAV "0000 Hay alguien haciendo el cambio.";
         |CIERRA #999;
         |ACABA;
     |FINSI;
     |CIERRA #999;

     enSwSinMen    = 1;
     |HAZ SituaMaestraI;  || Leer maestra
     enSwSinMen    = 0;

     |CLS;
     |CABEZA "Cambio de Cuentas";
     |PINPA #0#999;
     |MENSA "     Buscando Cuentas de los Clientes y Conceptos";

     |ABRE #999;  |CIERRA #999;  |DELINDEX #999;

     |ABRE #999;
     |BUCLE dsam0000L;
     |BUCLE dsam0010L;
     |BUCLE facempL;
     |CIERRA #999;

     |MENSA "                                     ";

     |ENTLINEAL #1#999, -1, 4, 22, 1, ClaveBaja999, ClaveAlta999;

     |CONFI "0000N Desea realizar en estos momentos el cambio de Cuentas.";
     |SI FSalida = 0;
         |MENSA "     Grabando Cuentas a los Clientes";
         |ABRE #999;

         |BUCLE dsam0000G;
         |BUCLE dsam0010G;
         |BUCLE facempG;

         |CIERRA #999;
     |FINSI;

     |DELINDEX #999;
|FPRO;
