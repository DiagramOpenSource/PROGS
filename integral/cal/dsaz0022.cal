|FICHEROS;
     dsaz0022;
     dsam0111;
     dsam0112;
     dsaw0038,MANTE;
     dsaw0022;

     referen@;
|FIN;

|VARIABLES;
     aAbre          = "";
     aBase          = "";
     aAlfaAnt       = "";
     aAlfa          = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aAlfa3         = "";
     aEsc1          = "";
     aEsc2          = "";
     aRetu          = "";
     aTecla         = "";
     aFichero       = "";
     aCarga         = "";
     aQueQuiero     = "";
     aTexto         = "";
     aTexto1        = "";
     aTexto2        = "";
     aLong          = "";
     aCarac         = "";
     aRefresca      = "";
     aBusca         = "";
     aBusca1        = "";
     aBusca2        = "";
     aIPRemoto      = "";
     aNombreIP      = "";
     aRuta          = "";
     aFicheroActu   = "";
     aMas           = "";
     aTitulo        = "";
     aNumCampos     = "";
     aNombCampo     = "";
     aTipoCampo     = "";
     aLongCampo     = "";
     aRegilla       = "";
     aOrigen        = "";
     aDestino        = "";
     aTemporal       = "";
     aPathPlan       = "";
     aCadena1        = "";
     aCadena2        = "";
     aNombreFich     = "";
     aAplica         = "";

     nBotonLabel    = 0;
     nHandle        = 0;
     nCanal         = 0;
     nTree          = -1;
     nTree1         = -1;
     nTree2         = -1;
     nPanta         = 0;
     nSubPanta      = 0;
     nLong          = 0;
     nCargar        = 0;
     nPos           = 0;
     nPosi          = 0;
     nBoton1        = 0;
     nBoton2        = 0;
     nBoton3        = 0;
     nVent          = 0;
     nSubVent       = 0;
     nCampo         = 0;
     nTCampo        = 0;
     nCarpeta1      = 0;
     nCarpeta2      = 0;
     nSubBoton1     = 0;
     nSubBoton2     = 0;
     nSubBoton3     = 0;
     nSubBoton4     = 0;
     nContador      = 0;
     nSwNuest       = 0;
     nModo          = 0;
     nNumCampos     = 0;
     nCampos        = 0;
     nDCodigo       = 0;
     nHCodigo       = 0;
     nSwGraba       = 0;
     nSwAborto      = 0;
     nRango         = 0;
     nContenido     = 0;

     {-1}sTree      = 0;
     sT_nID         = 0;
     sT_nOper       = 0;
     sT_aData       = "";

     {-1}sTree_1    = 0;
     sT_nID_1       = 0;
     sT_nOper_1     = 0;
     sT_aData_1     = "";

     {-1}sTree_2    = 0;
     sT_nID_2       = 0;
     sT_nOper_2     = 0;
     sT_aData_2     = "";

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";

     &eaFicheroRecog = "";
     &enFSalida        = 0;
     &efFechaDocu      = @;
     &enCodUbica       = 0;
     &enTipoDocumento  = 0;
     &eaRutaDocumento  = "";
     &eaNombrePrograma = "";
     &eaNombreRuta     = "";
     &eaRutaPlanilla   = "";
     &eaExtension      = "";
     &eaFicheroEdita   = "";
     &eaFicheroEditaO  = "";
     &eaTipoMailing    = "";
     &eaPiePagina      = "";
     &eaRuta           = "";
     &eaCadenaImpre    = "";

     &eaRutaOrigen  = "";
     &eaRutaDestino = "";
     &eaFicheroTxt  = "";
     &eaFicheroTgz  = "";
     &eaFicheroTar  = "";
     &eaAlfa        = "";
     &eaUnidadBasico = "";
|FIN;

||***************************************************************************

|PROCESO EventoPanta;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsaw0022.=;
         |SI FSalida ! 0;  |DDEFECTO #dsaw0022;  |FINSI;
     |FINSI;

     |SI FSalida = 4;
         eaFicheroRecog = #dsaw0022#0;

         |QBF eaFicheroRecog;

         |PTEC 806;
     |FINSI;
|FPRC;

|PROCESO RecogePlanillas;
     nSwGraba = 0;

     aTemporal = ("c6" + Usuario + "zzzzzzzz") % 108;  |NOME_DAT #dsaw0022#aTemporal#;
     |ABRE #dsaw0022;  |CIERRA #dsaw0022;  |DELINDEX #dsaw0022;

     |ABRE #dsaw0022;

     aPathPlan = eaRutaPlanilla;   |QBF aPathPlan;
     aPathPlan = aPathPlan - "\*" + "/";

     aOrigen   = aPathPlan;

     |R_PDIR aOrigen;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aCadena1 = aOrigen     > " ";
            aCadena2 = eaExtension > " ";
            aCadena2 = "." + aCadena2;
            aAlfa    = aCadena1 - aCadena2;
            |SI aAlfa ! aCadena1;
                aCadena1    = aOrigen    > " ";
                aCadena2    = aPathPlan  > " ";  |QBF aCadena2
                aNombreFich = aCadena1 - aCadena2;

                #dsaw0022#0 = aNombreFich;
                #dsaw0022#1 = aNombreFich;
                |GRABA 020#dsaw0022.n;
                |LIBERA #dsaw0022;
                nSwGraba = 1;
            |FINSI;

            |R_SDIR aOrigen;
     |SIGUE;
     |CIERRA #dsaw0022;

     nSwAborto = 1;
     |SI nSwGraba = 1;
         |VENTANA 0530, 2470, nSubPanta, 17, "Planillas";
         nVent = FSalida;

         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVent;
         aVent5 = "MODAL";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         nRango = 4 + 8 + 16 + 128;

         |ABRE #dsaw0022;

         |LINEAL_SIMPLE #1#dsaw0022, nRango, 0535, 2265, NULL, NULL, EventoPanta;
         |CIERRA #dsaw0022;

         aVent1 = -1;
         aVent2 = -1;
         aVent3 = 0;
         aVent4 = nVent;
         aVent5 = "MODELESS";
         |ESPECIFICA "ESTADO_VENTANA", aVent;

         |FINVENTANA nVent;

         |SI eaFicheroRecog ! "";
             aOrigen = aPathPlan + eaFicheroRecog;
         |FINSI;
     |SINO;
         |MENAV "      Seleccion Vacia.";
     |FINSI;

     |DELINDEX #dsaw0022;
|FPRC;

|PROCESO Editar;
     efFechaDocu = "00.00.0000";
     enCodUbica  = #dsaw0038#2;  |HAZ LeeUbicaciones;
     eaRuta      = eaRutaDocumento;
     eaExtension = eaExtension < "";

     aOrigen  = eaRutaPlanilla;                   |QBF aOrigen;
     aDestino = eaRutaDocumento + "/" + #dsaw0038#4;   |QBF aDestino;
     aDestino = aDestino + "." + eaExtension;     |QBF aDestino;

     |XABRE "EC", aDestino, nCanal;

     |SI FSalida ] 0;
         aOrigen  = "";
     |FINSI;
     |XCIERRA nCanal;

     |SI aOrigen ! "";
         aAlfa = aOrigen % -101;
         |SI aAlfa = "*";
             |HAZ RecogePlanillas;
             |QBF aOrigen;
         |FINSI;

         |SI aOrigen ! "";
             |RCOPIA_FICHERO aOrigen, aDestino;

             |SI FSalida ! 0;
                 |MENAV "         Ha habido un error al copiar la Plantilla.";
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     eaFicheroEditaO = #dsaw0038#4;                              |QBF eaFicheroEditaO;
     eaFicheroEditaO = eaFicheroEditaO + "." + eaExtension;  |QBF eaFicheroEditaO;
     eaFicheroEdita  = eaFicheroEditaO;  |QBT eaFicheroEdita;
     |HAZ AbreDocumento;
|FPRC;

|PROCESO Imprime;
     aRegilla = "#";
     |SI nContador = 0;  aRegilla = " ";  |FINSI;
     aAlfa = ("00000" + #dsam0112#1) % -105;

     nContador     = nContador + 1;
     |SI #dsam0112#5 = "dsam0000";  |O #dsam0112#5 = "dsay0004";
         eaCadenaImpre = "#" + (aAlfa % 102) + "#" + "0" + (aAlfa % 303) + "   " + #dsam0112#2 + "   " + #dsam0112#3;
         |PRINT;
     |SINO;
         eaCadenaImpre = "#" + (aAlfa % 102) + "#" + nCampo + (aAlfa % 303) + "   " + #dsam0112#2 + "   " + #dsam0112#3 + "   L" + nCampo;
         |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE dsam0112C;
     #dsam0112#1;
     ;
     #dsaw0038#0, nDCodigo;
     #dsaw0038#0, nHCodigo;
     ;
     NULL, Imprime;
|FIN;

|PROCESO Plantilla;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "dsam0111";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     efFechaDocu = "00.00.0000";
     enCodUbica  = #dsaw0038#2;  |HAZ LeeUbicaciones;
     eaRuta      = eaRutaDocumento;

     #dsam0111#0 = #dsaw0038#0;
     #dsam0111#1 = #dsaw0038#1;
     #dsam0111#2 = #dsaw0038#2;
     #dsam0111#3 = #dsaw0038#3;
     #dsam0111#4 = #dsaw0038#4;
     #dsam0111#5 = #dsaw0038#5;
     #dsam0111#6 = #dsaw0038#6;

     nContador = 0;
     nDCodigo  = 01000;  nHCodigo  = 01999;  |BUCLE dsam0112C;
     nDCodigo  = 07000;  nHCodigo  = 07999;  |BUCLE dsam0112C;
     nDCodigo  = 08000;  nHCodigo  = 08999;  |BUCLE dsam0112C;

     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nDCodigo  = 02000;  nHCodigo  = 02999;  |BUCLE dsam0112C;
     |SIGUE;

     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nDCodigo  = 03000;  nHCodigo  = 03999;  |BUCLE dsam0112C;
     |SIGUE;

     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nDCodigo  = 04000;  nHCodigo  = 04999;  |BUCLE dsam0112C;
     |SIGUE;

     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nDCodigo  = 05000;  nHCodigo  = 05999;  |BUCLE dsam0112C;
     |SIGUE;

     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nDCodigo  = 06000;  nHCodigo  = 06999;  |BUCLE dsam0112C;
     |SIGUE;

     |SI nContador ! 0;  |PIEINF;  |FINSI;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO EventoTree1;
     |ESTADO_CONTROL nSubBoton1, "ENABLE";
     |ESTADO_CONTROL nSubBoton2, "DISABLE";

     aAlfa       = Contenido;  |QBF aAlfa;
     aTexto1     = "";
     aLong       = aAlfa % 0;
     nLong       = aLong;
     nCargar     = 0;
     |PARA nPosi = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
           nPos = (nPosi * 100) + 1;
           aCarac = aAlfa % nPos;

           |SI nCargar = 1;
               aTexto1 = aTexto1 + aCarac;
           |FINSI;

           |SI aCarac = ":";  nCargar = 1; |FINSI;
     |SIGUE;

     |SI aTexto1 = "";
         |ESTADO_CONTROL nSubBoton1, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO EventoTree2;
     |ESTADO_CONTROL nSubBoton1, "DISABLE";
     |ESTADO_CONTROL nSubBoton2, "ENABLE";

     aAlfa       = Contenido;  |QBF aAlfa;
     aTexto2     = "";
     aLong       = aAlfa % 0;
     nLong       = aLong;
     nCargar     = 0;
     |PARA nPosi = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
           nPos = (nPosi * 100) + 1;
           aCarac = aAlfa % nPos;

           |SI nCargar = 1;
               aTexto2 = aTexto2 + aCarac;
           |FINSI;

           |SI aCarac = ":";  nCargar = 1; |FINSI;
     |SIGUE;

     |SI aTexto2 = "";
         |ESTADO_CONTROL nSubBoton2, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO CargaArbol;
     |QBF aAlfa;
     aAlfa = aAlfa + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO dsam0112A;
     nCarpeta2 = nCarpeta2  + 1;

     aAlfa1 = #dsam0112#2;   |QBF aAlfa1;
     aAlfa  = ("00000" + #dsam0112#1) % -105;
     aAlfa2 = aAlfa  % 102;
     aAlfa3 = aAlfa  % 303;

     |SI aAlfa2 ! aAlfaAnt;
         nCarpeta1 = nCarpeta1 + 1;
         aAlfa     = nCarpeta1 + ":" + aAlfa2 + " - " + #dsam0112#5 + " - " + #dsam0112#2;
         nCarpeta2 = 0;
         |HAZ CargaArbol;
     |FINSI;

     aAlfaAnt  = aAlfa2;
     nCarpeta2 = nCarpeta2 + 1;

     aAlfa = nCarpeta1 + "," + nCarpeta2 + ":" + aAlfa3 + " - " + #dsam0112#3;
     aAlfa     = aAlfa + "{{";
     aAlfa     = aAlfa + aAlfa2;
     aAlfa     = aAlfa + aAlfa3;
     aAlfa     = aAlfa + #dsam0112#3;
     aAlfa     = aAlfa + #dsam0112#7;
     aAlfa     = aAlfa + (#dsam0112#6 + "    ") % 104;
     aAlfa     = aAlfa +  "}}";
     |HAZ CargaArbol;
|FPRC;

|DEFBUCLE dsam0112A;
     #dsam0112#1;
     ;
     #dsaw0038#0, 00000;
     #dsaw0038#0, 99999;
     ;
     NULL, dsam0112A;
|FIN;

|PROCESO CargaTemporal;
     |DBASS aBase;  |QBF aBase;
     aMas  = aBase + aAplica + "/def/" + aFichero;
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;
         |MENAV  "         Error en cargar el Def ... Proceso Abortado.";
         |ACABA;
     |FINSI;

     nContador  = nContador + 1;
     aQueQuiero = "|TITULO";
     aTitulo    = #referen@#aQueQuiero#;  |QBF aTitulo;
     aTitulo    = (aTitulo + (" " * 40)) % 140;

     nCarpeta1 = nCarpeta1 + 1;
     aAlfa     = nCarpeta1 + ":" + (("00" + nContador) % -102) + " - "  + aFichero + " - " + aTitulo;
     |HAZ CargaArbol;

     nCarpeta2  = 0;
     aQueQuiero = "|NC";
     aNumCampos = #referen@#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;
     |PARA nCampos = 0;  |SI nCampos [ nNumCampos;  |HACIENDO nCampos = nCampos + 1;
           aQueQuiero = "|C" + (("000" + nCampos) % -103) + "NOMBRE";
           aNombCampo = #referen@#aQueQuiero#;
           aNombCampo = (aNombCampo + (" " * 20)) % 120;

           aQueQuiero = "|C" + (("000" + nCampos) % -103) + "TIPO";
           aTipoCampo = #referen@#aQueQuiero#;

           aQueQuiero = "|C" + (("000" + nCampos) % -103) + "LONGITUD";
           aLongCampo = #referen@#aQueQuiero#;
           aLongCampo = (aLongCampo + (" " * 4)) % 104;

           nCarpeta2 = nCarpeta2 + 1;
           aAlfa     = nCarpeta1 + "," + nCarpeta2 + ":";
           aAlfa     = aAlfa + (("000" + nCampos) % -103) + " - "  + aNombCampo;
           aAlfa     = aAlfa + "{{";
           aAlfa     = aAlfa + (("00" + nContador) % -102);
           aAlfa     = aAlfa +  (("000" + nCampos) % -103);
           aAlfa     = aAlfa +  aNombCampo;
           aAlfa     = aAlfa +  aTipoCampo;
           aAlfa     = aAlfa +  aLongCampo;
           aAlfa     = aAlfa +  aLongCampo;
           aAlfa     = aAlfa +  aTitulo;
           aAlfa     = aAlfa +  aFichero;
           aAlfa     = aAlfa +  nSwNuest;

           aAlfa     = aAlfa +  "}}";
           |HAZ CargaArbol;
     |SIGUE;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO ParaAsignar;
     |SI nTree1 ! -1;
         |FIN_CONTROL_WINDOWS nTree1;
         nTree1 = -1;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aAlfa = aBase + "tmp";          |MKDIR aAlfa;

     eaRutaOrigen  = aBase + "tmp/";
     eaRutaDestino = eaUnidadBasico + "\documentos";           |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp";       |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp\";
     eaFicheroTxt  = "dsaz002202" + Usuario + ".txt";
     eaFicheroTgz  = "dsaz002202" + Usuario + ".tgz";
     eaFicheroTar  = "dsaz002202" + Usuario + ".tar";

     aAbre = eaRutaOrigen + eaFicheroTxt;

     sT_nID_1   = nTree1;
     sT_nOper_1 = 0;

     |XABRE "WB", aAbre, nHandle;

     nContador = 0;
     nCarpeta1 = 0;

     aFichero = "dsam0000";  aAplica = "integral";  |HAZ CargaTemporal;
     aFichero = "dsam0002";  aAplica = "integral";  |HAZ CargaTemporal;
     aFichero = "dsam0005";  aAplica = "integral";  |HAZ CargaTemporal;
     aFichero = "agicen14";  aAplica = "basica";    |HAZ CargaTemporal;
     aFichero = "dsam0053";  aAplica = "integral";  |HAZ CargaTemporal;
     aFichero = "dsam0054";  aAplica = "integral";  |HAZ CargaTemporal;
     aFichero = "dsay0004";  aAplica = "integral";  |HAZ CargaTemporal;

     |SI #dsaw0038#6 ! 0;
         aFichero = "dsmom004";  aAplica = "modelos";   |HAZ CargaTemporal;
     |FINSI;

     |XCIERRA nHandle;

     |HAZ TraeTxtComprimido;
     aAlfa = eaRutaDestino + eaFicheroTxt;

     eaAlfa = "TREECTRL,Para asignar {{" + aAlfa + "}}";
     |CONTROL_SIMPLE nSubPanta, eaAlfa, 1102, 2645, EventoTree1;
     nTree1 = FSalida;

     eaFicheroTxt  = "dsaz002202" + Usuario + ".txt";
     aAlfa         = eaRutaDestino + eaFicheroTxt;
     |RFBORRA aAlfa;

     aRefresca = "";
     |SI aBusca1 ! "";
         sT_nID_1   = nTree1;
         sT_nOper_1 = 3;
         sT_aData_1 = "[" + aBusca1;
         |ESPECIFICA "COMMANDCONTROL", sTree_1;
         aRefresca = ":" + FSalida;
     |FINSI;

     sT_nID_1   = nTree1;
     sT_nOper_1 = 2;
     |SI aRefresca = "";
         sT_aData_1 = "1:";
     |SINO;
         sT_aData_1 = aRefresca;
     |FINSI;
     |ESPECIFICA "COMMANDCONTROL", sTree_1;
|FPRC;

|PROCESO ParaAsignados;
     |SI nTree2 ! -1;
         |FIN_CONTROL_WINDOWS nTree2;
         nTree2 = -1;
     |FINSI;

     |DBASE aBase;  |QBF aBase;

     eaRutaOrigen  = aBase + "tmp/";
     eaRutaDestino = eaUnidadBasico + "\documentos";           |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp";       |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp\";
     eaFicheroTxt  = "dsaz002203" + Usuario + ".txt";
     eaFicheroTgz  = "dsaz002203" + Usuario + ".tgz";
     eaFicheroTar  = "dsaz002203" + Usuario + ".tar";

     aAbre = eaRutaOrigen + eaFicheroTxt;

     sT_nID_2   = nTree2;
     sT_nOper_2 = 0;

     |XABRE "WB", aAbre, nHandle;

     nContador = 0;
     nCarpeta1 = 0;
     nCarpeta2 = 0;
     aAlfaAnt  = "";
     |BUCLE dsam0112A;

     |XCIERRA nHandle;

     |HAZ TraeTxtComprimido;
     aAlfa = eaRutaDestino + eaFicheroTxt;

     eaAlfa = "TREECTRL,Asignados {{" + aAlfa + "}}";
     |CONTROL_SIMPLE nSubPanta, eaAlfa, 1155, 2698, EventoTree2;
     nTree2 = FSalida;

     eaFicheroTxt  = "dsaz002203" + Usuario + ".txt";
     aAlfa         = eaRutaDestino + eaFicheroTxt;
     |RFBORRA aAlfa;

     aRefresca = "";
     |SI aBusca2 ! "";
         sT_nID_2   = nTree2;
         sT_nOper_2 = 3;
         sT_aData_2 = "[" + aBusca2;
         |ESPECIFICA "COMMANDCONTROL", sTree_2;
         aRefresca = ":" + FSalida;
     |FINSI;

     sT_nID_2   = nTree2;
     sT_nOper_2 = 2;
     |SI aRefresca = "";
         sT_aData_2 = "1:";
     |SINO;
         sT_aData_2 = aRefresca;
     |FINSI;
     |ESPECIFICA "COMMANDCONTROL", sTree_2;
|FPRC;

|PROCESO MontaArbolCampos;
     |CONTROL_SIMPLE 0, "LABEL,{{5}}Cargando informaci¢n ...", 1315, 1680, NULL;
     nBotonLabel = FSalida;

     |PTEC 802;  |PAUSA;

     |HAZ ParaAsignar;
     |HAZ ParaAsignados;

     |FIN_CONTROL_WINDOWS nBotonLabel;
     |PULSATECLA;

     |FOCOTECLADO nTree1;

     |ESTADO_CONTROL nSubBoton1, "DISABLE";
     |ESTADO_CONTROL nSubBoton2, "DISABLE";
|FPRC;

|PROCESO Tipo0C6Fw38;  |TIPO 0;
     nContenido = Contenido;
     |SI #dsaw0038#6 ! nContenido;
         |HAZ MontaArbolCampos;
     |FINSI;
|FPRC;

|PROCESO Tipo12Fw38;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     efFechaDocu = "00.00.0000";
     enCodUbica  = #dsaw0038#2;  |HAZ LeeUbicaciones;
     eaExtension = eaExtension < "";

     aDestino = eaRutaDocumento + "/" + #dsaw0038#4;   |QBF aDestino;
     aDestino = aDestino + "." + eaExtension;     |QBF aDestino;

     |XABRE "EC", aDestino, nCanal;

     |SI FSalida < 0;
         |MENAV "0000 No se ha creado el documento en word. Por favor pinche en la opci¢n Editar documento en word";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo0C2Fw38;  |TIPO 0;
     efFechaDocu = "00.00.0000";
     enCodUbica  = #dsaw0038#2;  |HAZ LeeUbicaciones;
     eaRuta      = eaRutaDocumento;

     |SI enTipoDocumento ! 1;
         |MENAV "     El programa externo debe ser Tipo WORD.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo0C4Fw38;  |TIPO 0;
     #dsaw0038#4 = #dsaw0038#4 > " ";

     aAlfa = #dsaw0038#4;  |QBT aAlfa;
     |SI aAlfa = "";
         |MENAV "      Introduzca el Nombre del Documento.";
         |ERROR;
     |SINO;
         #dsaw0038#4 = aAlfa;
     |FINSI;
     |PINTA #dsaw0038#4;
|FPRC;

|PROCESO Tipo0C5Fw38;  |TIPO 0;
     |SI nModo = 1;
         |HAZ MontaArbolCampos;
     |FINSI;
|FPRC;

|PROCESO Asignar;
     aAlfa  = aTexto1 % 105;

     #dsam0112#0 = #dsaw0038#0;
     #dsam0112#1 = aAlfa;
     |LEE 000#dsam0112.=;
     |SI FSalida = 0;
         |MENAV "0000 El campo ya estaba asignado de anterioridad.";
         |ACABA;
     |FINSI;

     |DDEFECTO #dsam0112;
     #dsam0112#0 = #dsaw0038#0;
     #dsam0112#1 = aAlfa;
     aAlfa  = aTexto1 % 3540;  #dsam0112#2 = aAlfa;
     aAlfa  = aTexto1 % 0620;  #dsam0112#3 = aAlfa;
     aAlfa  = aTexto1 % 7508;  #dsam0112#5 = aAlfa;
     aAlfa  = aTexto1 % 2704;  #dsam0112#6 = aAlfa;
     aAlfa  = aTexto1 % 2601;  #dsam0112#7 = aAlfa;
     |GRABA 020#dsam0112.n;
     |LIBERA #dsam0112;

     aAlfa1 = #dsam0112#2;   |QBF aAlfa1;
     aAlfa  = ("00000" + #dsam0112#1) % -105;
     aAlfa2 = aAlfa  % 102;
     aAlfa3 = aAlfa  % 303;

     aAlfa     = aAlfa2;
     aAlfa     = aAlfa + aAlfa3;
     aAlfa     = aAlfa + #dsam0112#3;
     aAlfa     = aAlfa + #dsam0112#7;
     aAlfa     = aAlfa + (#dsam0112#6 + "    ") % 104;
     aBusca2   = aAlfa;

     |HAZ ParaAsignados;
|FPRC;

|PROCESO DesAsignar;
     aAlfa  = aTexto2 % 105;

     #dsam0112#0 = #dsaw0038#0;
     #dsam0112#1 = aAlfa;
     |LEE 101#dsam0112.=;
     |SI FSalida = 0;
         |BORRA 020#dsam0112.a;
         |LIBERA #dsam0112;
     |FINSI;

     |LEE 000#dsam0112.a;
     |SI FSalida ! 0;
         |LEE 000#dsam0112.u;
     |FINSI;

     |SI FSalida ! 0;  |DDEFECTO #dsam0112;  |FINSI;

     aAlfa1 = #dsam0112#2;   |QBF aAlfa1;
     aAlfa  = ("00000" + #dsam0112#1) % -105;
     aAlfa2 = aAlfa  % 102;
     aAlfa3 = aAlfa  % 303;

     aAlfa     = aAlfa2;
     aAlfa     = aAlfa + aAlfa3;
     aAlfa     = aAlfa + #dsam0112#3;
     aAlfa     = aAlfa + #dsam0112#7;
     aAlfa     = aAlfa + (#dsam0112#6 + "    ") % 104;
     aBusca2   = aAlfa;

     |HAZ ParaAsignados;
|FPRC;

|| *************************************************************************

|PROCESO dsam0112B;
     |BORRA 020#dsam0112.a;
     |LIBERA #dsam0112;
|FPRC;

|DEFBUCLE dsam0112B;
     #dsam0112#1;
     ;
     #dsam0111#0, 00000
     #dsam0111#0, 99999;
     be;
     NULL, dsam0112B;
|FIN;

|PROCESO BorraDocumento;
     efFechaDocu = "00.00.0000";
     enCodUbica  = #dsam0111#2;  |HAZ LeeUbicaciones;
     eaExtension = eaExtension < "";

     aFicheroActu = #dsam0111#4;                              |QBF aFicheroActu;
     aFicheroActu = aFicheroActu + "." + eaExtension;    |QBF aFicheroActu;
     aAlfa        = eaRutaDocumento + "/" + aFicheroActu;
     |RFBORRA aAlfa;
|FPRC;

|PROCESO NuevoMailing;
     nModo = 1;
     |DDEFECTO #dsaw0038;

     |LEE 000#dsam0111.u;
     |SI FSalida ! 0;  |DDEFECTO #dsam0111;  |FINSI;

     #dsaw0038#0 = #dsam0111#0 + 1;

     |SI #dsaw0038#0 > 999;
         |PARA nCampo = 1;  |SI nCampo [ 1000;  |HACIENDO nCampo = nCampo + 1;
               #dsam0111#0 = nCampo;
               |LEE 000#dsam0111.=;
               |SI FSalida ! 0;
                   #dsaw0038#0 = #dsam0111#0;
                   |SAL;
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI #dsaw0038#0 > 999;
         |MENAV "0000 Ya tenemos 999 mailing creados, borre alguno que no use.";
         |ACABA;
     |FINSI;

     |DDEFECTO #dsam0111;

     |VENTANA 0501, 2799, nPanta, 17, "Nuevo Mailing";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#dsaw0038;
     nSubPanta = FSalida;

     |CONTROL_SIMPLE nSubPanta, "BOTON,{{202}}", 1549, 1751, Asignar;
     nSubBoton1 = FSalida;

     |CONTROL_SIMPLE nSubPanta, "BOTON,{{201}}", 2049, 2251, DesAsignar;
     nSubBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Editar documento en word", 2602, 2720, Editar;
     nSubBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{205}}Imprimir plantilla de variables", 2625, 2740, Plantilla;
     nSubBoton4 = FSalida;

     |C_M #dsaw0038#5, 1, "S";

     |PINDA #0#dsaw0038;

     aBusca1 = "";
     aBusca2 = "";
     |HAZ MontaArbolCampos;

     |ENDATOS #1#dsaw0038;
     |SI FSalida = 0;
         #dsam0111#0 = #dsaw0038#0;
         #dsam0111#1 = #dsaw0038#1;
         #dsam0111#2 = #dsaw0038#2;
         #dsam0111#3 = #dsaw0038#3;
         #dsam0111#4 = #dsaw0038#4;
         #dsam0111#5 = #dsaw0038#5;
         #dsam0111#6 = #dsaw0038#6;

         |GRABA 020#dsam0111.n;
         |LIBERA #dsam0111;
     |SINO;
         #dsam0111#0 = #dsaw0038#0;
         #dsam0111#2 = #dsaw0038#2;
         #dsam0111#4 = #dsaw0038#4;
         |BUCLE dsam0112B;
         |HAZ BorraDocumento;

         |LEE 000#dsam0111.u;
         #dsaw0038#0 = #dsam0111#0;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FIN_CONTROL_WINDOWS nTree1;
     |FIN_CONTROL_WINDOWS nTree2;
     |FIN_CONTROL_WINDOWS nSubBoton1;
     |FIN_CONTROL_WINDOWS nSubBoton2;
     |FIN_CONTROL_WINDOWS nSubBoton3;
     |FIN_CONTROL_WINDOWS nSubBoton4;

     nTree1 = -1;
     nTree2 = -1;

     |FINVENTANA nSubVent;

     aBusca = #dsaw0038#0;
     |HAZ MontaArbol;
|FPRC;

|PROCESO ModificarMailing;
     nModo = 2;

     #dsam0111#0 = aTexto;
     |LEE 101#dsam0111.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |DDEFECTO #dsaw0038;

     #dsaw0038#0  = #dsam0111#0;
     #dsaw0038#1  = #dsam0111#1;
     #dsaw0038#2  = #dsam0111#2;
     #dsaw0038#3  = #dsam0111#3;
     #dsaw0038#4  = #dsam0111#4;
     #dsaw0038#5  = #dsam0111#5;
     #dsaw0038#6  = #dsam0111#6;

     |VENTANA 0501, 2799, nPanta, 17, "Modificar Mailing";
     nSubVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#dsaw0038;
     nSubPanta = FSalida;

     |CONTROL_SIMPLE nSubPanta, "BOTON,{{202}}", 1549, 1751, Asignar;
     nSubBoton1 = FSalida;

     |CONTROL_SIMPLE nSubPanta, "BOTON,{{201}}", 2049, 2251, DesAsignar;
     nSubBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Editar documento en word", 2602, 2720, Editar;
     nSubBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{205}}Imprimir plantilla de variables", 2625, 2740, Plantilla;
     nSubBoton4 = FSalida;

     |C_M #dsaw0038#5, 1, "N";

     |PINDA #0#dsaw0038;

     aBusca1 = "";
     aBusca2 = "";
     |HAZ MontaArbolCampos;

     |ENDATOS #1#dsaw0038;
     |SI FSalida = 0;
         #dsam0111#1 = #dsaw0038#1;
         #dsam0111#2 = #dsaw0038#2;
         #dsam0111#3 = #dsaw0038#3;
         #dsam0111#4 = #dsaw0038#4;
         #dsam0111#5 = #dsaw0038#5;
         #dsam0111#6 = #dsaw0038#6;

         |GRABA 020#dsam0111.a;
         |LIBERA #dsam0111;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nSubVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FIN_CONTROL_WINDOWS nTree1;
     |FIN_CONTROL_WINDOWS nTree2;
     |FIN_CONTROL_WINDOWS nSubBoton1;
     |FIN_CONTROL_WINDOWS nSubBoton2;
     |FIN_CONTROL_WINDOWS nSubBoton3;
     |FIN_CONTROL_WINDOWS nSubBoton4;

     nTree1 = -1;
     nTree2 = -1;

     |FINVENTANA nSubVent;

     aBusca = #dsaw0038#0;
     |HAZ MontaArbol;
|FPRC;

|PROCESO BorrarMailing;
     #dsam0111#0 = aTexto;
     |LEE 101#dsam0111.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el mailing seleccionado";
     |SI FSalida ! 0;
         |LIBERA #dsam0111;
         |ACABA;
     |FINSI;

     |BUCLE dsam0112B;

     |BORRA 020#dsam0111.a;
     |LIBERA #dsam0111;

     |HAZ BorraDocumento;

     |LEE 000#dsam0111.p;
     aBusca = #dsam0111#0;
     |HAZ MontaArbol;
|FPRC;

|PROCESO EventoTree;
     |SI FEntrada ! 0;  |ACABA;  |FINSI;

     aAlfa       = Contenido;  |QBF aAlfa;
     aTexto      = "";
     aLong       = aAlfa % 0;
     nLong       = aLong;
     nCargar     = 0;
     |PARA nPosi = 1;  |SI nPosi [ nLong;  |HACIENDO nPosi = nPosi + 1;
           nPos = (nPosi * 100) + 1;
           aCarac = aAlfa % nPos;

           |SI nCargar = 1;
               aTexto = aTexto + aCarac;
           |FINSI;

           |SI aCarac = ":";  nCargar = 1; |FINSI;
     |SIGUE;

     |ESTADO_CONTROL nBoton2, "ENABLE";
     |ESTADO_CONTROL nBoton3, "ENABLE";

     aAlfa = aTexto % 102;
     |SI aTexto = "";
         |ESTADO_CONTROL nBoton2, "DISABLE";
         |ESTADO_CONTROL nBoton3, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO dsam0112;
     nCarpeta2 = nCarpeta2  + 1;

     aAlfa1 = #dsam0112#2;   |QBF aAlfa1;
     aAlfa2 = ("00000" + #dsam0112#1) % -105;
     aAlfa2 = "#" + (aAlfa2 % 102) + "#" + "0" + (aAlfa2 % 303);
     aAlfa3 = #dsam0112#3;   |QBF aAlfa3;

     aAlfa = nCarpeta1 + "," + nCarpeta2 + ":" + aAlfa2 + " - " + aAlfa3 + " (" + aAlfa1 + ")";
     |HAZ CargaArbol;
|FPRC;

|DEFBUCLE dsam0112;
     #dsam0112#1;
     ;
     #dsam0111#0, 00000;
     #dsam0111#0, 99999;
     ;
     NULL, dsam0112;
|FIN;

|PROCESO dsam0111;
     nCarpeta1 = nCarpeta1  + 1;

     aAlfa = nCarpeta1 + ":" + (("000" + #dsam0111#0) % -103) + " - " + #dsam0111#1;  |QBF aAlfa;
     aAlfa = aAlfa + " {{" + #dsam0111#0 + "}}";
     |HAZ CargaArbol;

     nCarpeta2 = 0;
     |BUCLE dsam0112;
|FPRC;

|DEFBUCLE dsam0111;
     #dsam0111#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsam0111;
|FIN;

|PROCESO MontaArbol;
     |SI nTree ! -1;
         |FIN_CONTROL_WINDOWS nTree;
         nTree = -1;
     |FINSI;

     |CONTROL_SIMPLE 0, "LABEL,{{5}}Cargando informaci¢n ...", 1315, 1680, NULL;
     nBotonLabel = FSalida;

     |PTEC 802;  |PAUSA;

     |DBASE aBase;  |QBF aBase;
     aAlfa = aBase + "tmp";          |MKDIR aAlfa;

     eaRutaOrigen  = aBase + "tmp/";
     eaRutaDestino = eaUnidadBasico + "\documentos";           |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp";       |RMKDIR eaRutaDestino;
     eaRutaDestino = eaUnidadBasico + "\documentos\tmp\";
     eaFicheroTxt  = "dsaz002201" + Usuario + ".txt";
     eaFicheroTgz  = "dsaz002201" + Usuario + ".tgz";
     eaFicheroTar  = "dsaz002201" + Usuario + ".tar";

     aAbre = eaRutaOrigen + eaFicheroTxt;

     sT_nID   = nTree;
     sT_nOper = 0;

     |XABRE "WB", aAbre, nHandle;

     nCarpeta1 = 0;

     |BUCLE dsam0111;

     |XCIERRA nHandle;

     |HAZ TraeTxtComprimido;
     aAlfa = eaRutaDestino + eaFicheroTxt;

     eaAlfa = "TREECTRL,Mailing {{" + aAlfa + "}}";
     |CONTROL_SIMPLE nPanta, eaAlfa, 0702, 2598, EventoTree;
     nTree = FSalida;

     eaFicheroTxt  = "dsaz002201" + Usuario + ".txt";
     aAlfa         = eaRutaDestino + eaFicheroTxt;
     |RFBORRA aAlfa;

     |FIN_CONTROL_WINDOWS nBotonLabel;

     |SI aBusca ! "";
         sT_nID   = nTree;
         sT_nOper = 3;
         sT_aData = "[" + aBusca;
         |ESPECIFICA "COMMANDCONTROL", sTree;
         aRefresca = ":" + FSalida;
     |FINSI;

     sT_nID   = nTree;
     sT_nOper = 2;
     |SI aRefresca = "";
         sT_aData = "1:";
     |SINO;
         sT_aData = aRefresca;
     |FINSI;

     |ESPECIFICA "COMMANDCONTROL", sTree;
     |PULSATECLA;

     |FOCOTECLADO nTree;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     FSalida = 2799;
|FPRC;

|PROGRAMA;
     |HAZ LeeUnidadBasico;

     |ABRET #dsam0111;
     |ABRET #dsam0112;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;   |QBT aIPRemoto;
     |SI aIPRemoto = "";
         aIPRemoto = "LOCAL";
         aNombreIP = "MAQUINA LOCAL";
     |SINO;
         |NOMBRE_IP aIPRemoto, aNombreIP;
     |FINSI;

     |CLS;
     |CABEZA "Mailing";

     |PINPA #0#dsaz0022;
     nPanta = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Nuevo Mailing", 2634, 2654, NuevoMailing;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar Mailing", 2656, 2676, ModificarMailing;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Borrar Mailing", 2678, 2698, BorrarMailing;
     nBoton3 = FSalida;

     |HAZ MontaArbol;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nTree;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nTree;
     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;

     |CIERRAT #dsam0111;
     |CIERRAT #dsam0112;
|FPRO;
