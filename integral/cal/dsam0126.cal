|FICHEROS;
     :integral/dsam0126;
     :laboral/nomconve;
     :laboral/nomconca;

     dsaw0039,MANTE;
     dsam126@;
|FIN;

|VARIABLES;
    aBase   = "";
    nCanal  = 0;
    aAlfa   = "";
    aAlfa1  = "";
    aAlfa2  = "";
    aPath   = "";
    nSalir  = 0;
    aDef    = "";

    nTecla  = 0;
    nBoton2 = 0;
    nBoton3 = 0;
    nBoton4 = 0;
    nBoton5 = 0;
    nBoton6 = 0;
    nBoton7 = 0;
    nBoton8 = 0;

    aDConve = "";
    aHConve = "";
    nDConve = 0;
    nHConve = 0;
    aObligado = "";
    nModo    = 0;

    &eaPathLaboral  = "";
|FIN;

|| /////////////////////////////////////////////////////////////////////
|PROCESO Leedsam0126;
     #dsam126@#2 = aObligado;
     |GRABA 020#dsam126@.a;
     |LIBERA #dsam126@;
|FPRC;

|DEFBUCLE Leedsam0126;
     #dsam126@#1001;
     ;
     aDConve;
     aHConve;
     ;
     NULL, Leedsam0126;
|FIN;

|PROCESO Leenomconve;
     #dsam126@#0 = #nomconve#0;
     |LEE 141#dsam126@.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam126@;
         #dsam126@#0 = #nomconve#0;
         |GRABA 020#dsam126@.b;
     |FINSI;
     #dsam126@#1 = #nomconve#1;
     #dsam126@#2 = aObligado;
     |GRABA 020#dsam126@.a;
     |LIBERA #dsam126@;
|FPRC;

|DEFBUCLE nomconve;
     #nomconve#1;
     ;
     aDConve;
     aHConve;
     e;
     NULL, Leenomconve;
|FIN;

|PROCESO Leenomconca;
   |DDEFECTO #nomconve;
   #nomconve#0 = #nomconca#142;
   |LEE 041#nomconve.=;
   aAlfa = #nomconve#1; |QBF aAlfa;
   |SI aAlfa = "";
       #nomconve#1 = #nomconca#1;
   |FINSI;
   |HAZ Leenomconve;
|FPRC;

|DEFBUCLE nomconca;
   #nomconca#1;
   ;
   nDConve;
   nHConve;
   ;
   NULL, Leenomconca;
|FIN;
|| /////////////////////////////////////////////////////////////////////

|PROCESO DConvenio; |TIPO 66;
    |SI Campo = 0; |O Campo = 1;
        |ABRE #nomconve;
        #nomconve#0 = #dsaw0039#Campo#;
        |CONSULTA_CLAVE #1#nomconve;
        #dsaw0039#Campo# = #nomconve#0;
        |PINTA #dsaw0039#Campo#;
        |CIERRA #nomconve;
    |FINSI;

    |SI Campo = 3; |O Campo = 4;
        |ABRE #nomconca;
        |CONSULTA_CLAVE #1#nomconca;
        #dsaw0039#Campo# = #nomconca#0;
        |PINTA #dsaw0039#Campo#;
        |CIERRA #nomconca;
    |FINSI;
|FPRC;

|PROCESO PedirDatos;

     nSalir = 1;
     |PUSHV 0501 2380;

     |DDEFECTO #dsaw0039;
     |PINPA #0#dsaw0039;
     aAlfa = "Recoger Convenios";
     |SI nTecla ] 14;
          aAlfa = "Marcar todos";
     |FINSI;
     |ATRI R; |PINTA 0818, aAlfa; |ATRI 0;

     aAlfa1 = "S"; aAlfa2 = "N";
     |SI nTecla = 12;  aAlfa2 = "S"; aAlfa1 = "N";  |FINSI;
     |C_V #dsaw0039#0, 1, aAlfa1;
     |C_V #dsaw0039#1, 1, aAlfa1;
     |C_V #dsaw0039#3, 1, aAlfa2;
     |C_V #dsaw0039#4, 1, aAlfa2;
     |PINDA #0#dsaw0039;
     |ENDATOS #1#dsaw0039;
     |SI FSalida = 0;
         aDConve = #dsaw0039#0;
         aHConve = #dsaw0039#1;
         aObligado = #dsaw0039#2;
         nDConve = #dsaw0039#3;
         nHConve = #dsaw0039#4;
         nSalir    = 0;
     |FINSI;
     |POPV;
|FPRC;
|| /////////////////////////////////////////////////////////////////////

|PROCESO ClaveBConvenio;
     #nomconca#0   = nDConve;
     #nomconca#142 = aDConve;
|FPRC;

|PROCESO ClaveAConvenio;
     #nomconca#0   = nHConve;
     #nomconca#142 = aHConve;
|FPRC;

||////////////////////////////////////////////////////////////////////////
|PROCESO MarcaTodos;
     |HAZ PedirDatos;
     |SI nSalir = 0;
         |BUCLE Leedsam0126;
     |FINSI;
|FPRC;

|PROCESO MarcaDatos;
   |LEE 141#dsam0126.=;
   |SI #dsam0126#2 = "S";
       #dsam0126#2 = "N";
   |SINO;
       #dsam0126#2 = "S";
   |FINSI;
   |PINTA #dsam0126#2;

   |GRABA 020#dsam0126.a;
   |LIBERA #dsam0126;
|FPRC;
|| /////////////////////////////

|| ... F4 y F5 Recoger de convenios propios
|PROCESO CargaNoOficial;
     nDConve = 001;
     nHConve = 999;
     aDConve = "              ";
     aHConve = "zzzzzzzzzzzzzz";
     |SI nTecla = 12;
         |HAZ PedirDatos;
     |SINO;
         |ABRE #nomconca;
         |CONSULTA_F_CLAVE #1#nomconca, ClaveBConvenio, ClaveAConvenio;
         nSalir = FSalida;
         |CIERRA #nomconca;
         nDConve = #nomconca#0;
         nHConve = #nomconca#0;
         aObligado = "S";
     |FINSI;
     |SI nSalir = 0;
         |ABRE #dsam126@;
         |ABRE #nomconve;
         |BUCLE nomconca;
         |CIERRA #nomconve;
         |CIERRA #dsam126@;
         #dsam0126#0 = #dsam126@#0;
     |FINSI;
|FPRC;

|| ... F2 y F3 Recoger de convenios Oficiales
|PROCESO CargaOficial;
     nSalir = 1;
     |SI nTecla = 10;
         |HAZ PedirDatos;
     |SINO;
         |ABRE #nomconve;
         #nomconve#0 = #dsam0126#0;
         |CONSULTA_CLAVE #1#nomconve;
         nSalir = FSalida;
         |CIERRA #nomconve;
         aDConve   = #nomconve#0;
         aHConve   = #nomconve#0;
         aObligado = "S";
     |FINSI;
     |SI nSalir = 0;
         |ABRE #dsam126@;
         |BUCLE nomconve;
         |CIERRA #dsam126@;
         #dsam0126#0 = #dsam126@#0;
     |FINSI;
|FPRC;

|| /////////////////////////////////////////////////////////////////////
|PROCESO Boton2m126;
     |PTEC 824;
|FPRC;

|PROCESO Boton3m126;
     |PTEC 825;
|FPRC;

|PROCESO Boton4m126;
     |PTEC 826;
|FPRC;

|PROCESO Boton5m126;
     |PTEC 827;
|FPRC;

|PROCESO Boton6m126;
     |PTEC 828;
|FPRC;

|PROCESO Boton7m126;
     |PTEC 829;
|FPRC;

|PROCESO Boton8m126;
     |PTEC 830;
|FPRC;

|PROCESO FinBotonm126;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton7;
     |FIN_CONTROL_WINDOWS nBoton8;
     |PULSATECLA;
|FPRC;

|PROCESO Tipo0m126;  |TIPO 0;
     |HAZ FinBotonm126;

     |ABRE #nomconve;
     #nomconve#0 = #dsam0126#0;
     |LEE 041#nomconve.=;
     |SI FSalida ! 0;
         |MENAV "0000No existe Convenio colectivo";
         |CIERRA #nomconve;
         |ACABA;
     |FINSI;
     |CIERRA #nomconve;

     #dsam0126#1 = #nomconve#1; |PINTA #dsam0126#1;
|FPRC;

|PROCESO Tipo7m126;  |TIPO 7;
     |BLIN 04;

     |CONTROL_SIMPLE 0, "LBOTON,F2 Recoger Convenios Oficiales", 0601, 0620, Boton2m126;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F3 Busca Convenio Oficial", 0701, 0720, Boton3m126;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F4 Recoger convenios propios", 0621, 0640, Boton4m126;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F5 Buscar convenio propio", 0721, 0740, Boton5m126;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F6 Obligado SI/NO masivo", 0641, 0660, Boton6m126;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F7 Obligado SI/NO", 0741, 0760, Boton7m126;
     nBoton7 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,F8 Consulta convenios con Cod.Oficial ", 0661, 0780, Boton8m126;
     nBoton8 = FSalida;
|FPRC;

|PROCESO Tipo11m126;  |TIPO 11;
     nTecla = FSalida;

     |HAZ FinBotonm126;

     |SI nTecla = 10; |O nTecla = 11;   || F2/F3
         |HAZ CargaOficial;
         |PONCONTROL  23, "SI";
         |ACABA;
     |FINSI;

     |SI nTecla = 12; |O nTecla = 13;   || F4/F5
         |HAZ CargaNoOficial;
         |PONCONTROL  23, "SI";
         |ACABA;
     |FINSI;

     |SI nTecla = 14;
         |HAZ MarcaTodos;
         |PONCONTROL  23, "SI";
         |PTEC 812;
         |ACABA;
     |FINSI;

     |SI nTecla = 15;
         |HAZ MarcaDatos;
         |PONCONTROL  23, "SI";
         |PTEC 812;
         |ACABA;
     |FINSI;

     |SI nTecla = 16;
         nDConve = 001;
         nHConve = 999;
         aDConve = #dsam0126#0;
         aHConve = #dsam0126#0;

         |ABRE #nomconca;
         |CONSULTA_F_CLAVE #3#nomconca, ClaveBConvenio, ClaveAConvenio;
         |CIERRA #nomconca;
     |FINSI;
|FPRC;

|PROCESO ClaveBaja;
     #dsam0126#0 = "              ";
|FPRC;

|PROCESO ClaveAlta;
     #dsam0126#0 = "zzzzzzzzzzzzzz";
|FPRC;

|PROGRAMA;
     eaPathLaboral = "";

     |DBASS aBase;

     aAlfa = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathLaboral   = aBase + "laboral/";
     |SINO;
         |MENAV "0000No existe laboral";
         |ACABA;
     |FINSI;
     aPath = eaPathLaboral + "fich/";
     |PATH_DAT #nomconve#aPath#;
     |PATH_DAT #nomconca#aPath#;

     |DBASE aBase;
     aDef = aBase + "def/dsam0126";
     |CARGA_DEF aDef, dsam126@;
     |SI FSalida ! 0;
         |MENAV "0000Error cargando dsam0126";
         |ACABA;
     |FINSI;

     |CLS;
     |PINPA #0#dsam0126;

     |ENTLINEAL #1#dsam0126, -1, 4, 21, 0, ClaveBaja, ClaveAlta;

     |DESCARGA_DEF #dsam126@;
|FPRO;
