|FICHEROS;
     :/integral/def/dsam0019 #0;
     :/integral/def/dsam0017 #17;
     temp0001@ #500;
     :/laboral/def/labtraba #21;
     :/laboral/def/nomconli #22;
|FIN;

|VARIABLES;
     aAlfa = "";
     nModo = 0;
     nPos1 = 0;
     nPos2 = 0;
     nEmp = 0;
     nTra = 0;
     nEmpCop = 0;
     nTraCop = 0;

     nEmpresa = 0;
     nTrabajador = 0;
     &eaPathLaboral = "";
     aPathLaboral = "";
     nConvenio = 0;
|FIN;

|| paso, de momento
/*
|PROCESO CopiaCon;
     #nomembcf#0 = nEmp;
     #nomembcf#1 = nTra;
     #nomembcf#2 = #nomembcf#2;
     |GRABA 000#nomembcf.n;
|FPRC;

|DEFBUCLE CopiaCon;
     #nomembcf#1;
     ;
     nEmpCop, nTraCop, 101;
     nEmpCop, nTraCop, 999;
     ;
     NULL, CopiaCon;
|FIN;

|PROCESO BorraCon;
     |BORRA 000#nomembcf.a;
|FPRC;

|DEFBUCLE BorraCon;
     #nomembcf#1;
     ;
     nEmp, nTra, 101;
     nEmp, nTra, 999;
     ;
     NULL, BorraCon;
|FIN;

|PROCESO Copia;
     |PUSHV 18512169;
     |BLANCO 18512169;
     |CUADRO 17492271;
     |PINTA 1951, "                    ";
     |PINTA 2051, "                    ";
     |PINTA 2151, "                    ";
     |ATRI R;
                || 5        6
                || 1234567890123456789
     |PINTA 1851, "COPIA DE CONCEPTOS ";
     |ATRI 0;
     |PINTA 1951, "Empresa ....:      ";
     E_sup = 99999; E_inf = "";
     nEmpCop = 1965 ? 0;
     |PINTA 2051, "Trabajador .:      ";
     E_sup = 99999; E_inf = "";
     nTraCop = 2065 ? 0;
     |PINTA 2151, "Correcto S/N:      ";
     E_sup = 1; E_inf = "SN";
     aAlfa = 2165 ? 0;

     |SI aAlfa = "S";
          nEmp = #nomembca#0;
          nTra = #nomembca#1;
          |BUCLE BorraCon;
          |BUCLE CopiaCon;
          #nomembcf#0 = nEmp;
          #nomembcf#1 = nTra;
          #nomembcf#2 = 101;
          |LEE 000#nomembcf.];
          |PONCONTROL 23, "si";
     |FINSI;

     |POPV;
|FPRC;
*/

|PROCESO labtraba_1;
     nEmpresa = #labtraba#0;
     nTrabajador = #labtraba#1;
     nConvenio = #labtraba#87;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#2;
     44;
     #17#1, "A";
     #17#1, "A";
     ;
     NULL, labtraba_1;
|FIN;

|PROCESO Comprueba; |TIPO 0;
     |DBASS aAlfa;
     |QBF aAlfa;
     aPathLaboral = eaPathLaboral + "fich/";
     |PATH_DAT #21 aPathLaboral;
     |PATH_DAT #22 aPathLaboral;

     nTrabajador = 0;
     nConvenio = 0;
     |BUCLE labtraba;
     |SI nTrabajador = 0;
          |MENAV "    No se ha encontrado un trabajador de alta con este NIF";
          |ACABA;
     |FINSI;

     |ABRE #nomconli;
     #nomconli#0 = nConvenio;
     #nomconli#2 = #0#3;
     |LEE 000#nomconli.=;
     |SI FSalida = 0; |O #0#3 > 900;
          |SI #0#3 < 900;
               #0#4 = #nomconli#6;
          |SINO;
               |SI #0#3 = 906; #0#4 = "Anticip1"; |FINSI;
               |SI #0#3 = 907; #0#4 = "Anticip2"; |FINSI;
               |SI #0#3 = 908; #0#4 = "Especie1"; |FINSI;
               |SI #0#3 = 923; #0#4 = "Especie2"; |FINSI;
               |SI #0#3 = 924; #0#4 = "Especie3"; |FINSI;
               |SI #0#3 = 926; #0#4 = "Anticip3"; |FINSI;
          |FINSI;
          |PINTA #0#4;
     |SINO;
          aAlfa = "    ATENCION: Concepto no Definido en convenio. Pulse F5 ";
          aAlfa = aAlfa + "para consultar.";
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
     |CIERRA #nomconli;
|FPRC;

|PROCESO BuscaCon; |TIPO 11;
     |DBASS aAlfa;
     |QBF aAlfa;
     aPathLaboral = eaPathLaboral + "fich/";
     |PATH_DAT #21 aPathLaboral;
     |PATH_DAT #22 aPathLaboral;

     |SI FSalida = 13;
          |BUCLE labtraba;
          |SI nTrabajador = 0;
               |MENAV "    No se ha encontrado un trabajador de alta con este NIF";
               |ACABA;
          |FINSI;

          aAlfa = "SELECT nomconli.2,nomconli.6 FROM nomconli INTO tm" + Usuario;
          aAlfa = aAlfa + ".def WHERE 0 == " + nConvenio;
          |SQL aAlfa;
          |SI FSalida ! 0;
               |MENAV "    No hay definidos conceptos en el convenio";
               |ERROR;
               |ACABA;
          |FINSI;
          |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "laboral/def/tm" + Usuario + ".mas";
          |CARGA_DEF aAlfa, temp0001@;
          |SI FSalida = 0;
               aAlfa = "tm" + Usuario; |NOME_DAT #500 aAlfa;
               |ABRE #temp0001@;
               nModo = 2 + 4 + 8 + 16;
               nPos1 = 1250; nPos2 = 2380;
               |C_V #temp0001@#0, 1, "S";
               |C_V #temp0001@#1, 1, "S";
               |LINEAL_SIMPLE #1#temp0001@,nModo, nPos1, nPos2, NULL, NULL, NULL;
               |SI FSalida = 0;
                    #0#3 = #temp0001@#0;
                    |PINTA #0#3;
                    #0#4 = #temp0001@#1;
                    |PINTA #0#4;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #temp0001@;
               |DELINDEX #temp0001@;
               |DESCARGA_DEF #temp0001@;
          |FINSI;
          |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/tm" + Usuario + ".mas";
          |FBORRA aAlfa;
          |ACABA;
     |FINSI;
/*
     || paso, de momento
     |SI FSalida = 14;
          |HAZ Copia;
     |FINSI;
*/
|FPRC;
