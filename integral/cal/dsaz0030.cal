|FICHEROS;
    dsaz0030;

    dsam0000;
    dsam0024;
    dsam0105;
    dsam0110;

    dsaw0013;
    dsat0001;

    facemp@;
|FIN;

|VARIABLES;
     aAlfa  = "";
     aFichero  = "";

     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nGraba    = 0;

     nImport1  = 0;
     nImport2  = 0;
     fFecha    = @;
     fDFecha   = @;
     fHFecha   = @;
     nEmpresa  = 0;
     nEjer     = 0;
     nAlgun    = 0;

     &eaFichero  = "";
     &eaDLiqu    = "";
     &eaHLiqu    = "";
     &aFuncion   = "";
     &enEjer     = 0;
     &enEmpresa  = 0;
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &enDMes     = 0;
     &eaDMes     = "";
     &enHMes     = 0;
|FIN;

|CALCULO DMes; |TIPO 0;
    enDMes = #dsaz0030#1;
    |SI enDMes = 1;  #dsaz0030#2 = "Enero     "; |FINSI;
    |SI enDMes = 2;  #dsaz0030#2 = "Febrero   "; |FINSI;
    |SI enDMes = 3;  #dsaz0030#2 = "Marzo     "; |FINSI;
    |SI enDMes = 4;  #dsaz0030#2 = "Abril     "; |FINSI;
    |SI enDMes = 5;  #dsaz0030#2 = "Mayo      "; |FINSI;
    |SI enDMes = 6;  #dsaz0030#2 = "Junio     "; |FINSI;
    |SI enDMes = 7;  #dsaz0030#2 = "Julio     "; |FINSI;
    |SI enDMes = 8;  #dsaz0030#2 = "Agosto    "; |FINSI;
    |SI enDMes = 9;  #dsaz0030#2 = "Septiembre"; |FINSI;
    |SI enDMes = 10; #dsaz0030#2 = "Octubre   "; |FINSI;
    |SI enDMes = 11; #dsaz0030#2 = "Noviembre "; |FINSI;
    |SI enDMes = 12; #dsaz0030#2 = "Diciembre "; |FINSI;
    |PINTA #dsaz0030#2;
    eaDMes = #dsaz0030#2;
|FCAL;

|CALCULO HEmpresa; |TIPO 0;
    |SI #dsaz0030#4 < #dsaz0030#3;
        |MENAV "0000Error. Hasta Empresa inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HCliente; |TIPO 0;
    |SI #dsaz0030#6 < #dsaz0030#5;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HAgente; |TIPO 0;
    |SI #dsaz0030#8 < #dsaz0030#7;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|| *******************************************************************
|PROCESO GrabaAuxiliar1;
    #dsam0110#0 = #dsam0024#3;
    |LEE 041#dsam0110.=;
    |SI FSalida ! 0; |ACABA; |FINSI;
    |SI #dsam0110#3 ! "S"; |ACABA; |FINSI;

    #dsat0001#0 = aFuncion;
    #dsat0001#1 = #dsam0024#3;
    #dsat0001#2 = #dsam0024#1;
    #dsat0001#3 = #dsam0024#2;
    #dsat0001#4 = nEmpresa;
    |LEE 141#dsat0001.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsat0001;
        #dsat0001#0 = aFuncion;
        #dsat0001#1 = #dsam0024#3;
        #dsat0001#2 = #dsam0024#1;
        #dsat0001#3 = #dsam0024#2;
        #dsat0001#4 = nEmpresa;
        #dsat0001#7  = #dsam0024#10;
        #dsat0001#8  = #dsam0024#11;
        #dsat0001#18 = #dsam0024#12;
        |GRABA 020#dsat0001.b;
    |FINSI;
    #dsat0001#5  = #dsam0024#4;
    #dsat0001#6  = #dsam0000#1;
    #dsat0001#9  = #dsam0024#13;
    #dsat0001#10 = #dsam0024#14;
    #dsat0001#11 = #dsam0024#15;
    #dsat0001#19 = #dsam0024#16;
    #dsat0001#12 = #dsam0024#17;
    #dsat0001#13 = #dsam0024#18;
    #dsat0001#14 = #dsam0024#19;
    #dsat0001#20 = #dsam0000#3;

    |SI #dsat0001#9 = "N";
        #dsat0001#11 = (#dsat0001#7 % #dsat0001#8 ) ! 2;
        #dsat0001#19 = (#dsat0001#7 % #dsat0001#18) ! 2;
    |FINSI;

    #dsat0001#15 = #dsam0000#72;
    #dsat0001#16 = #dsam0000#52;
    #dsat0001#17 = " ";

    |SI #dsaz0030#10 = "T";  #dsat0001#17 = "*";  |FINSI;
    |SI #dsaz0030#10 = "S";
        |SI #dsat0001#11 ! 0; |O #dsat0001#19 ! 0;
            #dsat0001#17 = "*";
        |FINSI;
    |FINSI;

    |GRABA 020#dsat0001.a;
    |LIBERA #dsat0001;

    nGraba = 1;
    nImport1  = #dsat0001#11;
    nImport2  = #dsat0001#19;
    |HAZ GrabaAuxiliar2;
|FPRC;

|DEFBUCLE dsam0024;
   #dsam0024#1;
   3,13;
   nEmpresa, enEjer, enDMes, #dsaz0030#3, eaDLiqu;
   nEmpresa, enEjer, enHMes, #dsaz0030#4, eaHLiqu;
   e;
   NULL, GrabaAuxiliar1;
|FIN;

|PROCESO LeoDsam0000;
   nEmpresa = #dsam0000#0;
   |BUCLE dsam0024;
|FPRC;

|DEFBUCLE dsam0000;
   #dsam0000#1;
   122,72;
   #dsaz0030#5, "S", enDAgente;
   #dsaz0030#6, "S", enHAgente;
   e;
   NULL, LeoDsam0000;
|FIN;

|PROCESO GrabaAuxiliar2;
   #dsaw0013#0 = aFuncion;
   #dsaw0013#1 = enEjer;
   #dsaw0013#2 = #dsam0110#0;
   |LEE 041#dsaw0013.=;
   |SI FSalida ! 0;
       |DDEFECTO #dsaw0013;
       #dsaw0013#0 = aFuncion;
       #dsaw0013#1 = enEjer;
       #dsaw0013#2 = #dsam0110#0;
       #dsaw0013#3 = #dsam0110#2;
       #dsaw0013#6 = #dsam0110#10;
       #dsaw0013#7 = #dsam0110#8;
       #dsaw0013#8 = #dsam0110#9;
       |GRABA 020#dsaw0013.c;
   |FINSI;
   |SI nGraba = 1;
       #dsaw0013#4 = #dsaw0013#4 + nImport1;
       #dsaw0013#5 = #dsaw0013#5 + nImport2;
   |FINSI;
   #dsaw0013#9  = #dsaz0030#1;
   #dsaw0013#10 = #dsaz0030#2;

   |GRABA 020#dsaw0013.a;
   nAlgun = 1;
|FPRC;

|DEFBUCLE dsam0110;
   #dsam0110#1;
   3;
   #dsaz0030#3, "S";
   #dsaz0030#4, "S";
   e;
   NULL, GrabaAuxiliar2;
|FIN;

|PROCESO VerSiHayAlgo;
  nAlgun = 1;
  |ERROR10;
|FPRC;

|DEFBUCLE VerSiHayAlgo;
   #dsat0001#1;
   17;
   aFuncion, #dsaz0030#3, enEjer, enDMes, enDEmpresa, "*";
   aFuncion, #dsaz0030#4, enEjer, enHMes, enHEmpresa, "*";
   ;
   NULL, VerSiHayAlgo;
|FIN;

|PROCESO ClaveBaja999;
   #dsaw0013#0 = aFuncion;
   #dsaw0013#1 = enEjer;
   #dsaw0013#2 = #dsaz0030#3;
|FPRC;

|PROCESO ClaveAlta999;
   #dsaw0013#0 = aFuncion;
   #dsaw0013#1 = enEjer;
   #dsaw0013#2 = #dsaz0030#4;
|FPRC;

|PROCESO PanFuncionB;
   |PINPA #0#dsat0001;
   |ATRI R;
   |PINTA 0538, "Prevencion de Riesgos Laborables";
   |PINTA 0711, "PR";
   |ATRI 0;
   |PINTA 1216, "ÂÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
   |PINTA 1316, "³ Ag ³Importe pagado³ %  Cuota Prev.Ries.  %  Cuota Vig.Salud";
   |PINTA 1416, "³    ³              ³                      ";
   |PINTA 1516, "³    ³              ³                      ";
   |PINTA 1616, "³    ³              ³                      ";
   |PINTA 1716, "³    ³              ³                      ";
   |PINTA 1816, "³    ³              ³                      ";
   |PINTA 1916, "³    ³              ³                      ";
   |PINTA 2016, "³    ³              ³                      ";
   |PINTA 2116, "³    ³              ³                      ";
   |PINTA 2216, "³    ³              ³                      ";
   |PINTA 2316, "ÁÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
   |ATRI R;
   |PINTA 1317, " Ag ";
   |PINTA 1322, "Importe pagado";
   |PINTA 1337, " %  Cuota Prev.Ries.  %  Cuota Vig.Salud";
   |ATRI 0;

   |C_V #dsaw0013#5, 1, "S";

   |C_V #dsat0001#18, 1, "S";
   |C_V #dsat0001#19, 1, "S";

   |C_P #dsat0001#4,  1, 1410;
   |C_P #dsat0001#15, 1, 1418;
   |C_P #dsat0001#7,  1, 1423;
   |C_P #dsat0001#8,  1, 1437;
   |C_P #dsat0001#11, 1, 1444;

   |C_L #dsat0001#6,  1, "N";
   |C_A #dsat0001#6,  1, 40;
   |C_P #dsat0001#6,  1, 2408;
|FPRC;

|PROCESO ProcesoZ030;

     aFichero = ("3y" + Usuario) % 108;
     |NOME_DAT #dsaw0013#aFichero#;
     |DELINDEX #dsaw0013;

     eaFichero = ("4y" + Usuario) % 108;
     |NOME_DAT #dsat0001#eaFichero#;
     |DELINDEX #dsat0001;

     aAlfa1 = #dsaz0030#0;
     aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
     aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

     enEjer  = #dsaz0030#0;
     eaDLiqu = #dsaz0030#9;
     eaHLiqu = #dsaz0030#9;
     |SI #dsaz0030#9 = "T";
         eaDLiqu = " ";
         eaHLiqu = "z";
     |FINSI;
     enDEmpresa = #dsaz0030#5;
     enHEmpresa = #dsaz0030#6;
     enDAgente  = #dsaz0030#7;
     enHAgente  = #dsaz0030#8;
     enDMes     = #dsaz0030#1;
     enHMes     = #dsaz0030#1;
     eaDMes     = #dsaz0030#2;

     |ABRE #dsaw0013;
     |ABRE #dsat0001;

     nAlgun = 0;
     nGraba = 0; |BUCLE dsam0110;

     |ABRE #dsam0110;
     |BUCLE dsam0000;
     |CIERRA #dsam0110;

     |CIERRA #dsat0001;
     |CIERRA #dsaw0013;

     |SI nAlgun = 1;
         |PARA; |SI nAlgun = 1; |HACIENDO;
                |HAZ PanFuncionB;
                |ENTLINEAL #1#dsaw0013, -3, 4, 22, 0, ClaveBaja999, ClaveAlta999;
                nAlgun = 0;
                |BUCLE VerSiHayAlgo;
                |SI nAlgun = 1;
                    |MENAV "0000Hay registros marcados sin actualizar";
                    |CONFI "0000SDesea NO actualizarlos y salir del programa";
                    |SI FSalida = 0;
                        nAlgun = 0;
                    |FINSI;
                |FINSI;
         |SIGUE;
     |SINO;
         |MENAV "0000Seleccion vacia";
     |FINSI;

     |DELINDEX #dsaw0013;
|FPRC;

|PROGRAMA;

    aFuncion = "B";

    |CLS;
    |CABEZA "Calculo Comision";

    fFecha = ~;
    aAlfa  = fFecha;
    aAlfa  = aAlfa % -104;
    #dsaz0030#0 = aAlfa;

    |PINPA #0#dsaz0030;
    |PINDA #0#dsaz0030;

    |ENDATOS #2#dsaz0030;
    |SI FSalida = 0;
        |HAZ ProcesoZ030;
    |FINSI;
|FPRO;
