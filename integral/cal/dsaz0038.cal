|FICHEROS;
    dsaz0038;
    dsam0000;
    dsam0026;

    dsam0027;
    dsam0028;
    dsam0029;

    dsat0008,MANTE;
    dsat0009;

    dsam0127;
    dsam0128;
|FIN;

|VARIABLES;

     aFichero    = "";
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     nPara1      = 0;
     nGraba      = 0;
     nOpera      = 0;
     nExiste     = 0;

     fFecha      = @;
     fDFecha     = @;
     fHFecha     = @;
     nEmpresa    = 0;
     nEjer       = 0;
     nMes        = 0;
     nAlgun      = 0;
     nError      = 0;
     aAny        = "";
     aMes        = "";
     aTParImpar  = "";
     nExpediente = 0;
     nDMes       = 0;
     nHMes       = 0;
     nDEjer      = 0;
     nHEjer      = 0;
     nInkey      = 0;
     nOpcion     = 0;
     &eaFichero  = "";
     &eaFicher1  = "";
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &enDMes     = 0;
     &eaParam    = "";

     &eaNomEmpresa = "";
     &enAgeEmpresa = 0;
     &eaAgeEmpresa = "";
     &eaTelEmpresa = "";
     &eaEmaEmpresa = "";
     &eaMovEmpresa = "";
|FIN;

|INCLUYE i_varfun;

|CALCULO HMes; |TIPO 0;
    |SI #dsaz0038#1 = 1;  #dsaz0038#2 = "Enero     "; |FINSI;
    |SI #dsaz0038#1 = 2;  #dsaz0038#2 = "Febrero   "; |FINSI;
    |SI #dsaz0038#1 = 3;  #dsaz0038#2 = "Marzo     "; |FINSI;
    |SI #dsaz0038#1 = 4;  #dsaz0038#2 = "Abril     "; |FINSI;
    |SI #dsaz0038#1 = 5;  #dsaz0038#2 = "Mayo      "; |FINSI;
    |SI #dsaz0038#1 = 6;  #dsaz0038#2 = "Junio     "; |FINSI;
    |SI #dsaz0038#1 = 7;  #dsaz0038#2 = "Julio     "; |FINSI;
    |SI #dsaz0038#1 = 8;  #dsaz0038#2 = "Agosto    "; |FINSI;
    |SI #dsaz0038#1 = 9;  #dsaz0038#2 = "Septiembre"; |FINSI;
    |SI #dsaz0038#1 = 10; #dsaz0038#2 = "Octubre   "; |FINSI;
    |SI #dsaz0038#1 = 11; #dsaz0038#2 = "Noviembre "; |FINSI;
    |SI #dsaz0038#1 = 12; #dsaz0038#2 = "Diciembre "; |FINSI;
|FCAL;
|| *******************************************************************

|PROCESO LosTransportes;
    |SI nOpcion = 1;
        #dsam0028#0 = eaFun07;
        #dsam0028#1 = nExpediente;
        #dsam0028#2 = #dsat0009#1;
        |LEE 141#dsam0028.=;
        |SI FSalida ! 0;
            |DDEFECTO #dsam0028;
            #dsam0028#0 = eaFun07;
            #dsam0028#1 = nExpediente;
            #dsam0028#2 = #dsat0009#1;
            |GRABA 020#dsam0028.b;
        |FINSI;
        #dsam0028#3 = #dsat0009#0;
        #dsam0028#4 = #dsat0009#2;
        #dsam0028#5 = #dsat0009#3;
        #dsam0028#6 = #dsaz0038#1;
        #dsam0028#7 = #dsaz0038#0;
        #dsam0028#8 = #dsat0009#7;
        #dsam0028#9 = #dsat0009#8;
        |GRABA 020#dsam0028.a;
        |LIBERA #dsam0028;

        |SI #dsat0009#5 = 0;
            #dsam0026#0 = #dsat0009#0;
            #dsam0026#1 = #dsat0009#1;
            |LEE 141#dsam0026.=;
            |SI FSalida = 0;
                #dsam0026#5 = #dsaz0038#1;
                #dsam0026#6 = #dsaz0038#0;
                |GRABA 020#dsam0026.a;
            |FINSI;
            |LIBERA #dsam0026;
        |FINSI;
    |FINSI;

    |SI nOpcion = 2;
        #dsam0026#0 = #dsat0009#0;
        #dsam0026#1 = #dsat0009#1;
        |LEE 141#dsam0026.=;
        |SI FSalida = 0;
            |SI #dsat0008#26 = "B";
                #dsam0026#8  = "B";
                #dsam0026#10 = #dsat0008#22;
                #dsam0026#11 = #dsat0008#23;
            |SINO;
                |SI #dsam0026#8 = "A";
                    #dsam0026#5 = #dsat0008#24;
                    #dsam0026#6 = #dsat0008#25;
                |FINSI;
            |FINSI;
            |GRABA 020#dsam0026.a;
        |FINSI;
        |LIBERA #dsam0026;
    |FINSI;

    |BORRA 041#dsat0009.a;
    |LIBERA #dsat0009;
|FPRC;

|DEFBUCLE LosTransportes;
  #dsat0009#1;
  ;
  #dsat0008#21, #dsat0008#20, #dsat0008#0, "          ";
  #dsat0008#21, #dsat0008#20, #dsat0008#0, "zzzzzzzzzz";
  ;
  NULL, LosTransportes;
|FIN;

|PROCESO AbrirExped;

      nExpediente = 0;
      #dsam0029#0 = eaFun07;
      #dsam0029#1 = 99999999;
      |LEE 041#dsam0029.];
      |SI FSalida = 0;
          |LEE 141#dsam0029.a;
      |SINO;
          |LEE 141#dsam0029.u;
      |FINSI;
      |SI FSalida = 0; |Y #dsam0029#0 = eaFun07;
          nExpediente = #dsam0029#1;
      |FINSI;
      |LIBERA #dsam0029;

      #dsam0027#0 = eaFun07;
      #dsam0027#1 = 99999999;
      |LEE 041#dsam0027.];
      |SI FSalida = 0;
          |LEE 141#dsam0027.a;
      |SINO;
          |LEE 141#dsam0027.u;
      |FINSI;
      |SI FSalida = 0; |Y #dsam0027#0 = eaFun07;
          |SI nExpediente < #dsam0027#1;
              nExpediente = #dsam0027#1;
          |FINSI;
      |FINSI;
      |LIBERA #dsam0027;

      nExpediente = nExpediente + 1;

      #dsam0027#0 = eaFun07;
      #dsam0027#1 = nExpediente;
      |LEE 141#dsam0027.=;
      |SI FSalida ! 0;
          |DDEFECTO #dsam0027;
          #dsam0027#0 = eaFun07;
          #dsam0027#1 = nExpediente;
          |GRABA 020#dsam0027.b;
      |FINSI;
      #dsam0027#2  = #dsat0008#10;
      #dsam0027#3  = #dsaz0038#1;
      #dsam0027#4  = #dsaz0038#0;
      #dsam0027#5  = #dsat0008#0;
      #dsam0027#6  = #dsat0008#1;
      #dsam0027#7  = #dsat0008#2;
      #dsam0027#9  = #dsat0008#11;
      #dsam0027#10 = #dsat0008#12;
      #dsam0027#11 = #dsat0008#13;
      #dsam0027#12 = #dsat0008#14;
      #dsam0027#13 = #dsat0008#15;
      #dsam0027#14 = #dsat0008#16;
      #dsam0027#15 = #dsat0008#17;
      #dsam0027#30 = #dsat0008#3;
      #dsam0027#31 = #dsat0008#5;

      |DDEFECTO #dsam0128;
      #dsam0128#0 = #dsam0027#15;
      |LEE 041#dsam0128.=;
      #dsam0027#16 = #dsam0128#2;
      #dsam0027#17 = #dsam0128#4;
      #dsam0027#18 = #dsam0128#5;
      #dsam0027#19 = #dsat0008#18;
      #dsam0027#20 = #dsam0128#7;
      #dsam0027#21 = #dsam0128#8;
      #dsam0027#22 = #dsat0008#19;
      |GRABA 020#dsam0027.a;

      nOpcion = 1; |BUCLE LosTransportes;

      |LIBERA #dsam0027;
|FPRC;

|PROCESO CancelarExped;
      nOpcion = 2; |BUCLE LosTransportes;
|FPRC;

|PROCESO LeeAuxiliar;
   |SI nOpera = 1;
       nExiste = 1;
       |SI #dsat0008#8 ! "X";
           nExiste = 2;
           |ERROR10;
       |FINSI;
   |FINSI;

   |SI nOpera = 0;
       |SI #dsat0008#8 ! "X";

           |SI #dsat0008#8 = "A"; |HAZ AbrirExped;    |FINSI;
           |SI #dsat0008#8 = "C"; |HAZ CancelarExped; |FINSI;

           |BORRA 041#dsat0008.a;
       |FINSI;
       |SI #dsat0008#8 =  "X"; nAlgun = 1; |FINSI;
   |FINSI;
   |LIBERA  #dsat0008;
|FPRC;

|DEFBUCLE LeeAuxiliar;
  #dsat0008#2;
  ;
  #dsaz0038#0, #dsaz0038#1, 00000000;
  #dsaz0038#0, #dsaz0038#1, 99999999;
  be;
  NULL, LeeAuxiliar;
|FIN;

|PROCESO LaActualizacion;

    nExiste = 0;
    nOpera = 1; |BUCLE LeeAuxiliar; nOpera = 0;
    |SI nExiste = 0;
        |BORRA 020#dsaz0038.a;
        |ACABA;
    |FINSI;

    |SI nExiste = 1; |ACABA; |FINSI;
    |CONFI "0000SDesea actualizar los datos";
    |SI FSalida = 0;
        nAlgun = 0;
        |ABRE #dsam0026;
        |ABRE #dsam0027;
        |ABRE #dsam0029;
        |ABRE #dsam0028;
        |ABRE #dsam0128;
        |BUCLE LeeAuxiliar;
        |CIERRA #dsam0128;
        |CIERRA #dsam0028;
        |CIERRA #dsam0029;
        |CIERRA #dsam0027;
        |CIERRA #dsam0026;
        |SI nAlgun = 0;
            |BORRA 041#dsaz0038.a;
        |FINSI;
        |LIBERA #dsaz0038;
    |FINSI;
|FPRC;

|PROCESO ClaveBaja8;
    #dsat0008#21 = #dsaz0038#0;
    #dsat0008#20 = #dsaz0038#1;
    #dsat0008#0  = enDEmpresa;
|FPRC;

|PROCESO ClaveAlta8;
    #dsat0008#21 = #dsaz0038#0;
    #dsat0008#20 = #dsaz0038#1;
    #dsat0008#0  = enHEmpresa;
|FPRC;

|PROCESO Verdsat0008;
    |ENTLINEAL #1#dsat0008, -3, 4, 22, 0, ClaveBaja8, ClaveAlta8;
    |HAZ LaActualizacion;
|FPRC;

|PROCESO Tipo11z038; |TIPO 11;
   nInkey = FSalida;
   enMesRen = #dsaz0038#1;
   enEjeRen = #dsaz0038#0;
   |SI nInkey = 10;
       |HAZ Verdsat0008;
       |PONCONTROL 23, "SI";
   |FINSI;

   |SI nInkey = 11;
       |HAZ LaActualizacion;
       |PONCONTROL 23, "SI";
   |FINSI;
|FPRC;

|PROCESO ClaveBaja9N;
    #dsat0009#5 = #dsat0008#20;
    #dsat0009#6 = #dsat0008#21;
    #dsat0009#0 = #dsat0008#0;
    #dsat0009#1 = "          ";
|FPRC;

|PROCESO ClaveAlta9N;
    #dsat0009#5 = #dsat0008#20;
    #dsat0009#6 = #dsat0008#21;
    #dsat0009#0 = #dsat0008#0;
    #dsat0009#1 = "zzzzzzzzzz";
|FPRC;

|PROCESO Tipo7z038; |TIPO 7;
   |ENTLINEAL #1#dsat0008, -3, 7, 22, 0, ClaveBaja8, ClaveAlta8;

   |ABRE #dsat0008;
   #dsat0008#0 = 1;
   #dsat0008#20 = #dsaz0038#1;
   #dsat0008#21 = #dsaz0038#0;
   |LEE 041#dsat0008.];
   |SI #dsat0008#20 = #dsaz0038#1; |Y #dsat0008#21 = #dsaz0038#0;
       |PINDA #0#dsat0008;
       |ENTLINEAL #1#dsat0009, -4, 7, 21, 0, ClaveBaja9N, ClaveAlta9N;
   |FINSI;
   |CIERRA #dsat0008;
|FPRC;

|PROCESO ClaveBaja38;
    #dsaz0038#0 = nDEjer;
    #dsaz0038#1 = nDMes;
|FPRC;

|PROCESO ClaveAlta38;
    #dsaz0038#0 = nHEjer;
    #dsaz0038#1 = nHMes;
|FPRC;

|| ///////////////////////////////////////////////////////////////
|PROCESO CreaDsaz0038;
    #dsaz0038#0 = #dsat0008#21;
    #dsaz0038#1 = #dsat0008#20;
    |LEE 041#dsaz0038.=;
    |SI FSalida ! 0;
        #dsaz0038#0 = #dsat0008#21;
        #dsaz0038#1 = #dsat0008#20;
        |HAZ HMes;
        |GRABA 020#dsaz0038.n
        nAlgun = 1;
    |FINSI;
    |LIBERA #dsat0008;
|FPRC;

|DEFBUCLE CreaDsaz0038;
     #dsat0008#1;
     ;
     nDEjer, nDMes, enDEmpresa;
     nHEjer, nHMes, enHEmpresa;
     be;
     NULL, CreaDsaz0038;
|FIN;
|| ///////////////////////////////////////////////////////////////

|PROGRAMA;
     eaParam = PARAMETRO; |QBF eaParam;

     eaFichero = ("3z" + Usuario) % 108;
     |NOME_DAT #dsaz0038#eaFichero#;
     |DELINDEX #dsaz0038;

     eaFun07 = "A";
     |SI eaParam = "";
         nDMes = 01;
         nHMes = 12;
         nDEjer = 2000;
         nHEjer = 2099;
         enDEmpresa = 00001;
         enHEmpresa = 99999;
     |SINO;
         nDMes = enMesRen;
         nHMes = enMesRen;
         nDEjer = enEjeRen;
         nHEjer = enEjeRen;
     |FINSI;

     nAlgun = 0;
     |ABRE #dsaz0038;
     |BUCLE CreaDsaz0038;
     |CIERRA #dsaz0038;
     |SI nAlgun = 0;
         |MENAV "0000No existen Expedientes pendientes de aperturar";
     |SINO;
         |PINPA #0#dsaz0038;
         |SI eaParam = "";
             |ENTLINEAL #1#dsaz0038, -2, 4, 8, 0, ClaveBaja38, ClaveAlta38;
         |SINO;
             |PINTA 0702, "Mes: "; |PINTA 0707, #dsaz0038#1;
             |PINTA 0802, "A¤o: "; |PINTA 0807, #dsaz0038#0;
             FSalida = 0;
             |HAZ Verdsat0008;
         |FINSI;
     |FINSI;
|FPRO;
