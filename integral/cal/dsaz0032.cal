|FICHEROS;
    dsaz0032;
    dsam0000;
    dsat0004;
|FIN;

|VARIABLES;

     aFichero  = "";
     nCanal    = 0;
     aBase     = "";
     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nPara1    = 0;
     nGraba    = 0;

     nImport1  = 0;
     nImport2  = 0;
     fFecha    = @;
     fDFecha   = @;
     fHFecha   = @;
     nEmpresa  = 0;
     nEjer     = 0;
     nAlgun    = 0;

     &enAlgun    = 0;
     &eaFichero  = "";
     &eaDLiqu    = "";
     &eaHLiqu    = "";
     &aFuncion   = "";
     &enEjer     = 0;
     &enEmpresa  = 0;
     &enDEmpresa = 0;
     &enHEmpresa = 0;
     &enDAgente  = 0;
     &enHAgente  = 0;
     &enDMes     = 0;
     &eaHMes     = "";
     &enHMes     = 0;
     &enProceso  = 0;
     &eaObActual = "";
     &eaObCalcul = "";
     &eaParam    = "";

     &eaPathLaboral = "";
|FIN;

|CALCULO HMes; |TIPO 0;
    enHMes = #dsaz0032#1;
    |SI enHMes = 1;  #dsaz0032#2 = "Enero     "; |FINSI;
    |SI enHMes = 2;  #dsaz0032#2 = "Febrero   "; |FINSI;
    |SI enHMes = 3;  #dsaz0032#2 = "Marzo     "; |FINSI;
    |SI enHMes = 4;  #dsaz0032#2 = "Abril     "; |FINSI;
    |SI enHMes = 5;  #dsaz0032#2 = "Mayo      "; |FINSI;
    |SI enHMes = 6;  #dsaz0032#2 = "Junio     "; |FINSI;
    |SI enHMes = 7;  #dsaz0032#2 = "Julio     "; |FINSI;
    |SI enHMes = 8;  #dsaz0032#2 = "Agosto    "; |FINSI;
    |SI enHMes = 9;  #dsaz0032#2 = "Septiembre"; |FINSI;
    |SI enHMes = 10; #dsaz0032#2 = "Octubre   "; |FINSI;
    |SI enHMes = 11; #dsaz0032#2 = "Noviembre "; |FINSI;
    |SI enHMes = 12; #dsaz0032#2 = "Diciembre "; |FINSI;
    |PINTA #dsaz0032#2;
    eaHMes = #dsaz0032#2;
|FCAL;

|CALCULO HCliente; |TIPO 0;
    |SI #dsaz0032#4 < #dsaz0032#3;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HAgente; |TIPO 0;
    |SI #dsaz0032#6 < #dsaz0032#5;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|| *******************************************************************
|PROCESO LeeAuxiliar;
   #dsam0000#0 = #dsat0004#0;
   |LEE 141#dsam0000.=;
   |SI FSalida = 0;
      #dsam0000#122 = #dsat0004#7;
      |GRABA 020#dsam0000.a;
   |FINSI;
   |LIBERA #dsam0000;
|FPRC;

|DEFBUCLE LeeAuxiliar;
  #dsat0004#1;
  ;
  enEjer, enDEmpresa, 000;
  enEjer, enHEmpresa, 999;
  ;
  NULL, LeeAuxiliar;
|FIN;

|PROCESO ClaveBaja999;
   #dsat0004#0 = enDEmpresa;
   #dsat0004#1 = enEjer;
   #dsat0004#2 = 000;
|FPRC;

|PROCESO ClaveAlta999;
   #dsat0004#0 = enHEmpresa;
   #dsat0004#1 = enEjer;
   #dsat0004#2 = 999;
|FPRC;

|PROCESO PantallaFB;
   |PINPA #0#dsat0004;
   |C_V #dsat0004#4,1,"N";
   |C_V #dsat0004#2,1,"N";
   |C_A #dsat0004#3,1,39;
   |ATRI R; |PINTA 0502, "Empresas con obligacion de contratar la prevencion de riesgos laborales";|ATRI 0;
   |PINTA 0720, "                                                            ";
   |PINTA 0820, "旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커";
            |PINTA 1042, "      ";
   |ATRI R; |PINTA 1142, "      ";|ATRI 0;
|FPRC;

|PROCESO Procesoz032;

     eaFichero = ("5y" + Usuario) % 108;
     |NOME_DAT #dsat0004#eaFichero#;
     |DELINDEX #dsat0004;

     aAlfa1 = #dsaz0032#0;
     aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
     aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

     enEjer     = #dsaz0032#0;
     enDEmpresa = #dsaz0032#3;
     enHEmpresa = #dsaz0032#4;
     enDAgente  = #dsaz0032#5;
     enHAgente  = #dsaz0032#6;
     enDMes     = #dsaz0032#1;
     enHMes     = #dsaz0032#1;
     eaHMes     = #dsaz0032#2;
     enProceso  = 1;
     eaObActual = #dsaz0032#7;

     |HAZ ObligaNomina;
     |SI eaParam = "";
         |SI enAlgun = 1;
             |HAZ PantallaFB;
             |ENTLINEAL #1#dsat0004, -2, 4, 22, 0, ClaveBaja999, ClaveAlta999;
             |CONFI "0000SDesea actualizar los datos";
             |SI FSalida = 0;
                 |ABRE #dsam0000;
                 |BUCLE LeeAuxiliar;
                 |CIERRA #dsam0000;
             |FINSI;
         |SINO;
             |MENAV "0000Seleccion vacia";
         |FINSI;
     |FINSI;
     |DELINDEX #dsat0004;
|FPRC;

|PROGRAMA;
     eaParam = PARAMETRO; |QBF eaParam;

     eaPathLaboral = "";
     |DBASS aBase;
     aAlfa = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathLaboral   = aBase + "laboral/";
     |SINO;
         |MENAV "0000No existe laboral";
         |ACABA;
     |FINSI;

     aFuncion = "B";
     fFecha = ~;
     aAlfa  = fFecha;
     aAlfa  = aAlfa % -104;
     #dsaz0032#0 = aAlfa;
     aAlfa  = fFecha;
     aAlfa  = aAlfa % 402;
     #dsaz0032#1 = aAlfa;

     |SI eaParam = "";
         |CLS;
         |CABEZA "Obligacion Riesgos Laborales";

         |PINPA #0#dsaz0032;
         |PINDA #0#dsaz0032;

         |ENDATOS #2#dsaz0032;
     |SINO;
         #dsaz0032#3 = enEmpresa;
         #dsaz0032#4 = enEmpresa;
         #dsaz0032#5 = 00;
         #dsaz0032#6 = 99;
         #dsaz0032#7 = "S";
         FSalida     = 0;
     |FINSI;
     |SI FSalida = 0;
         |HAZ Procesoz032;
     |FINSI;
|FPRO;
