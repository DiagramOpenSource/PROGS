7|FICHEROS;
    dsaz0039;

    dsam0000;
    dsam0026;
    dsam0027;
    dsam0028;

    dsat0010,MANTE;
|FIN;

|VARIABLES;
     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     aFichero  = "";
     aParam    = "";
     fFecha    = @;
     fFechaI   = @;
     nAlgun    = 0;
     nOk       = 0;
     nNume1    = 0;

     aDEstado  = "";
     aHEstado  = "";
     nDEjer    = 0;
     nHEjer    = 0;
     fDFecha   = @;
     fHFecha   = @;
     nDEmpresa = 0;
     nHEmpresa = 0;
     nDExpedie = 0;
     nHExpedie = 0;
     nDMes     = 0;
     nHMes     = 0;
     nHay      = 0;
     nEmpresa  = 0;
     nTecla    = 0;
|FIN;

|INCLUYE i_varfun;

|CALCULO HAny; |TIPO 0;
    |SI #dsaz0039#1 < #dsaz0039#0;
        |MENAV "0000Error. Hasta Ejercicio inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HMes; |TIPO 0;
    |SI #dsaz0039#3 < #dsaz0039#2;
        |MENAV "0000Error. Hasta Ejercicio inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HCliente; |TIPO 0;
    |SI #dsaz0039#6 < #dsaz0039#5;
        |MENAV "0000Error. Hasta Cliente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO HExpe; |TIPO 0;
    |SI #dsaz0039#8 < #dsaz0039#7;
        |MENAV "0000Error. Hasta Expediente inferior al Desde";
        |ERROR;
    |FINSI;
|FCAL;

|CALCULO Tipo0C9z039; |TIPO 0;
    |SI #dsaz0039#9 = "P"; aAlfa1 = "N"; aAlfa2 = "N"; |FINSI;
    |SI #dsaz0039#9 = "R"; aAlfa1 = "S"; aAlfa2 = "N"; |FINSI;
    |SI #dsaz0039#9 = "E"; aAlfa1 = "S"; aAlfa2 = "S"; |FINSI;
    |C_M #dsaz0039#13, 1, aAlfa1;
    |C_M #dsaz0039#14, 1, aAlfa1;
    |C_M #dsaz0039#15, 1, aAlfa2;
    |C_M #dsaz0039#16, 1, aAlfa2;

    |SI aAlfa1 = "N";
        #dsaz0039#13 = "01.01.0000";
        #dsaz0039#14 = "01.01.0000";
    |SINO;
        |SI #dsaz0039#13 = "01.01.0000"; #dsaz0039#13 = fFechaI; |FINSI;
        |SI #dsaz0039#14 = "01.01.0000"; #dsaz0039#14 = fFecha;  |FINSI;
    |FINSI;
    |PINTA #dsaz0039#13;
    |PINTA #dsaz0039#14;
    |SI aAlfa2 = "N";
        #dsaz0039#15 = "01.01.0000";
        #dsaz0039#16 = "01.01.0000";
    |SINO;
        |SI #dsaz0039#15 = "01.01.0000"; #dsaz0039#15 = fFechaI; |FINSI;
        |SI #dsaz0039#16 = "01.01.0000"; #dsaz0039#16 = fFecha;  |FINSI;
    |FINSI;
    |PINTA #dsaz0039#15;
    |PINTA #dsaz0039#16;
|FCAL;

|| *******************************************************************
|PROCESO GrabaAuxiliar10;
   #dsat0010#0  = #dsam0027#1;
   |LEE 041#dsat0010.=;
   |SI FSalida ! 0;
       |DDEFECTO #dsat0010;
       #dsat0010#0  = #dsam0027#1;
       #dsat0010#1  = #dsam0027#3;
       #dsat0010#2  = #dsam0027#4;
       #dsat0010#3  = #dsam0027#5;
       #dsat0010#4  = #dsam0027#6;
       #dsat0010#5  = #dsam0027#2;
       #dsat0010#6  = #dsam0027#7;
       #dsat0010#7  = #dsam0027#30;
       #dsat0010#8  = #dsam0027#9;
       #dsat0010#9  = #dsam0027#10;
       #dsat0010#10 = #dsam0027#11;
       #dsat0010#11 = #dsam0027#12;
       #dsat0010#12 = #dsam0027#8;
       #dsat0010#13 = #dsam0027#13;
       #dsat0010#14 = #dsam0027#14;
       #dsat0010#15 = #dsam0027#24;
       #dsat0010#16 = #dsam0027#25;
       #dsat0010#17 = #dsam0027#26;
       #dsat0010#18 = #dsam0027#27;
       #dsat0010#19 = #dsam0027#16;
       #dsat0010#22 = #dsaz0039#10;
       |GRABA 020#dsat0010.b;
   |FINSI;
   nAlgun = 1;
|FPRC;

|PROCESO LeoDsam0027;
   nHay     = 0;
   nEmpresa = #dsam0027#5;

   |SI #dsam0027#9 [ "01.01.0000"; |ACABA; |FINSI;

   nOk = 0;
   |SI #dsaz0039#9 = "P";
       |SI #dsam0027#10 > "01.01.0000"; nOk = 1; |FINSI;
   |FINSI;

   |SI #dsaz0039#9 = "R";
       |SI #dsam0027#11 > "01.01.0000"; nOk = 1; |FINSI;
       |SI #dsam0027#10 [ "01.01.0000"; nOk = 1; |FINSI;
       |SI #dsam0027#10 < #dsaz0039#13; |O #dsam0027#10 > #dsaz0039#14; nOk = 1; |FINSI;
   |FINSI;

   |SI #dsaz0039#9 = "E";
       |SI #dsam0027#12 > "01.01.0000"; nOk = 1; |FINSI;
       |SI #dsam0027#10 [ "01.01.0000"; nOk = 1; |FINSI;
       |SI #dsam0027#10 < #dsaz0039#13; |O #dsam0027#10 > #dsaz0039#14; nOk = 1; |FINSI;
       |SI #dsam0027#11 [ "01.01.0000"; nOk = 1; |FINSI;
       |SI #dsam0027#11 < #dsaz0039#15; |O #dsam0027#11 > #dsaz0039#16; nOk = 1; |FINSI;
   |FINSI;
   |SI nOk = 1; |ACABA; |FINSI;

   |HAZ GrabaAuxiliar10;
|FPRC;

|DEFBUCLE dsam0027;
   #dsam0027#1;
   5,4,3,28,9;
   eaFun07, nDExpedie, nDEmpresa, nDEjer, nDMes, aDEstado, #dsaz0039#11;
   eaFun07, nHExpedie, nHEmpresa, nHEjer, nHMes, aHEstado, #dsaz0039#12;
   e;
   NULL, LeoDsam0027;
|FIN;

|| ********************************************************************
|PROCESO Tipo7C22t010;  |TIPO 7;
   aAlfa = "Presentacion";
   |SI #dsaz0039#9 = "R"; aAlfa = "Recogida"; |FINSI;
   |SI #dsaz0039#9 = "E"; aAlfa = "Entrega";  |FINSI;
   aAlfa = "0000Entre: Nueva Fecha de " + aAlfa;
   |MENSA aAlfa;
|FPRC;

|PROCESO Tipo0C22t010;  |TIPO 0;
   |BLIN 4;
   |SI FSalida = 11;
       #dsat0010#22 = #dsaz0039#10;
       |PINTA #dsat0010#22;
   |FINSI;
|FPRC;

|PROCESO Tipo11t010;  |TIPO 11;
     nTecla = FSalida;

     |SI nTecla = 10;
         |LEE 141#dsat0010.=;

         |ENCAMPO #22#dsat0010;
         |GRABA 020#dsat0010.a;
         |LIBERA #dsat0010;

         |PONCONTROL  23, "SI";
     |FINSI;

     |SI nTecla = 16;
         |CONFI "0000SDesea borrar el registro (No actualiza en Cliente)";
         |SI FSalida = 0;
             |LEE 141#dsat0010.=;
             |BORRA 020#dsat0010.a;
             |LIBERA #dsat0010;
         |FINSI;
         |PONCONTROL  23, "SI";
     |FINSI;
|FPRC;
|| ///////////////////////////////////////////////////////////////////////
|PROCESO dsat0010;
  #dsam0027#0 = eaFun07;
  #dsam0027#1 = #dsat0010#0;
  |LEE 141#dsam0027.=;
  |SI FSalida = 0;
      |SI #dsaz0039#9 = "P"; nNume1 = 10; |FINSI;
      |SI #dsaz0039#9 = "R"; nNume1 = 11; |FINSI;
      |SI #dsaz0039#9 = "E"; nNume1 = 12; |FINSI;
      #dsam0027#nNume1# = #dsat0010#22;
      |GRABA 020#dsam0027.a;
  |FINSI;
  |LIBERA #dsam0027;
|FPRC;

|DEFBUCLE dsat0010;
  #dsat0010#1;
  ;
  nDExpedie;
  nHExpedie;
  ;
  NULL, dsat0010;
|FIN;

|PROCESO PasoDatos;
  nAlgun = 0;
  |ABRE #dsam0027;
  |ATRI S; |PINTA 2302, "Actualizando registros .... .... .... "; |ATRI 0;
  |BUCLE dsat0010;
  |CIERRA #dsam0027;
|FPRC;

|RUTINA ClaveBaja010;
     #dsat0010#0  = nDExpedie;
|FRUT;

|RUTINA ClaveAlta010;
     #dsat0010#0  = nHExpedie;
|FRUT;

|PROCESO LaPantalla;
    |PINPA #0#dsat0010;
    |SI #dsaz0039#9 = "P"; aAlfa = "Present."; |FINSI;
    |SI #dsaz0039#9 = "R"; aAlfa = "Recogida"; |FINSI;
    |SI #dsaz0039#9 = "E"; aAlfa = "Entrega "; |FINSI;
    |SI #dsaz0039#9 ! "E";
        |PINTA 1341, "                              ";
        |C_V #dsat0010#11, 1, "N";
    |FINSI;

    |SI #dsaz0039#9 ! "R"; |Y #dsaz0039#9 ! "E";
        |PINTA 1241, "                              ";
        |C_V #dsat0010#10, 1, "N";
    |FINSI;
    |ATRI R; |PINTA 0729, aAlfa; |ATRI 0;
|FPRC;

|PROCESO ProcesoZ039;

     aFichero = ("4b" + Usuario) % 108;
     |NOME_DAT #dsat0010#aFichero#;
     |DELINDEX #dsat0010;

     aAlfa1 = #dsaz0039#0;
     aAlfa2 = "01.01." + aAlfa1; fDFecha = aAlfa2;
     aAlfa1 = #dsaz0039#1;
     aAlfa2 = "31.12." + aAlfa1; fHFecha = aAlfa2;

     nDEmpresa = #dsaz0039#5;
     nHEmpresa = #dsaz0039#6;
     nDExpedie = #dsaz0039#7;
     nHExpedie = #dsaz0039#8;
     nDMes     = #dsaz0039#2;
     nHMes     = #dsaz0039#3;
     nDEjer    = #dsaz0039#0;
     nHEjer    = #dsaz0039#1;
     aDEstado  = "N";
     aHEstado  = "N";

     |ABRE #dsat0010;
     |ABRE #dsam0000;
     nAlgun = 0;
     |BUCLE dsam0027;
     |CIERRA #dsam0000;
     |CIERRA #dsat0010;

     |SI nAlgun = 1;

         || |ABRE #dsat0010;
         || |CONSULTA_CLAVE #1#dsat0010;
         || |CIERRA  #dsat0010;

         |HAZ LaPantalla;
         |ENTLINEAL #1#dsat0010, -1, 4, 21, 0, ClaveBaja010, ClaveAlta010;
         |SI FSalida = 0;
             |CONFI "0000SDesea actualizar los datos Introducidos";
             |SI FSalida = 0;
                 |HAZ PasoDatos;
             |FINSI;
         |FINSI;
     |SINO;
         |MENAV "0000Seleccion vacia";
     |FINSI;

     |DELINDEX #dsat0010;
|FPRC;

|PROGRAMA;

    eaFun07 = "A";
    aParam = PARAMETRO; |QBF aParam;

    |CLS;
    |CABEZA "Grabacion de Fechas en Expedientes";

    fFecha = ~;
    aAlfa  = fFecha;
    aAlfa  = aAlfa % -104;
    #dsaz0039#0 = aAlfa;
    #dsaz0039#1 = aAlfa;
    aAlfa = "01.01." + aAlfa; fFechaI = aAlfa;

    |ABRE #dsaz0039;
    #dsaz0039#19 = "A";
    |LEE 041#dsaz0039.=;
    |SI FSalida ! 0;
        |DDEFECTO #dsaz0039;

        fFecha = ~;
        aAlfa  = fFecha;
        aAlfa  = aAlfa % -104;
        #dsaz0039#0 = aAlfa;
        #dsaz0039#1 = aAlfa;
        #dsaz0039#11 = fFechaI;
        #dsaz0039#12 = fFecha;
        |GRABA 020#dsaz0039.b;
    |FINSI;
    |PINPA #0#dsaz0039;
    |PINDA #0#dsaz0039;
    |ENDATOS #2#dsaz0039;
    |SI FSalida = 0;
        |GRABA 020#dsaz0039.a;
        |LIBERA #dsaz0039;
        |CIERRA #dsaz0039;
        |HAZ ProcesoZ039;
    |SINO;
        |LIBERA #dsaz0039;
        |CIERRA #dsaz0039;
    |FINSI;
|FPRO;
