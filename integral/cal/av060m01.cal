|FICHEROS;
     dsam0000;
     dsam0001;
     dsam0016;

     av060m01;
     av060m02;
     dsam0108;

     av060w00,MANTE;
     av060w01,MANTE;
     av060w03,MANTE;

     dsaw0041,MANTE;

     :dsarchi/dsarw010;
     :modelos/dsmom108;
|FIN;

|VARIABLES;
     nModo            = -1;
     n0Vent           = -1;
     n1Vent           = -1;
     n2Vent           = -1;
     nBtnAltaUsu      = -1;
     nBtnBorrUsu      = -1;
     nBtnAltC         = -1;
     nBtnModC         = -1;
     nBtnBorC         = -1;
     nBtnAltB         = -1;
     nBtnModB         = -1;
     nBtnBorB         = -1;
     nBtnVerN         = -1;
     nBtnPagi         = -1;
     nBtnUsus         = -1;
     nBtnConf         = -1;
     nRango           = -1;
     nLabel           = -1;
     nGraba           = -1;
     nGrid01          = -1;
     nGrid02          = -1;
     nGrid03          = -1;
     nLong            = 0;
     nCarac           = 0;
     nPos             = 0;
     nHandle          = 0;
     nFSalida         = 0;
     nSwSMTPCLI       = 0;
     nSwDsEnviaCorreo = 0;
     nIni             = 0;
     nPanta41         = 0;

     aEsc1            = "";
     aEsc2            = "";
     aRetu            = "";
     aTecla           = "";
     aAlfa            = "";
     aAlfa1           = "";
     aUsuario         = "";
     aBase            = "";
     aDirLocal        = "";
     aFicOrigen       = "";
     aFicDestino      = "";
     aDocRemoto       = "";
     aDocServidor     = "";
     aIPRemoto        = "";
     aPrograma        = "";
     aAbre            = "";
     aBorra           = "";
     aMensaje         = "";
     aLinea           = "";
     aLong            = "";
     aCarac           = "";
     aSalida          = "";
     aAutenti         = "";
     aTo              = "";
     aAsunto          = "";
     aFrom            = "";
     aIP              = "";
     aOrigen          = "";
     aDestino         = "";
     aDirCorreo       = "";
     aAdjunto         = "";
     aIni             = "";
     aFicTar          = "";
     aPathLocal       = "";
     aFicTree         = "";
     aBuscar          = "";
     aRefresca        = "";

     {-1}aSerie       = "";

     {1}aContiene     = "";

     {-1}aVent        = "";
         aVent1       = 0;
         aVent2       = 0;
         aVent3       = 0;
         aVent4       = 0;
         aVent5       = "";

     &eaUnidadBasico   = "";
     &eaPrograma       = "";
     &enAprobacion     = -1;
     &eaFicCert        = "";
     &eaAlfa           = "";
     &eaPass           = "";
     &enCorreo         = 0;
     &enPanta43        = 0;
     &eaCer            = "";
     &eaBuz            = "";
     &eaDSMAC          = "";
     &eaPathExplorador = "";
     &eaForzExplorador = "";
|FIN;

|PROCESO GrabaAdjunto;
     eaAlfa  = aAlfa;  |QBF eaAlfa;
     |HAZ QuitaRarosPlb;

     eaAlfa = eaAlfa + &13 + &10;
     |XGRABA nHandle, eaAlfa;
|FPRC;

|PROCESO AveriguaINI;
     aSerie = "";
     |ESPECIFICA "SERIALIZACION", aSerie;
     aIni = FSalida;
     aIni = aIni % 106;
     nIni = aIni;
     aIni = ("000000" + nIni) % -106;

     |DBASS aBase;  |QBF aBase;
|FPRC;

|PROCESO TrataAdjuntoC;
     eaPass = #av060m01#6;
     |HAZ DesencriptaPass;

     aAbre    = aDirCorreo + "datos.txt";
     |XABRE "WB", aAbre, nHandle;

     |HAZ AveriguaINI;

     aAlfa = "INI:" + aIni;                          |HAZ GrabaAdjunto;
     aAlfa = "Directorio base:" + aBase;             |HAZ GrabaAdjunto;
     aAlfa = "NIF:" + #av060m01#0;                   |HAZ GrabaAdjunto;
     aAlfa = "Nombre:" + #av060m01#1;                     |HAZ GrabaAdjunto;
     aAlfa = "Fecha alta:" + #av060m01#3;            |HAZ GrabaAdjunto;
     aAlfa = "Fecha baja:" + #av060m01#4;            |HAZ GrabaAdjunto;
     aAlfa = "Fecha caducidad:" + #av060m01#5;       |HAZ GrabaAdjunto;
     aAlfa = "Certificado:" + #av060m01#2;           |HAZ GrabaAdjunto;
     aAlfa = "Password:" + eaPass;                   |HAZ GrabaAdjunto;
     aAlfa = "Apoderado:" + #av060m01#7;             |HAZ GrabaAdjunto;
     aAlfa = "Email:" + #av060m01#8;                 |HAZ GrabaAdjunto;
     aAlfa = "Email receptor:" + #dsam0001#13;       |HAZ GrabaAdjunto;

     |XCIERRA nHandle;

     aFicTar = aDirCorreo + "adjunto.tar";
     aFicTar = aFicTar + " datos.txt";

     |SI eaFicCert ! "";
         aOrigen  = eaFicCert;
         aDestino = aDirCorreo + #av060w00#2;  |QBF aDestino;
         |RECIBE_FICHERO aOrigen, aDestino;

         aFicTar = aFicTar + " " + #av060w00#2;  |QBF aFicTar;
     |FINSI;

     |ATAR aFicTar, aDirCorreo;
     |SI FSalida = 0;
          aFicTar = aDirCorreo + "adjunto.tar";
          |COMPRIME aFicTar;
          |SI FSalida = 0;
               aBorra = aDirCorreo + "adjunto.tar";
               |FBORRA aBorra;
               aAdjunto = aDirCorreo + "adjunto.tgz";
          |FINSI;
     |FINSI;

     |FBORRA aAbre;
|FPRC;

|PROCESO MandaCorreoC;
     |HAZ TrataAdjuntoC;

     aIP      = #dsarw010#18;  |QBF aIP;
     aFrom    = #dsam0001#13;  |QBF aFrom;
     aSalida  = #dsarw010#19;  |QBF aSalida;

     aTo      = "notificaciones060@avisos.diagram.es";

     aAsunto  = " DATOS CERTIFICADO";
     aMensaje = "Datos certificado";

     |SI #dsarw010#23 = "S";
          |SI #dsarw010#20 = "N";
               aAutenti = "!" + aFrom;
          |SINO;
               aAutenti = "!" + #dsarw010#22;
               |QBF aAutenti;
               aAutenti = aAutenti + ":" + #dsarw010#21;
               |QBF aAutenti;
               aAutenti = aAutenti + ":" + aFrom;
          |FINSI;
     |SINO;
          |SI #dsarw010#20 = "N";
               aAutenti = aFrom;
          |SINO;
               aAutenti = #dsarw010#22;
               |QBF aAutenti;
               aAutenti = aAutenti + ":" + #dsarw010#21;
               |QBF aAutenti;
               aAutenti = aAutenti + ":" + aFrom;
          |FINSI;
     |FINSI;

     |DSCORREO_ENVIA aIP, aSalida, aAutenti, aTo, aAsunto, aMensaje, aAdjunto;
     nFSalida = FSalida;

     |SI nFSalida ] 0;
         |MENAV "0000Datos certificado enviado correctamente.";
     |SINO;
         |MENAV "0000No se ha podido mandar datos del certificado, intentelo de nuevo.";
     |FINSI;
|FPRC;

|PROCESO TrataAdjuntoB;
     aAbre    = aDirCorreo + "datos.txt";
     |XABRE "WB", aAbre, nHandle;

     |HAZ AveriguaINI;

     aAlfa = "INI:" + aIni;                          |HAZ GrabaAdjunto;
     aAlfa = "Directorio base:" + aBase;             |HAZ GrabaAdjunto;
     aAlfa = "NIF:" + #av060m02#0;                   |HAZ GrabaAdjunto;
     aAlfa = "Buzon:" + #av060m02#1;                 |HAZ GrabaAdjunto;
     aAlfa = "Nombre buzon:" + #av060m02#2;          |HAZ GrabaAdjunto;
     aAlfa = "Modo:" + nModo;                        |HAZ GrabaAdjunto;

     |XCIERRA nHandle;

     aAdjunto = aAbre;
|FPRC;

|PROCESO MandaCorreoB;
     |HAZ TrataAdjuntoB;

     aIP      = #dsarw010#18;  |QBF aIP;
     aFrom    = #dsam0001#13;  |QBF aFrom;
     aSalida  = #dsarw010#19;  |QBF aSalida;

     aTo      = "notificaciones060@avisos.diagram.es";

     aAsunto  = " DATOS BUZON";
     aMensaje = "Datos buzon";

     |SI #dsarw010#23 = "S";
          |SI #dsarw010#20 = "N";
               aAutenti = "!" + aFrom;
          |SINO;
               aAutenti = "!" + #dsarw010#22;
               |QBF aAutenti;
               aAutenti = aAutenti + ":" + #dsarw010#21;
               |QBF aAutenti;
               aAutenti = aAutenti + ":" + aFrom;
          |FINSI;
     |SINO;
          |SI #dsarw010#20 = "N";
               aAutenti = aFrom;
          |SINO;
               aAutenti = #dsarw010#22;
               |QBF aAutenti;
               aAutenti = aAutenti + ":" + #dsarw010#21;
               |QBF aAutenti;
               aAutenti = aAutenti + ":" + aFrom;
          |FINSI;
     |FINSI;

     |DSCORREO_ENVIA aIP, aSalida, aAutenti, aTo, aAsunto, aMensaje, aAdjunto;
     nFSalida = FSalida;

     |SI nFSalida ] 0;
         |MENAV "0000Datos buzon enviado correctamente.";
     |SINO;
         |MENAV "0000No se ha podido mandar datos del buzon, intentelo de nuevo.";
     |FINSI;

     |FBORRA aAbre;
|FPRC;

|PROCESO Evento02;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#av060m02.=;

         |ESTADO_CONTROL nBtnModB, "ENABLE";
         |ESTADO_CONTROL nBtnBorB, "ENABLE";
     |FINSI;

     |SI FSalida = 4;
         eaCer = #av060m02#0;
         eaBuz = #av060m02#1;

         |SUB_EJECUTA "av060m03";
     |FINSI;
|FPRC;

|PROCESO Evento01;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#av060m01.=;

         |ESTADO_CONTROL nBtnModC, "ENABLE";
         |ESTADO_CONTROL nBtnBorC, "ENABLE";
         |ESTADO_CONTROL nBtnVerN, "ENABLE";

         |ESTADO_CONTROL nBtnAltB, "ENABLE";

         |REFRESCACONTROL nGrid02;
     |FINSI;
|FPRC;

|PROCESO Entraav060m01;
     |DDEFECTO #av060w00;

     |C_M #av060w00#0, 1, "S";
     |SI nModo = 2;
         #av060w00#0  = #av060m01#0;
         #av060w00#1  = #av060m01#1;
         #av060w00#2  = #av060m01#2;
         #av060w00#3  = #av060m01#3;
         #av060w00#4  = #av060m01#4;
         #av060w00#5  = #av060m01#5;
         #av060w00#6  = #av060m01#6;
         #av060w00#7  = #av060m01#7;
         #av060w00#8  = #av060m01#8;

         |C_M #av060w00#0, 1, "N";
     |FINSI;

     eaFicCert = "";
     aAlfa     = #av060w00#2;  |QBF aAlfa;
     |SI aAlfa = "";
         |MENAV "0000A continuaci¢n seleccione de su PC el certificado que vamos a dar de alta";

         |HAZ RecogeCertificado;
         |SI eaFicCert = "";
             |MENAV "0000Proceso cancelado.";
             |ACABA;
         |FINSI;
     |FINSI;

     aAlfa = #av060w00#2;  |QBF aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     |C_M #av060w00#1,  1, "S";
     |C_M #av060w00#3,  1, "S";
     |C_M #av060w00#4,  1, "S";
     |C_M #av060w00#5,  1, "S";
     |C_M #av060w00#7,  1, "S";
     |C_M #av060w00#8,  1, "S";

     aAlfa = #av060w00#6;  |QBF aAlfa;
     aAlfa = aAlfa % 0;
     nLong = aAlfa;

     #av060w00#9 = "*" * nLong;

     |SI nModo = 1;  aAlfa = "Nuevo registro CERTIFICADO";      |FINSI;
     |SI nModo = 2;  aAlfa = "Modificar registro CERTIFICADO";  |FINSI;

     |VENTANA 0501, 2699, -1, 16, aAlfa;
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     enCorreo = 0;
     |PINPA #0#av060w00;  enPanta43 = FSalida;
     |PINDA #0#av060w00;

     |SI nModo = 1;  |ENDATOS #1#av060w00;  |FINSI;
     |SI nModo = 2;  |ENDATOS #2#av060w00;  |FINSI;

     |SI FSalida = 0;
         #av060m01#0  = #av060w00#0;
         #av060m01#1  = #av060w00#1;
         #av060m01#2  = #av060w00#2;
         #av060m01#3  = #av060w00#3;
         #av060m01#4  = #av060w00#4;
         #av060m01#5  = #av060w00#5;
         #av060m01#6  = #av060w00#6;
         #av060m01#7  = #av060w00#7;
         #av060m01#8  = #av060w00#8;

         nFSalida = 0;
         |SI eaFicCert ! "";  |O enCorreo = 1;
             |HAZ MandaCorreoC;
         |FINSI;

         |SI nModo = 1;
             |SI nFSalida ] 0;
                 |GRABA 020#av060m01.n;
             |FINSI;
         |FINSI;

         |SI nModo = 2;
             |GRABA 020#av060m01.a;
         |FINSI;
     |FINSI;
     |LIBERA #av060m01;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |REFRESCACONTROL nGrid01;
     |FOCOTECLADO nGrid01;
     |PULSATECLA;
|FPRC;

|PROCESO BtnAltC;
     aFrom    = #dsam0001#13;  |QBF aFrom;
     |SI aFrom = "";
         |MENAV "0000Configure el email de recepci¢n de avisos";
         |FOCOTECLADO nGrid01;
         |ACABA;
     |FINSI;

     nModo = 1;  |HAZ Entraav060m01;
|FPRC;

|PROCESO BtnModC;
     aFrom    = #dsam0001#13;  |QBF aFrom;
     |SI aFrom = "";
         |MENAV "0000Configure el email de recepci¢n de avisos";
         |FOCOTECLADO nGrid01;
         |ACABA;
     |FINSI;

     |LEE 101#av060m01.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nModo = 2;  |HAZ Entraav060m01;
|FPRC;

|PROCESO BtnBorC;
     aFrom    = #dsam0001#13;  |QBF aFrom;
     |SI aFrom = "";
         |MENAV "0000Configure el email de recepci¢n de avisos";
         |FOCOTECLADO nGrid01;
         |ACABA;
     |FINSI;

     |LEE 101#av060m01.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el registro seleccionado";
     |SI FSalida ! 0;
         |LIBERA #av060m01;
         |ACABA;
     |FINSI;

     |BORRA 020#av060m01.a;
     |LIBERA #av060m01;

     #av060m01#3 = ~;
     |HAZ MandaCorreoC;

     |REFRESCACONTROL nGrid01;
     |FOCOTECLADO nGrid01;
|FPRC;

|PROCESO Entraav060m02;
     |DDEFECTO #av060w01;

     |C_M #av060w01#0, 1, "S";
     |SI nModo = 2;
         #av060w01#0  = #av060m02#3;
         #av060w01#1  = #av060m02#1;
         #av060w01#2  = #av060m02#2;
         #av060w01#3  = #av060m02#4;
         #av060w01#4  = #av060m02#5;
         #av060w01#5  = #av060m02#6;

         |C_M #av060w01#0, 1, "N";
     |FINSI;

     |C_M #av060w01#4,  1, "S";
     |C_M #av060w01#5,  1, "S";

     |SI nModo = 1;  aAlfa = "Nuevo registro BUZON";      |FINSI;
     |SI nModo = 2;  aAlfa = "Modificar registro BUZON";  |FINSI;

     |VENTANA 0501, 2699, -1, 16, aAlfa;
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     enCorreo = 0;
     |PINPA #0#av060w01;  enPanta43 = FSalida;
     |PINDA #0#av060w01;

     |SI nModo = 1;  |ENDATOS #1#av060w01;  |FINSI;
     |SI nModo = 2;  |ENDATOS #2#av060w01;  |FINSI;

     |SI FSalida = 0;
         #av060m02#0  = #av060m01#0;
         #av060m02#1  = #av060w01#1;
         #av060m02#2  = #av060w01#2;
         #av060m02#3  = #av060w01#0;
         #av060m02#4  = #av060w01#3;
         #av060m02#5  = #av060w01#4;
         #av060m02#6  = #av060w01#5;

         nFSalida = 0;
         |SI nModo = 1;
             |HAZ MandaCorreoB;

             |SI nFSalida ] 0;
                 |GRABA 020#av060m02.n;
             |FINSI;
         |FINSI;

         |SI nModo = 2;
             |GRABA 020#av060m02.a;
         |FINSI;
     |FINSI;
     |LIBERA #av060m02;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |REFRESCACONTROL nGrid02;
     |FOCOTECLADO nGrid02;
     |PULSATECLA;
|FPRC;

|PROCESO BtnAltB;
     aFrom    = #dsam0001#13;  |QBF aFrom;
     |SI aFrom = "";
         |MENAV "0000Configure el email de recepci¢n de avisos";
         |FOCOTECLADO nGrid02;
         |ACABA;
     |FINSI;

     nModo = 1;  |HAZ Entraav060m02;
|FPRC;

|PROCESO BtnModB;
     aFrom    = #dsam0001#13;  |QBF aFrom;
     |SI aFrom = "";
         |MENAV "0000Configure el email de recepci¢n de avisos";
         |FOCOTECLADO nGrid02;
         |ACABA;
     |FINSI;

     |LEE 101#av060m02.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nModo = 2;  |HAZ Entraav060m02;
|FPRC;

|PROCESO BtnBorB;
     aFrom    = #dsam0001#13;  |QBF aFrom;
     |SI aFrom = "";
         |MENAV "0000Configure el email de recepci¢n de avisos";
         |FOCOTECLADO nGrid02;
         |ACABA;
     |FINSI;

     |LEE 101#av060m02.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el registro seleccionado";
     |SI FSalida ! 0;
         |LIBERA #av060m02;
         |ACABA;
     |FINSI;

     |BORRA 020#av060m02.a;
     |LIBERA #av060m02;

     nModo = 3;
     |HAZ MandaCorreoB;

     |REFRESCACONTROL nGrid02;
     |FOCOTECLADO nGrid02;
|FPRC;

|PROCESO BtnEmail;
     |VENTANA 0501, 2270, -1, 16, "Configuraci¢n email recepci¢n de avisos";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #dsam0001;
     |LEE 000#dsam0001.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0001;  |FINSI;

     #av060w03#0 = #dsam0001#13;
     #av060w03#1 = #dsam0001#15;
     #av060w03#2 = #dsam0001#16;
     #av060w03#3 = #dsam0001#17;

     |PINPA #0#av060w03;
     |PINDA #0#av060w03;

     |ENDATOS #1#av060w03;
     |SI FSalida = 0;
         |LEE 101#dsam0001.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsam0001;
             |GRABA 020#dsam0001.b;
         |FINSI;
         #dsam0001#13 = #av060w03#0;
         #dsam0001#15 = #av060w03#1;
         #dsam0001#16 = #av060w03#2;
         #dsam0001#17 = #av060w03#3;

         |GRABA 020#dsam0001.a;
         |LIBERA #dsam0001;
     |FINSI;

     |CIERRA #dsam0001;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |FOCOTECLADO nGrid01;
     |PULSATECLA;
|FPRC;

|PROCESO Evento03;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsam0016.=;

         |ESTADO_CONTROL nBtnBorrUsu, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO BtnAltaUsu;
     |ABRE #dsam0108;
     |CONSULTA_CLAVE #1#dsam0108;
     |SI FSalida = 0;
         #dsam0016#0 = #dsam0108#0;
         |LEE 101#dsam0016.=;
         |SI FSalida ! 0;
             aAlfa = #dsam0108#3;  |QBF aAlfa;
             |SI aAlfa = "";
                 |MENAV "0000El usuario no tiene el e_mail configurado.";
             |SINO;
                 |DDEFECTO #dsam0016;
                 #dsam0016#0 = #dsam0108#0;
                 |GRABA 020#dsam0016.n;
             |FINSI;
         |SINO;
             |MENAV "0000El usuario ya est  en la lista";
         |FINSI;
         |LIBERA #dsam0016;
     |FINSI;
     |CIERRA #dsam0108;

     |REFRESCACONTROL nGrid03;
     |FOCOTECLADO nGrid03;
|FPRC;

|PROCESO BtnBorrUsu;
     |LEE 101#dsam0016.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro que quiere borrar el usuario seleccionado";
     |SI FSalida ! 0;
         |LIBERA #dsam0016;
         |ACABA;
     |FINSI;

     |BORRA 020#dsam0016.a;
     |LIBERA #dsam0016;

     |REFRESCACONTROL nGrid03;

     |FOCOTECLADO nGrid03;
|FPRC;

|PROCESO BtnUsus;
     |VENTANA 0501, 2035, -1, 16, "Lista usuarios avisos";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta ", 1826, 1834, BtnAltaUsu;
     nBtnAltaUsu = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}Borrar", 1816, 1824, BtnBorrUsu;
     nBtnBorrUsu = FSalida;

     |ABRE #dsam0016;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#dsam0016, nRango, 0502, 1734, NULL, NULL, Evento03;
     nGrid03 = FSalida;

     |ESTADO_CONTROL nBtnBorrUsu, "DISABLE";

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid03;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |CIERRA #dsam0016;

     |FIN_CONTROL_WINDOWS nBtnAltaUsu;
     |FIN_CONTROL_WINDOWS nBtnBorrUsu;

     |DESTRUYECONTROL nGrid03;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |FOCOTECLADO nGrid01;
|FPRC;

|PROCESO BtnTarea;
     |VENTANA 0501, 0950, -1, 16, "Configuraci¢n tarea recepci¢n de avisos";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |SUB_EJECUTA "av060z01";

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |FOCOTECLADO nGrid01;
|FPRC;

|PROCESO Explorador;
     |HAZ CogeMac;

     |ABRE #dsmom108;
     #dsmom108#0 = eaDSMAC;
     |LEE 101#dsmom108.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom108;
         #dsmom108#0 = eaDSMAC;
         |GRABA 020#dsmom108.b;
     |FINSI;

     eaPathExplorador = #dsmom108#3;  |QBF eaPathExplorador;

     |SI eaPathExplorador = "";  |O eaForzExplorador = "S";
         |MENAV "0000Busque y pinche en el explorador con el que quiera trabajar";

         eaPathExplorador = "F" + eaPathExplorador;
         |BROWSE eaPathExplorador;
         eaPathExplorador = eaPathExplorador % 290;  |QBF eaPathExplorador;
     |FINSI;

     |SI eaPathExplorador ! "";
         #dsmom108#3 = eaPathExplorador;
     |FINSI;

     |GRABA 020#dsmom108.a;
     |LIBERA #dsmom108;
     |CIERRA #dsmom108;
|FPRC;

|PROCESO Explora;
     eaForzExplorador = "S";
     |HAZ Explorador;

     #dsaw0041#0 = eaPathExplorador;   |PINTA #dsaw0041#0;
|FPRC;

|PROCESO BtnURL;
     |VENTANA 0501, 1287, -1, 16, "Configuraci¢n URL 060";
     n2Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     eaForzExplorador = "N";
     |HAZ Explorador;

     #dsaw0041#0 = eaPathExplorador;

     |ABRE #dsam0001;
     |LEE 101#dsam0001.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0001;  |FINSI;

     #dsaw0041#1 = #dsam0001#11;

     |PINPA #0#dsaw0041;  nPanta41 = FSalida;
     |PINDA #0#dsaw0041;

     |CONTROL_SIMPLE nPanta41, "BOTON,{{197}}", 0786, 0787, Explora;

     |ENDATOS #1#dsaw0041;
     |SI FSalida = 0;
         |LEE 101#dsam0001.=;
         |SI FSalida ! 0;
             |DDEFECTO #dsam0001;
             |GRABA 020#dsam0001.b;
         |FINSI;
         #dsam0001#11 = #dsaw0041#1;

         |GRABA 020#dsam0001.a;
         |LIBERA #dsam0001;
     |FINSI;

     |CIERRA #dsam0001;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n2Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n2Vent;

     |REFRESCACONTROL nGrid01;
     |FOCOTECLADO nGrid01;
     |PULSATECLA;
|FPRC;

|PROCESO Bajam02;
     #av060m02#0  = #av060m01#0;
     #av060m02#1  = "";
|FPRC;

|PROCESO Altam02;
     #av060m02#0  = #av060m01#0;
     #av060m02#1  = "zzzzzzzzzzzz";
|FPRC;

|PROCESO EntraConf;
     |VENTANA 0501, 3599, -1, 16, "Configurci¢n DEH";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}CERTIFICADOS ACTIVADOS EN EL DEH", 0502, 0550, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Doble click en el registro para ver los avisos del buz¢n", 3302, 3360, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{15}}BUZONES DEL CERTIFICADO", 1702, 1750, NULL;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta ", 1662, 1672, BtnAltC;
     nBtnAltC = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar", 1674, 1686, BtnModC;
     nBtnModC = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}Borrar", 1688, 1698, BtnBorC;
     nBtnBorC = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta ", 3362, 3372, BtnAltB;
     nBtnAltB = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar", 3374, 3386, BtnModB;
     nBtnModB = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}Borrar", 3388, 3398, BtnBorB;
     nBtnBorB = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Lista usuarios avisos", 3502, 3520, BtnUsus;
     nBtnUsus = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Email recepci¢n de avisos", 3522, 3543, BtnEmail;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Horario recogida ", 3545, 3561, BtnTarea;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Configuraci¢n URL", 3563, 3580, BtnURL;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#av060m01, nRango, 0602, 1598, NULL, NULL, Evento01;
     nGrid01 = FSalida;

     |LINEAL_SIMPLE #1#av060m02, nRango, 1802, 3298, Bajam02, Altam02, Evento02;
     nGrid02 = FSalida;

     |ESTADO_CONTROL nBtnBorC, "DISABLE";
     |ESTADO_CONTROL nBtnModC, "DISABLE";
     |ESTADO_CONTROL nBtnAltB, "DISABLE";
     |ESTADO_CONTROL nBtnModB, "DISABLE";
     |ESTADO_CONTROL nBtnBorB, "DISABLE";
     |ESTADO_CONTROL nBtnVerN, "DISABLE";

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid01;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBtnAltC;
     |FIN_CONTROL_WINDOWS nBtnModC;
     |FIN_CONTROL_WINDOWS nBtnBorC;
     |FIN_CONTROL_WINDOWS nBtnAltB;
     |FIN_CONTROL_WINDOWS nBtnModB;
     |FIN_CONTROL_WINDOWS nBtnBorB;
     |FIN_CONTROL_WINDOWS nBtnVerN;
     |FIN_CONTROL_WINDOWS nBtnPagi;
     |FIN_CONTROL_WINDOWS nBtnUsus;

     |DESTRUYECONTROL nGrid01;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROGRAMA;
     |DBASS aBase;  |QBF aBase;
     aAlfa = aBase + "dsarchi/dsarchi.men";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida < 0;
         |MENAV "0000El programa necesita el GAD instalado con la configuraci¢n del DSCORREO.";
         |ACABA;
     |FINSI;

     aAlfa = aBase + "dsarchi/fich/";
     |PATH_DAT #dsarw010#aAlfa#;
     |ABRE #dsarw010;
     |LEE 000#dsarw010.p;
     |SI FSalida ! 0;  |DDEFECTO #dsarw010;  |FINSI;
     |CIERRA #dsarw010;

     aAlfa = #dsarw010#18 + #dsarw010#19;  |QBT aAlfa;
     |SI aAlfa = "";
         |MENAV "0000No est  configurado el DSCORREO en GAD.";
         |ACABA;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aDirCorreo  = aBase + "dscorreo/";  |MKDIR aDirCorreo;

     |ABRE #dsam0001;
     |LEE 000#dsam0001.p;
     |SI FSalida ! 0;  |DDEFECTO #dsam0001;  |FINSI;
     |CIERRA #dsam0001;

     |VENTANA 0501, 3599, -1, 0, "";
     n0Vent = FSalida;
     |PTEC 802;  |PAUSA;

     |HAZ EntraConf;

     |FINVENTANA n0Vent;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     |ABRET #av060m01;
     |ABRET #av060m02;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #av060m01;
     |CIERRAT #av060m02;
|FPRC;
