|FICHEROS;
     audtrz02;

     audtrm01;
     audtrw01;
     audtrw02;

     dsam0108;
|FIN;

|VARIABLES;
     nVentana       = 0;
     nVentTrab      = 0;
     nBtnSalir      = -1;
     nBtnSacar      = -1;
     nID            = 0;
     nNume          = 0;
     nTecla         = 0;
     nPanta         = 0;
     nSalir         = 0;
     nDura          = 0;
     nLong          = 0;
     nCalculo       = 0;
     nDiaD          = 0;
     nDiaH          = 0;
     nGrid1         = 0;
     nGrid2         = 0;
     nGrid3         = 0;
     nRango         = 0;
     nCampo         = 0;

     aQueBoton      = "";
     aID            = "";
     aAlfa          = "";
     aAlfa1         = "";
     aEsc1          = "";
     aEsc2          = "";
     aRetu          = "";
     aTecla         = "";
     aFich          = "";

     fFecha         = @;

     {-1}aVent      = "";
         aVent1     = 0;
         aVent2     = 0;
         aVent3     = 0;
         aVent4     = 0;
         aVent5     = "";
|FIN;

|PROCESO audtrw01;
     #audtrw01#3  = #audtrw01#3  - #audtrw01#2;
     #audtrw01#7  = #audtrw01#7  - #audtrw01#6;
     #audtrw01#11 = #audtrw01#11 - #audtrw01#10;

     |PRINT;
|FPRC;

|DEFBUCLE audtrw01;
     #audtrw01#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, audtrw01;
|FIN;

|PROCESO Informe;
     Impresora = "CrystalReport";
     |IMPRE -1;

     |INFOR "audit001";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |BUCLE audtrw01;

     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO Infw02
     #audtrw02#0 = #audtrw01#0;
     #audtrw02#1 = #audtrz02#0;
|FPRC;

|PROCESO Supw02
     #audtrw02#0 = #audtrw01#0;
     #audtrw02#1 = #audtrz02#1;
|FPRC;

|PROCESO Infm01;
     #audtrm01#1  = #audtrw02#1;
     |SI #audtrz02#6 = "C";
          #audtrm01#12 = #audtrw02#0;
     |SINO;
          #audtrm01#14 = #audtrw02#0;
     |FINSI;
     #audtrm01#2  = "";
     #audtrm01#3  = 0;
|FPRC;

|PROCESO Supm01;
     #audtrm01#1  = #audtrw02#1;
     |SI #audtrz02#6 = "C";
          #audtrm01#12 = #audtrw02#0;
     |SINO;
          #audtrm01#14 = #audtrw02#0;
     |FINSI;
     #audtrm01#2  = "zzzzzzzz";
     #audtrm01#3  = 999;
|FPRC;

|PROCESO EvtoGrid1;
     |SI nSalir = 1;  |ACABA;  |FINSI;

     |SI FSalida = 1; |O FSalida = 2;
        |LEE 000#audtrw01.=;

        #audtrw02#0 = #audtrw01#0;
        #audtrw02#1 = "01.01.0000";
        |LEE 000#audtrw02.];

        |REFRESCACONTROL nGrid2;
        |REFRESCACONTROL nGrid3;
     |FINSI;
|FPRC;

|PROCESO EvtoGrid2;
     |SI FSalida = 1; |O FSalida = 2;
         |LEE 000#audtrw02.=;

         #audtrm01#1  = #audtrw02#1;
         |SI #audtrz02#6 = "C";
               #audtrm01#12 = #audtrw02#0;
         |SINO;
               #audtrm01#14 = #audtrw02#0;
         |FINSI;
         #audtrm01#2  = "";
         #audtrm01#3  = 0;
         |LEE 000#audtrm01.];

         |REFRESCACONTROL nGrid3;
     |FINSI;
|FPRC;

|PROCESO EvtoGrid3;
     |SI FSalida = 1; |O FSalida = 2;
         |LEE 000#audtrm01.=;
     |FINSI;
|FPRC;

|PROCESO PresentaDatos;
     |VENTANA 0501, 3399, -1, 0,  "";
     nVentana = FSalida;

     |PTEC 802;  |PAUSA;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Informe", 3302, 3320, Informe;

     nRango = 2 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#audtrw01, nRango, 0602, 1765, NULL, NULL, EvtoGrid1;
     nGrid1 = FSalida;

     |LINEAL_SIMPLE #1#audtrw02, nRango, 0670, 1785, Infw02, Supw02, EvtoGrid2;
     nGrid2 = FSalida;

     |SI #audtrz02#6 = "C";
          |LINEAL_SIMPLE #3#audtrm01, nRango, 1902, 3198, Infm01, Supm01, EvtoGrid3;
     |SINO;
          |LINEAL_SIMPLE #2#audtrm01, nRango, 1902, 3198, Infm01, Supm01, EvtoGrid3;
     |FINSI;
     nGrid3 = FSalida;

     |PULSATECLA;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid1;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL; |FINSI;
          |SI aTecla = aEsc2; |SAL; |FINSI;
          |SI aTecla = aRetu; |SAL; |FINSI;
     |SIGUE;

     |FINVENTANA nVentana;
|FPRC;

|PROCESO audtrm01;
     |SI #audtrz02#6 = "C";
          aAlfa = ("00000" + #audtrm01#12) % -105;
          #audtrw01#0 = aAlfa;
          |LEE 101#audtrw01.=;
          |SI FSalida ! 0;
              |DDEFECTO #audtrw01;
              #audtrw01#0 = aAlfa;
              |GRABA 020#audtrw01.b;
          |FINSI;
          #audtrw01#1 = #audtrm01#13;
     |SINO;
          #audtrw01#0 = #audtrm01#14;
          |LEE 101#audtrw01.=;
          |SI FSalida ! 0;
              |DDEFECTO #audtrw01;
              #audtrw01#0 = #audtrm01#14;
              |GRABA 020#audtrw01.b;
          |FINSI;
          #audtrw01#1 = #audtrm01#15;
     |FINSI;

     |SI #audtrm01#6 = "0101";  nCampo = 2;   |FINSI;
     |SI #audtrm01#6 = "0102";  nCampo = 6;   |FINSI;
     |SI #audtrm01#6 = "0103";  nCampo = 10;  |FINSI;
     |SI #audtrm01#6 = "0201";  nCampo = 14;  |FINSI;
     |SI #audtrm01#6 = "0202";  nCampo = 18;  |FINSI;
     |SI #audtrm01#6 = "0203";  nCampo = 22;  |FINSI;
     |SI #audtrm01#6 = "0301";  nCampo = 26;  |FINSI;
     |SI #audtrm01#6 = "0302";  nCampo = 30;  |FINSI;
     |SI #audtrm01#6 = "0303";  nCampo = 34;  |FINSI;
     |SI #audtrm01#6 = "0304";  nCampo = 38;  |FINSI;
     |SI #audtrm01#6 = "0305";  nCampo = 42;  |FINSI;
     |SI #audtrm01#6 = "0306";  nCampo = 46;  |FINSI;
     |SI #audtrm01#6 = "0401";  nCampo = 50;  |FINSI;
     |SI #audtrm01#6 = "0402";  nCampo = 54;  |FINSI;
     |SI #audtrm01#6 = "0403";  nCampo = 58;  |FINSI;
     |SI #audtrm01#6 = "0404";  nCampo = 62;  |FINSI;
     |SI #audtrm01#6 = "0501";  nCampo = 66;  |FINSI;
     |SI #audtrm01#6 = "0502";  nCampo = 70;  |FINSI;
     |SI #audtrm01#6 = "0503";  nCampo = 74;  |FINSI;
     |SI #audtrm01#6 = "0504";  nCampo = 78;  |FINSI;
     |SI #audtrm01#6 = "0505";  nCampo = 82;  |FINSI;

     |SI #audtrm01#4 = "2";  nCampo = nCampo + 1;  |FINSI;
     |SI #audtrm01#4 = "3";  nCampo = nCampo + 2;  |FINSI;
     |SI #audtrm01#4 = "4";  nCampo = nCampo + 3;  |FINSI;

     #audtrw01#nCampo# = #audtrw01#nCampo# + 1;

     |GRABA 020#audtrw01.a;
     |LIBERA #audtrw01;

     |SI #audtrz02#6 = "C";
          aAlfa = ("00000" + #audtrm01#12) % -105;
          #audtrw02#0 = aAlfa;
          #audtrw02#1 = #audtrm01#1;
          |LEE 101#audtrw02.=;
          |SI FSalida ! 0;
              |DDEFECTO #audtrw02;
              #audtrw02#0 = aAlfa;
              #audtrw02#1 = #audtrm01#1;
              |GRABA 020#audtrw02.n;
          |FINSI;
     |SINO;
          #audtrw02#0 = #audtrm01#14;
          #audtrw02#1 = #audtrm01#1;
          |LEE 101#audtrw02.=;
          |SI FSalida ! 0;
              |DDEFECTO #audtrw02;
              #audtrw02#0 = #audtrm01#14;
              #audtrw02#1 = #audtrm01#1;
              |GRABA 020#audtrw02.n;
          |FINSI;
     |FINSI;
     |LIBERA #audtrw02;
|FPRC;

|DEFBUCLE audtrm01;
     #audtrm01#2;
     12;
     #audtrz02#0, #audtrz02#2, "        ", 000, #audtrz02#4;
     #audtrz02#1, #audtrz02#3, "zzzzzzzz", 999, #audtrz02#5;
     ;
     NULL, audtrm01;
|FIN;

|PROCESO Tipo12;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Procesando trabajo";
     nVentana = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
     |PULSATECLA;

     aFich = "audtrw01" + Usuario;   |NOME_DAT #audtrw01#aFich#;
     aFich = "audtrw02" + Usuario;   |NOME_DAT #audtrw02#aFich#;

     |ABRE #audtrw01;  |CIERRA #audtrw01;  |DELINDEX #audtrw01;
     |ABRE #audtrw02;  |CIERRA #audtrw02;  |DELINDEX #audtrw02;

     |ABRE #audtrw01;
     |ABRE #audtrw02;
     |BUCLE audtrm01;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana;

     |LEE 000#audtrw01.p;
     |SI FSalida = 0;
         |HAZ PresentaDatos;
     |SINO;
         |MENAV "0000Selecci¢n vac¡a.";
     |FINSI;

     |CIERRA #audtrw01;  |DELINDEX #audtrw01;
     |CIERRA #audtrw02;  |DELINDEX #audtrw02;
|FPRC;

|PROCESO Ptec807;
     nSalir = 1;
     |PTEC 807;
|FPRC;

|PROCESO Ptec806;
     |PTEC 806;
|FPRC;

|PROCESO Tipo7C0;  |TIPO 7;
     |SI nBtnSalir ! -1;  |ACABA;  |FINSI;

     aQueBoton = "|X000";
     aID       = #audtrz02#aQueBoton#;
     nID       = aID;
     |FIN_CONTROL_WINDOWS nID;

     aQueBoton = "|X001";
     aID       = #audtrz02#aQueBoton#;
     nID       = aID;
     |FIN_CONTROL_WINDOWS nID;

     |CONTROL_SIMPLE 0, "BOTON,{{001}}Salir", 3185, 3195, Ptec807;
     nBtnSalir = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Presentar datos", 3165, 3182, Ptec806;
     nBtnSacar = FSalida;
|FPRC;

|PROCESO Tipo7C1;  |TIPO 7;
     |SI nCalculo = 0;  |ACABA;  |FINSI;

     |SI nCalculo = 1;
         aAlfa        = "01.01" + (#audtrz02#0 % -105);
         #audtrz02#0  = aAlfa;
         aAlfa        = "31.12" + (#audtrz02#0 % -105);
         #audtrz02#1  = aAlfa;
     |FINSI;

     |SI nCalculo = 2;
         aAlfa       = "01." + (#audtrz02#0 % 402) + (#audtrz02#0 % -105);
         #audtrz02#0 = aAlfa;
         #audtrz02#1 = #audtrz02#0 + "0.001";
         nNume       = #audtrz02#1;
         nNume       = nNume - 1;
         #audtrz02#1 = nNume;
     |FINSI;

     |SI nCalculo = 3;
         fFecha      = #audtrz02#0 % 1;
         aAlfa       = (fFecha % 1110) > "";  |QBF aAlfa;

         |SI aAlfa   = "LUNES";      nDiaD = 0;  nDiaH = 6;  |FINSI;
         |SI aAlfa   = "MARTES";     nDiaD = 1;  nDiaH = 5;  |FINSI;
         |SI aAlfa   = "MIERCOLES";  nDiaD = 2;  nDiaH = 4;  |FINSI;
         |SI aAlfa   = "JUEVES";     nDiaD = 3;  nDiaH = 3;  |FINSI;
         |SI aAlfa   = "VIERNES";    nDiaD = 4;  nDiaH = 2;  |FINSI;
         |SI aAlfa   = "SABADO";     nDiaD = 5;  nDiaH = 1;  |FINSI;
         |SI aAlfa   = "DOMINGO";    nDiaD = 6;  nDiaH = 0;  |FINSI;

         nDiaD       = #audtrz02#0 - nDiaD;
         nDiaH       = #audtrz02#0 + nDiaH;

         #audtrz02#0 = nDiaD;
         #audtrz02#1 = nDiaH;
     |FINSI;

     |PINTA #audtrz02#0;
     |PINTA #audtrz02#1;

     |PULSATECLA;
     nCalculo = 0;
|FPRC;

|PROCESO SacaAnyo;
     nCalculo = 1;
     |POSICIONATE #audtrz02#1;
     |PTEC 802;
|FPRC;

|PROCESO SacaMes;
     nCalculo = 2;
     |POSICIONATE #audtrz02#1;
     |PTEC 802;
|FPRC;

|PROCESO SacaSemana;
     nCalculo = 3;
     |POSICIONATE #audtrz02#1;
     |PTEC 802;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Auditoria de procesos realizados";

     |DDEFECTO #audtrz02;
     |PINPA #0#audtrz02; nPanta = FSalida;

     nCalculo = 3;
     |HAZ Tipo7C1;

     |ABRE #dsam0108;
     |LEE 000#dsam0108.p;
     |SI FSalida ! 0;  |DDEFECTO #dsam0108;  |FINSI;

     #audtrz02#2 = #dsam0108#0;

     |LEE 000#dsam0108.u;
     |SI FSalida ! 0;  |DDEFECTO #dsam0108;  |FINSI;

     #audtrz02#3 = #dsam0108#0;

     |CIERRA #dsam0108;

     |CONTROL_SIMPLE nPanta, "BOTON,A¤o", 0832, 0842, SacaAnyo;
     |CONTROL_SIMPLE nPanta, "BOTON,Mes", 0932, 0942, SacaMes;
     |CONTROL_SIMPLE nPanta, "BOTON,Semana", 1032, 1042, SacaSemana;

     nSalir = 0;
     |PARA;  |SI;  |HACIENDO;
          |PINDA #0#audtrz02;

          |ENDATOS #1#audtrz02;
          |SI FSalida ! 0;  |SAL;  |FINSI;
          |SI nSalir  = 1;  |SAL;  |FINSI;

          |FIN_CONTROL_WINDOWS nBtnSalir;
          |FIN_CONTROL_WINDOWS nBtnSacar;

          nBtnSalir = -1;
          nBtnSacar = -1;

          |PULSATECLA;
     |SIGUE;
|FPRO;


|PROCESO Tipo80;  |TIPO 80;
     |ABRET #audtrm01;

     FSalida = 3199;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #audtrm01;
|FPRC;
