|FICHEROS;
     Referen@ #1000;
|FIN;

|VARIABLES;
     aAplica = "";
     nEmpresa = 0;
     aEmpresa = "";

     aRels  = "";
     aAlfa6 = "";

     nNumRels = 0;
     nCont    = 0;
     nCalc    = 0;
     nCalc1   = 0;
     nOpcion  = 0;

     aParametro = "";
     aAlfa = "";
     nSalida = 0;
     aPrograma = "";
     aBase = "";
     aPathDef = "";
     aPathFic = "";
     aQueQuiero = "";
     aNomDef = "";
     aMensaje = "";
     aFichRel = "";

     aAlfa5 = "";
     aClaves = "";
     aTCompo = "";
     nTCompo = 0;
     aTCompo2 = "";
     nTCompo2 = 0;
     {16}clave = 0;      ||Array de 16 elementos para la clave.
     nCompo = 0;
     nPosi = 0;
     aTCampos = "";
     nTCampos = 0;
     nCampo = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     aClave = "";
     nNumCam = 0;
     aFicERP = "";
     aDSERP = "";

     &PRMNT_Def = "";
     aLong = "";
     nLong = 0;
     nPos  = 0;

     nNumCmps    = 0;
   {2}nPuntero   = 0;
     aSalida = "";

     nSwSaltaRel = 0;
|FIN;

|PROCESO &EVENTOGRID;
     |SI Campo = -1;
          nSwSaltaRel = 1;
     |SINO;
          nSwSaltaRel = 0;
     |FINSI;

     aSalida = FSalida;
     |QBF aSalida;
     |SI aSalida = "1771";
          aMensaje = "0000Esta opcion solo funciona estando dentro del campo. Codigo 1771";
          |MENAV aMensaje;
     |SINO;
          aSalida = aSalida % 104;
          |SI aSalida = "1771";
               FSalida = 4;
               |HAZ ControlGrid;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ControlGrid; |TIPO 77;
   nSalida = FSalida;
   |SI FSalida = 4;
     ||Primero miro si tengo instalado el dserp

     |DBASS aFicERP;
     |QBF aFicERP;
     aDSERP = aFicERP + "dserp/def/dserpm01.mas";
     |XABRE "E", aDSERP, 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nCampo = Campo;

     |DBASE aBase;
     |QBF aBase;
     aPathDef = aBase + "def/";
     aQueQuiero = "|DEF";
     aNomDef = #Fichero@#aQueQuiero#;
     |QBF aNomDef;
     aNomDef = aNomDef - aPathDef;
     |QBF aNomDef;
     aNomDef = (aNomDef + "        ") % 108;
     |MODULO aPrograma;
     |QBF aPrograma;
     |DFICE aPathFic;
     |QBF aPathFic;

     |SI nSwSaltaRel = 0;
          aAlfa5 = "|NR"; aAlfa5 = #Fichero@#aAlfa5#;
          nNumRels = aAlfa5; nNumRels = nNumRels - 1;
          |PARA nCont = 0; |SI nCont [ nNumRels; |HACIENDO nCont = nCont + 1;
             aAlfa5 = "|R" + (("000" + nCont) % -103);
             aAlfa5 = #Fichero@#aAlfa5#;
             aAlfa5 = aAlfa5 - "|";
             |SI FSalida ! 0;
                nCalc = ((FSalida / 100) ! 0) + 99;
                aFichRel = aAlfa5 % nCalc;
                nCalc = FSalida + 98;
                aAlfa5 = aAlfa5 % nCalc; aAlfa5 = aAlfa5 % 0499; aRels = aAlfa5;
                |PARA; |SI aAlfa5 ! ""; |HACIENDO;
                   aAlfa6 = aAlfa5 % 0103; aAlfa5 = aAlfa5 % 0499;
                   nCalc = aAlfa6; nCalc = nCalc - 1;
                   |SI nCalc = nCampo; |SAL; |FINSI;
                |SIGUE;
                |SI nCalc = nCampo; |SAL; |FINSI;
             |FINSI;
          |SIGUE;
          |SI nCalc = nCampo;
             aAlfa5 = aPathDef + aAlfa5; |QBF aAlfa5;
             aAlfa5 = aAlfa5 + aFichRel + ".mas";
             |CARGA_DEF aAlfa5, Referen@;
             |SI FSalida = 0;
                |ENLAZA_PROCESO #Referen@#0,ControlGrid,77;
                |PATH_DAT #1000 aPathFic;
                |ABRE #Referen@;  aAlfa5 = "|K000";
                aAlfa5 = #Referen@#aAlfa5#; aAlfa5 = aAlfa5 % 0499;
                |PARA; |SI aAlfa5 ! ""; |HACIENDO;
                   aAlfa6 = aAlfa5 % 0103; aAlfa5 = aAlfa5 % 0499;
                   nCalc = aAlfa6;
                   aAlfa6 = aRels % 0103; aRels = aRels % 0499;
                   nCalc1 = aAlfa6; nCalc1 = nCalc1 - 1;
                   #Referen@#nCalc# = #Fichero@#nCalc1#;
                |SIGUE;
                |LEE 000#Referen@.];
                |PUSHV 0501 2380;
                |PINPA #0#Referen@; |PINDA #0#Referen@;
                |PUSHV 0501 2380;
                |HAZ Relacionado;
                |POPV;
                |POPV;
                ||CONSULTA_CLAVE #1#Referen@;
                |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
                |ACABA;
             |SINO;
                aAlfa5 = "    No encuentro el def a cargar. [" + aAlfa5 + "," + FSalida + "]";
                |MENAV aAlfa5;
             |FINSI;
          |FINSI;
     |FINSI;
     ||TODO CCC.
     nSwSaltaRel = 1;

     aAlfa5 = "|K000";
     aClaves = #Fichero@#aAlfa5#;
     aTCompo = aClaves % 103;
     nTCompo = aTCompo;
     Iclave = clave1<-;
     |PARA nCampo = 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
          clave = 0;
          Iclave = Iclave + 1;
     |SIGUE;

     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nPosi = (nCompo * 300) + 103;
          aAlfa1 = aClaves % nPosi;
          clave = aAlfa1;
          Iclave = Iclave + 1;
     |SIGUE;

     aClave = "";
     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nNumCam = clave;
          Iclave = Iclave + 1;
          aAlfa2 = #Fichero@#nNumCam#;

          aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "TIPO";
          aAlfa      = #Fichero@#aQueQuiero#;
          |SI aAlfa = "N";
              aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "LONGITUD";
              aAlfa      = #Fichero@#aQueQuiero#;
              nLong      = aAlfa;
              nPos       = -(100 + nLong);
              aAlfa2     = (("0" * aAlfa) + aAlfa2) % nPos;
          |FINSI;

          aClave = aClave + aAlfa2;
     |SIGUE;

     ||aMensaje = "0000Clave: " + aClave;

     aAlfa = (aClave + "                                                                                                    ") % 199;
     aClave = aAlfa;
     aAlfa = (aClave + "                                                                                                    ") % 10001;
     aClave = aClave + aAlfa;

     ||Tengo que a¤adir antes .. el nombre de la aplicacion y numero de empresa
     |NOMAP aAplica;
     |QBF aAplica

     aAplica    = (aAplica + "        ") % 108;
     aEmpresa   = "00000";
     aParametro = aAplica + aEmpresa + aNomDef + aClave + aPathDef + "@" + aPathFic;
     aAlfa      = ":dserp/dserpm08;" + aParametro;

     |SUB_EJECUTA aAlfa;
  |FINSI;
|FPRC;


|PROCESO Relacionado;
     aAlfa5 = "|K000";
     aClaves = #Referen@#aAlfa5#;
     aTCompo = aClaves % 103;
     nTCompo = aTCompo;
     Iclave = clave1<-;
     |PARA nCampo = 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
          clave = 0;
          Iclave = Iclave + 1;
     |SIGUE;

     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nPosi = (nCompo * 300) + 103;
          aAlfa1 = aClaves % nPosi;
          clave = aAlfa1;
          Iclave = Iclave + 1;
     |SIGUE;

     aClave = "";
     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nNumCam = clave;
          Iclave = Iclave + 1;
          aAlfa2 = #Referen@#nNumCam#;

          aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "TIPO";
          aAlfa      = #Referen@#aQueQuiero#;
          |SI aAlfa = "N";
              aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "LONGITUD";
              aAlfa      = #Referen@#aQueQuiero#;
              nLong      = aAlfa;
              nPos       = -(100 + nLong);
              aAlfa2     = (("0" * aAlfa) + aAlfa2) % nPos;
          |FINSI;

          aClave = aClave + aAlfa2;
     |SIGUE;

     ||aMensaje = "0000Clave: " + aClave;

     aAlfa = (aClave + "                                                                                                    ") % 199;
     aClave = aAlfa;
     aAlfa = (aClave + "                                                                                                    ") % 10001;
     aClave = aClave + aAlfa;

     ||Tengo que a¤adir antes .. el nombre de la aplicacion y numero de empresa
     |NOMAP aAplica;
     |QBF aAplica
     aAplica = (aAplica + "        ") % 108;

     ||nEmpresa = #48#0;
     ||Esto en la integral PETA.
     nEmpresa = 0;
     aEmpresa = ("00000" + nEmpresa) % -105;

     aParametro = aAplica + aEmpresa + aFichRel + aClave + aPathDef + "@" + aPathFic;
     aAlfa      = ":dserp/dserpm08;" + aParametro;

     |SUB_EJECUTA aAlfa;
     ||PTEC 807;
|FPRC;


|PROCESO &EVENTOPBX;

     |SI Campo = -1;
          nSwSaltaRel = 1;
     |SINO;
          nSwSaltaRel = 0;
     |FINSI;

     aSalida = FSalida;
     |QBF aSalida;
     |SI aSalida = "1771";
          aMensaje = "0000Esta opcion solo funciona estando dentro del campo. Codigo 1771";
          |MENAV aMensaje;
     |SINO;
          aSalida = aSalida % 104;
          |SI aSalida = "1771";
               |HAZ BotonPBX;
          |FINSI;
     |FINSI;

|FPRC;

|PROCESO BotonPBX;

     nCampo = Campo;

     |DBASS aFicERP;
     |QBF aFicERP;
     aDSERP = aFicERP + "dserp/def/dserpm01.mas";
     |XABRE "E", aDSERP, 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DBASE aBase;
     |QBF aBase;
     aPathDef = aBase + "def/";
     aQueQuiero = "|DEF";
     aNomDef = #Fichero@#aQueQuiero#;
     |QBF aNomDef;
     aNomDef = aNomDef - aPathDef;
     |QBF aNomDef;
     aNomDef = (aNomDef + "        ") % 108;
     |MODULO aPrograma;
     |QBF aPrograma;
     |DFICE aPathFic;
     |QBF aPathFic;

     |SI nSwSaltaRel = 0;
          aAlfa5 = "|NR"; aAlfa5 = #Fichero@#aAlfa5#;
          nNumRels = aAlfa5; nNumRels = nNumRels - 1;
          |PARA nCont = 0; |SI nCont [ nNumRels; |HACIENDO nCont = nCont + 1;
             aAlfa5 = "|R" + (("000" + nCont) % -103);
             aAlfa5 = #Fichero@#aAlfa5#;
             aAlfa5 = aAlfa5 - "|";
             |SI FSalida ! 0;
                nCalc = ((FSalida / 100) ! 0) + 99;
                aFichRel = aAlfa5 % nCalc;
                nCalc = FSalida + 98;
                aAlfa5 = aAlfa5 % nCalc; aAlfa5 = aAlfa5 % 0499; aRels = aAlfa5;
                |PARA; |SI aAlfa5 ! ""; |HACIENDO;
                   aAlfa6 = aAlfa5 % 0103; aAlfa5 = aAlfa5 % 0499;
                   nCalc = aAlfa6; nCalc = nCalc - 1;
                   |SI nCalc = nCampo; |SAL; |FINSI;
                |SIGUE;
                |SI nCalc = nCampo; |SAL; |FINSI;
             |FINSI;
          |SIGUE;
          |SI nCalc = nCampo;
             ||TODO CCC.  En la integral, muchas relaciones son de este tipo.
             aFichRel = aFichRel - ":/integral/def/";

             aAlfa5 = aPathDef + aAlfa5; |QBF aAlfa5;
             aAlfa5 = aAlfa5 + aFichRel + ".mas";
             |CARGA_DEF aAlfa5, Referen@;
             |SI FSalida = 0;
                |ENLAZA_PROCESO #Referen@#0,ControlGrid,77;
                |PATH_DAT #1000 aPathFic;
                |ABRE #Referen@;  aAlfa5 = "|K000";
                aAlfa5 = #Referen@#aAlfa5#; aAlfa5 = aAlfa5 % 0499;
                |PARA; |SI aAlfa5 ! ""; |HACIENDO;
                   aAlfa6 = aAlfa5 % 0103; aAlfa5 = aAlfa5 % 0499;
                   nCalc = aAlfa6;
                   aAlfa6 = aRels % 0103; aRels = aRels % 0499;
                   nCalc1 = aAlfa6; nCalc1 = nCalc1 - 1;
                   #Referen@#nCalc# = #Fichero@#nCalc1#;
                |SIGUE;
                |LEE 000#Referen@.];
                |PUSHV 0501 2380;
                |PINPA #0#Referen@; |PINDA #0#Referen@;
                |PUSHV 0501 2380;
                |HAZ RelacionadoPBX;
                |POPV;
                |POPV;
                ||CONSULTA_CLAVE #1#Referen@;
                |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
                |ACABA;
             |SINO;
                aAlfa5 = "    No encuentro el def a cargar. [" + aAlfa5 + "," + FSalida + "]";
                |MENAV aAlfa5;
             |FINSI;
          |FINSI;
     |FINSI;

     aAlfa5 = "|K000";
     aClaves = #Fichero@#aAlfa5#;
     aTCompo = aClaves % 103;
     nTCompo = aTCompo;
     Iclave = clave1<-;
     |PARA nCampo = 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
          clave = 0;
          Iclave = Iclave + 1;
     |SIGUE;

     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nPosi = (nCompo * 300) + 103;
          aAlfa1 = aClaves % nPosi;
          clave = aAlfa1;
          Iclave = Iclave + 1;
     |SIGUE;

     aClave = "";
     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nNumCam = clave;
          Iclave = Iclave + 1;
          aAlfa2 = #Fichero@#nNumCam#;

          aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "TIPO";
          aAlfa      = #Fichero@#aQueQuiero#;
          |SI aAlfa = "N";
              aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "LONGITUD";
              aAlfa      = #Fichero@#aQueQuiero#;
              nLong      = aAlfa;
              nPos       = -(100 + nLong);
              aAlfa2     = (("0" * aAlfa) + aAlfa2) % nPos;
          |FINSI;

          aClave = aClave + aAlfa2;
     |SIGUE;

     ||aMensaje = "0000Clave: " + aClave;

     aAlfa = (aClave + "                                                                                                    ") % 199;
     aClave = aAlfa;
     aAlfa = (aClave + "                                                                                                    ") % 10001;
     aClave = aClave + aAlfa;

     ||Tengo que a¤adir antes .. el nombre de la aplicacion y numero de empresa
     |NOMAP aAplica;
     |QBF aAplica

     aAplica = (aAplica + "        ") % 108;

     ||nEmpresa = #48#0;
     ||Esto en la integral PETA.
     nEmpresa = 0;
     aEmpresa = ("00000" + nEmpresa) % -105;

     aParametro = aAplica + aEmpresa + aNomDef + aClave + aPathDef + "@" + aPathFic;
     aAlfa      = ":dserp/dserpm11;" + aParametro;
     |SUB_EJECUTA aAlfa;

/*
     aFicheroDef = aNomDef;
     |HAZ ControlPBX;

*/
|FPRC;

|PROCESO RelacionadoPBX;
     aAlfa5 = "|K000";
     aClaves = #Referen@#aAlfa5#;
     aTCompo = aClaves % 103;
     nTCompo = aTCompo;
     Iclave = clave1<-;
     |PARA nCampo = 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
          clave = 0;
          Iclave = Iclave + 1;
     |SIGUE;

     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nPosi = (nCompo * 300) + 103;
          aAlfa1 = aClaves % nPosi;
          clave = aAlfa1;
          Iclave = Iclave + 1;
     |SIGUE;

     aClave = "";
     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nNumCam = clave;
          Iclave = Iclave + 1;
          aAlfa2 = #Referen@#nNumCam#;

          aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "TIPO";
          aAlfa      = #Referen@#aQueQuiero#;
          |SI aAlfa = "N";
              aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "LONGITUD";
              aAlfa      = #Referen@#aQueQuiero#;
              nLong      = aAlfa;
              nPos       = -(100 + nLong);
              aAlfa2     = (("0" * aAlfa) + aAlfa2) % nPos;
          |FINSI;

          aClave = aClave + aAlfa2;
     |SIGUE;

     ||aMensaje = "0000Clave: " + aClave;

     aAlfa = (aClave + "                                                                                                    ") % 199;
     aClave = aAlfa;
     aAlfa = (aClave + "                                                                                                    ") % 10001;
     aClave = aClave + aAlfa;

     ||Tengo que a¤adir antes .. el nombre de la aplicacion y numero de empresa
     |NOMAP aAplica;
     |QBF aAplica
     aAplica = (aAplica + "        ") % 108;

     ||nEmpresa = #48#0;
     ||Esto en la integral PETA.
     nEmpresa = 0;
     aEmpresa = ("00000" + nEmpresa) % -105;

     aParametro = aAplica + aEmpresa + aFichRel + aClave + aPathDef + "@" + aPathFic;
     aAlfa      = ":dserp/dserpm11;" + aParametro;
     |SUB_EJECUTA aAlfa;
/*
     aFicheroDef = aFichRel;
     |QBF aFicheroDef;
     |HAZ ControlPBX;
*/

|FPRC;

|PROCESO &EVENTOCRM;
     |SI Campo = -1;
          nSwSaltaRel = 1;
     |SINO;
          nSwSaltaRel = 0;
     |FINSI;

     aSalida = FSalida;
     |QBF aSalida;
     |SI aSalida = "1771";
          aMensaje = "0000Esta opcion solo funciona estando dentro del campo. Codigo 1771";
          |MENAV aMensaje;
     |SINO;
          aSalida = aSalida % 104;
          |SI aSalida = "1771";
               |HAZ BotonCrm;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonCrm;
     nCampo = Campo;

     |DBASS aFicERP;
     |QBF aFicERP;
     aDSERP = aFicERP + "dserp/def/dserpm01.mas";
     |XABRE "E", aDSERP, 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DBASE aBase;
     |QBF aBase;
     aPathDef = aBase + "def/";
     aQueQuiero = "|DEF";
     aNomDef = #Fichero@#aQueQuiero#;
     |QBF aNomDef;
     aNomDef = aNomDef - aPathDef;
     |QBF aNomDef;
     aNomDef = (aNomDef + "        ") % 108;
     |MODULO aPrograma;
     |QBF aPrograma;
     |DFICE aPathFic;
     |QBF aPathFic;

     |SI nSwSaltaRel = 0;
          aAlfa5 = "|NR"; aAlfa5 = #Fichero@#aAlfa5#;
          nNumRels = aAlfa5; nNumRels = nNumRels - 1;
          |PARA nCont = 0; |SI nCont [ nNumRels; |HACIENDO nCont = nCont + 1;
             aAlfa5 = "|R" + (("000" + nCont) % -103);
             aAlfa5 = #Fichero@#aAlfa5#;
             aAlfa5 = aAlfa5 - "|";
             |SI FSalida ! 0;
                nCalc = ((FSalida / 100) ! 0) + 99;
                aFichRel = aAlfa5 % nCalc;
                nCalc = FSalida + 98;
                aAlfa5 = aAlfa5 % nCalc; aAlfa5 = aAlfa5 % 0499; aRels = aAlfa5;
                |PARA; |SI aAlfa5 ! ""; |HACIENDO;
                   aAlfa6 = aAlfa5 % 0103; aAlfa5 = aAlfa5 % 0499;
                   nCalc = aAlfa6; nCalc = nCalc - 1;
                   |SI nCalc = nCampo; |SAL; |FINSI;
                |SIGUE;
                |SI nCalc = nCampo; |SAL; |FINSI;
             |FINSI;
          |SIGUE;
          |SI nCalc = nCampo;
             aAlfa5 = aPathDef + aAlfa5; |QBF aAlfa5;
             aAlfa5 = aAlfa5 + aFichRel + ".mas";
             |CARGA_DEF aAlfa5, Referen@;
             |SI FSalida = 0;
                |ENLAZA_PROCESO #Referen@#0,ControlGrid,77;
                |PATH_DAT #1000 aPathFic;
                |ABRE #Referen@;  aAlfa5 = "|K000";
                aAlfa5 = #Referen@#aAlfa5#; aAlfa5 = aAlfa5 % 0499;
                |PARA; |SI aAlfa5 ! ""; |HACIENDO;
                   aAlfa6 = aAlfa5 % 0103; aAlfa5 = aAlfa5 % 0499;
                   nCalc = aAlfa6;
                   aAlfa6 = aRels % 0103; aRels = aRels % 0499;
                   nCalc1 = aAlfa6; nCalc1 = nCalc1 - 1;
                   #Referen@#nCalc# = #Fichero@#nCalc1#;
                |SIGUE;
                |LEE 000#Referen@.];
                |PUSHV 0501 2380;
                |PINPA #0#Referen@; |PINDA #0#Referen@;
                |PUSHV 0501 2380;
                |HAZ RelacionadoCRM;
                |POPV;
                |POPV;
                ||CONSULTA_CLAVE #1#Referen@;
                |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
                |ACABA;
             |SINO;
                aAlfa5 = "    No encuentro el def a cargar. [" + aAlfa5 + "," + FSalida + "]";
                |MENAV aAlfa5;
             |FINSI;
          |FINSI;
     |FINSI;

     aAlfa5 = "|K000";
     aClaves = #Fichero@#aAlfa5#;
     aTCompo = aClaves % 103;
     nTCompo = aTCompo;
     Iclave = clave1<-;
     |PARA nCampo = 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
          clave = 0;
          Iclave = Iclave + 1;
     |SIGUE;

     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nPosi = (nCompo * 300) + 103;
          aAlfa1 = aClaves % nPosi;
          clave = aAlfa1;
          Iclave = Iclave + 1;
     |SIGUE;

     aClave = "";
     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nNumCam = clave;
          Iclave = Iclave + 1;
          aAlfa2 = #Fichero@#nNumCam#;

          aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "TIPO";
          aAlfa      = #Fichero@#aQueQuiero#;
          |SI aAlfa = "N";
              aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "LONGITUD";
              aAlfa      = #Fichero@#aQueQuiero#;
              nLong      = aAlfa;
              nPos       = -(100 + nLong);
              aAlfa2     = (("0" * aAlfa) + aAlfa2) % nPos;
          |FINSI;

          aClave = aClave + aAlfa2;
     |SIGUE;

     ||aMensaje = "0000Clave: " + aClave;

     aAlfa = (aClave + "                                                                                                    ") % 199;
     aClave = aAlfa;
     aAlfa = (aClave + "                                                                                                    ") % 10001;
     aClave = aClave + aAlfa;

     ||Tengo que a¤adir antes .. el nombre de la aplicacion y numero de empresa
     |NOMAP aAplica;
     |QBF aAplica

     aAplica = (aAplica + "        ") % 108;

     ||nEmpresa = #48#0;
     ||Esto en la integral PETA.
     nEmpresa = 0;
     aEmpresa = ("00000" + nEmpresa) % -105;

     aParametro = aAplica + aEmpresa + aNomDef + aClave + aPathDef + "@" + aPathFic;
     aAlfa      = ":dserp/dserpm12;" + aParametro;
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO RelacionadoCRM;
     aAlfa5 = "|K000";
     aClaves = #Referen@#aAlfa5#;
     aTCompo = aClaves % 103;
     nTCompo = aTCompo;
     Iclave = clave1<-;
     |PARA nCampo = 1;  |SI nCampo [ 16;  |HACIENDO nCampo = nCampo + 1;
          clave = 0;
          Iclave = Iclave + 1;
     |SIGUE;

     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nPosi = (nCompo * 300) + 103;
          aAlfa1 = aClaves % nPosi;
          clave = aAlfa1;
          Iclave = Iclave + 1;
     |SIGUE;

     aClave = "";
     Iclave = clave1<-;
     |PARA nCompo = 1;  |SI nCompo [ nTCompo;  |HACIENDO nCompo = nCompo + 1;
          nNumCam = clave;
          Iclave = Iclave + 1;
          aAlfa2 = #Referen@#nNumCam#;

          aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "TIPO";
          aAlfa      = #Referen@#aQueQuiero#;
          |SI aAlfa = "N";
              aQueQuiero = "|C" + (("000" + nNumCam) % -103) + "LONGITUD";
              aAlfa      = #Referen@#aQueQuiero#;
              nLong      = aAlfa;
              nPos       = -(100 + nLong);
              aAlfa2     = (("0" * aAlfa) + aAlfa2) % nPos;
          |FINSI;

          aClave = aClave + aAlfa2;
     |SIGUE;

     ||aMensaje = "0000Clave: " + aClave;

     aAlfa = (aClave + "                                                                                                    ") % 199;
     aClave = aAlfa;
     aAlfa = (aClave + "                                                                                                    ") % 10001;
     aClave = aClave + aAlfa;

     ||Tengo que a¤adir antes .. el nombre de la aplicacion y numero de empresa
     |NOMAP aAplica;
     |QBF aAplica
     aAplica = (aAplica + "        ") % 108;

     ||nEmpresa = #48#0;
     ||Esto en la integral PETA.
     nEmpresa = 0;
     aEmpresa = ("00000" + nEmpresa) % -105;

     aParametro = aAplica + aEmpresa + aFichRel + aClave + aPathDef + "@" + aPathFic;
     aAlfa      = ":dserp/dserpm12;" + aParametro;
     |SUB_EJECUTA aAlfa;
|FPRC;
