|FICHEROS;
     dsam0000;
     :integral/dsaw0015;
     :basica/agicen14;
     :basica/agicen17;

     :modelos/dsmom033;
|FIN;

|VARIABLES;
     aAlfa      = "";
     aAlfa1     = "";
     aAlfa2     = "";
     aAlfa3     = "";
     nNume      = 0;

     &eOpSub        = 0;
     &enConcepto    = 0;
     &eaCodSubdep   = "";
     &eswLect       = 0;
     &eaNomSubdep   = "";
     &enTipoTribut  = 0;
     &enCultivo     = 0;
     &eaTipoCultivo = "";
|FIN;

|PROCESO Mes; |TIPO 0;
     |SI #dsaw0015#2 = 1;
         #dsaw0015#3 = 12;
     |SINO;
         #dsaw0015#3 = #dsaw0015#2 - 1;
     |FINSI;
     |PINTA #dsaw0015#3;
|FPRC;

|PROCESO Nivel;  |TIPO 7;
     |C_M #dsaw0015#5,  1, "S";
     |C_M #dsaw0015#6,  1, "S";
     |C_M #dsaw0015#7,  1, "S";
     |C_M #dsaw0015#8,  1, "S";
     |C_M #dsaw0015#9,  1, "S";
     |C_M #dsaw0015#10, 1, "S";

     |SI #dsaw0015#4 < 6;
         |C_M #dsaw0015#10, 1, "N";  #dsaw0015#10 = 0;
         |SI #dsaw0015#4 < 5;
             |C_M #dsaw0015#9, 1, "N";  #dsaw0015#9 = 0;
             |SI #dsaw0015#4 < 4;
                 |C_M #dsaw0015#8, 1, "N";  #dsaw0015#8 = 0;
                 |SI #dsaw0015#4 < 3;
                     |C_M #dsaw0015#7, 1, "N";  #dsaw0015#7 = 0;
                     |SI #dsaw0015#4 < 2;
                         |C_M #dsaw0015#6, 1, "N";  #dsaw0015#6 = 0;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO NivelRep;  |TIPO 0;
  |SI Campo = 6;  |Y #dsaw0015#6 = 0; |Y #dsaw0015#4 ] 2;
      |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI Campo = 7;  |Y #dsaw0015#7 = 0; |Y #dsaw0015#4 ] 3;
      |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI Campo = 8;  |Y #dsaw0015#8 = 0; |Y #dsaw0015#4 ] 4;
      |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI Campo = 9;  |Y #dsaw0015#9 = 0; |Y #dsaw0015#4 ] 5;
      |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI Campo = 10;  |Y #dsaw0015#10 = 0; |Y #dsaw0015#4 ] 6;
      |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
      |ERROR;
      |ACABA;
  |FINSI;

  |SI Campo = 6; |Y #dsaw0015#6 ! 0;    || Si hay dos niveles iguales o menor error
      |SI #dsaw0015#6 [ #dsaw0015#5;
          |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;

  |SI Campo = 7; |Y #dsaw0015#7 ! 0; || Si hay dos niveles iguales o menor error
      |SI #dsaw0015#7 [ #dsaw0015#5; |O #dsaw0015#7 [ #dsaw0015#6;
          |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;

  |SI Campo = 17; |Y #dsaw0015#8 ! 0; || Si hay dos niveles iguales o menor error
      |SI #dsaw0015#8 [ #dsaw0015#5; |O #dsaw0015#8 [ #dsaw0015#6; |O #dsaw0015#8 [ #dsaw0015#7;
         |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
         |ERROR;
         |ACABA;
      |FINSI;
  |FINSI;

  |SI Campo = 18; |Y #dsaw0015#9 ! 0; || Si hay dos niveles iguales o menor error
      |SI #dsaw0015#9 [ #dsaw0015#5; |O #dsaw0015#9 [ #dsaw0015#6; |O #dsaw0015#9 [ #dsaw0015#7; |O #dsaw0015#9 [ #dsaw0015#8;
          |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;

  |SI Campo = 19; |Y #dsaw0015#10 ! 0;    || Si hay dos niveles iguales o menor error
      |SI #dsaw0015#10 [ #dsaw0015#5; |O #dsaw0015#10 [ #dsaw0015#6; |O #dsaw0015#10 [ #dsaw0015#7; |O #dsaw0015#10 [ #dsaw0015#8; |O #dsaw0015#10 [ #dsaw0015#9;
          |MENAV  "0000Nivel repetido o valor mas bajo que los anteriores";
          |ERROR;
          |ACABA;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO Titulo;  |TIPO 0;
     |ABRE #agicen14;
     #agicen14#0 = #dsam0000#0;
     #agicen14#1 = 1;
     |LEE 040#agicen14.];
     |SI FSalida ! 0;  |O #agicen14#0 ! #dsam0000#0;
         |DDEFECTO #agicen14;
     |FINSI;
     |CIERRA #agicen14;

     aAlfa = #dsaw0015#16;  |QBF aAlfa;
     |SI aAlfa = "";
         |SI #dsaw0015#1 ] 80;
             nNume = 1900 + #dsaw0015#1;
         |SINO;
             nNume = 2000 + #dsaw0015#1;
         |FINSI;
         aAlfa1 = #dsam0000#1;     |QBF aAlfa1;
         aAlfa2 = #agicen14#8;   |QBF aAlfa2;
         aAlfa3 = #agicen14#10;  |QBF aAlfa3;
         aAlfa =  "[" + (("00000" + #dsam0000#0) % -105) + "/" + nNume + "] " + aAlfa1 + " " + aAlfa2 + " " + aAlfa3;
         #dsaw0015#16 = aAlfa;
         |PINTA #dsaw0015#16;
     |FINSI;
|FPRC;

|| ***********************************************************************
|| ..... Datos de Defecto Departamento y subdepartamento

|CALCULO defAct; |TIPO 0;
 aAlfa1 = #dsaw0015#13; |C_M #dsaw0015#18,1,aAlfa1;
|FCAL;

|RUTINA inferior2;
   #agicen14#0 = #dsam0000#0;
   #agicen14#1 = 01;
|FRUT;

|RUTINA superior2;
   #agicen14#0 = #dsam0000#0;
   #agicen14#1 = 99;
|FRUT;

|CALCULO MiraActiv; |TIPO 0;
   |C_M #dsaw0015#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |SI FSalida = 10;
       |ABRE #agicen14;
       #agicen14#1 = #dsaw0015#18;
       |CONSULTA_F_CLAVE #1#agicen14,inferior2,superior2;
       #dsaw0015#18 = #agicen14#1;
       |CIERRA #agicen14;
   |FINSI;

   |ABRE #agicen14;
   |DDEFECTO #agicen14;
   #agicen14#0 = #dsam0000#0;
   #agicen14#1 = #dsaw0015#18;
   |LEE 001#agicen14.=;
   |SI FSalida ! 0;
       |CONFI "    NError.! No Existe Actividad / Departamento. Continuar S/N ?";
       |SI FSalida ! 0;
           |ERROR;
       |FINSI;
       #dsaw0015#20 = "";
   |SINO;
       enTipoTribut = #agicen14#9;
       aAlfa1 = #agicen14#1;
       aAlfa1 = ("00" + aAlfa1) % A02;
       #dsaw0015#18 = aAlfa1; |PINTA #dsaw0015#18;
       #dsaw0015#20 = #agicen14#4;
   |FINSI;
   |CIERRA #agicen14;
|FCAL;

|CALCULO defSuba; |TIPO 0;
 aAlfa1 = "S";
 |SI #dsaw0015#14 = "N"; aAlfa1 = "N"; |FINSI;

 |C_M #dsaw0015#19,1,aAlfa1;
|FCAL;

|CALCULO TrasSub; |TIPO 0;
   |SI #dsaw0015#14 = "N"; |ACABA; |FINSI;

   eOpSub = 0; || 1 = Consulta pantalla
   |SI FSalida = 10; eOpSub = 1;  |FINSI;
   enConcepto  = 1;
   eaCodSubdep = #dsaw0015#19;
   |HAZ SubActividad;
   |SI eswLect = 1;
       |CONFI "    NError.! No Existe SubDepartamento. Continuar S/N ?";
       |SI FSalida ! 0;
           |ERROR;
       |FINSI;
       #dsaw0015#21 = "";
   |SINO;
       #dsaw0015#19 = eaCodSubdep; |PINTA #dsaw0015#19;
       #dsaw0015#21 = eaNomSubdep;
   |FINSI;
|FCAL;

|RUTINA inferior1;
   #agicen17#0 = #dsam0000#0;
   #agicen17#1 = #dsaw0015#18;
   #agicen17#2 = 001;
|FRUT;

|RUTINA superior1;
   #agicen17#0 = #dsam0000#0;
   #agicen17#1 = #dsaw0015#18;
   #agicen17#2 = 999;
|FRUT;


|PROCESO SubActividad;

   eswLect = 0;
   eaNomSubdep = "";
   |SI #dsaw0015#14 = "O"; |ACABA; |FINSI;

   |SI enTipoTribut = 6;  |O enTipoTribut = 7;
    |O enTipoTribut = 11; |O enTipoTribut = 12;
    |O enTipoTribut = 16; |O enTipoTribut = 17;
       enCultivo     = eaCodSubdep;
       eaTipoCultivo = "A";
       |SI eOpSub = 1;
           |SUB_EJECUTA_NP ":modelos/dsmom033";
       |FINSI;

       |ABRE #dsmom033;
       #dsmom033#0 = enCultivo;
       |LEE 001#dsmom033.=;
       |SI FSalida ! 0;
           eswLect = 1;
       |FINSI;
       |CIERRA #dsmom033;
       eaCodSubdep = ("000" + enCultivo) % -103;
       eaNomSubdep = #dsmom033#1 % 140;
   |SINO;

       |ABRE #agicen17;
       |SI eOpSub = 1;
           |CONSULTA_F_CLAVE #1#agicen17,inferior1,superior1;
           eaCodSubdep = #agicen17#2; |QBF eaCodSubdep;
           eaCodSubdep = ("000" + eaCodSubdep) % -103;
       |FINSI;

 |ET LaLectura;
       #agicen17#0 = #dsam0000#0;
       #agicen17#1 = #dsaw0015#18;
       #agicen17#2 = eaCodSubdep;
       |LEE 040#agicen17.=;
       |SI FSalida ! 0; |Y eaCodSubdep ! "   ";
           eswLect = 1;
       |FINSI;
       eaNomSubdep = #agicen17#3;
       eaCodSubdep = #agicen17#2; |QBF eaCodSubdep;
       eaCodSubdep = ("000" + eaCodSubdep) % -103;
       |CIERRA #agicen17;
   |FINSI;
|FPRC;
