|FICHEROS;
     dsay0003 #0;
     dsam0013 #13;
     dsam0053 #53;
     dsaw0020 #99;
|FIN;

|VARIABLES;
     nFecha   = 0;
     nSwGraba = 0;
     nFechaDesde = 0;
     nFechaHasta = 0;
     nDias       = 0;

     aFichero = "";
     aQueDia  = "";
     aAlfa    = "";

     fFecha   = @;
     fFechaD  = @;

     &vacio37 = "                                                  ";
|FIN;

|PROCESO SumaDias;
     nDias = #0#0;
     nDias = nDias + 7;
     #0#1  = nDias;     |PINTA #0#1;
|FPRC;


|PROCESO GrabaTempo;
                             || -T- Todos los Dias

     |SI #53#6 < fFecha;  |ACABA;  |FINSI;

     fFechaD = #0#0 % 1;
     aQueDia = fFechaD % 11;  |QBT aQueDia;  aQueDia = aQueDia > aQueDia;

     |SI #53#18 = "0";         || Solo el Dia del Aviso
         |SI #53#6 ! fFecha;  |ACABA;  |FINSI;
     |FINSI;

     |SI #53#18 = "2";
         nFecha  = #53#6 - fFecha;
         |SI nFecha > 14;  |ACABA;  |FINSI;
         |SI nFecha < 0;   |ACABA;  |FINSI;
     |FINSI;

     |SI #53#18 = "1";
         nFecha  = #53#6 - fFecha;
         |SI nFecha > 7;   |ACABA;  |FINSI;
         |SI nFecha < 0;   |ACABA;  |FINSI;
     |FINSI;

     |SI #53#18 = "L";  aAlfa = "LUNES";      |FINSI;
     |SI #53#18 = "M";  aAlfa = "MARTES";     |FINSI;
     |SI #53#18 = "X";  aAlfa = "MIERCOLES";  |FINSI;
     |SI #53#18 = "J";  aAlfa = "JUEVES";     |FINSI;
     |SI #53#18 = "V";  aAlfa = "VIERNES";    |FINSI;
     |SI #53#18 = "S";  aAlfa = "SABADO";     |FINSI;
     |SI #53#18 = "D";  aAlfa = "DOMINGO";    |FINSI;

     |SI #53#18 ! "0";  |Y #53#18 ! "T"; |Y #53#18 ! "1"; |Y #53#18 ! "2";
         |SI aQueDia ! aAlfa;  |ACABA;  |FINSI;
     |FINSI;

     nSwGraba = 1;

     #99#0  = fFecha;
     #99#1  = #53#6;
     #99#2  = #53#7;
     #99#3  = #53#8;
     #99#4  = #53#18;
     #99#5  = #53#1;
     #99#6  = #53#2;
     #99#7  = #53#3;
     #99#8  = #53#4;
     #99#9  = #53#0;
     #99#10 = #53#11;
     #99#11 = #53#12;
     #99#12 = #53#13;
     #99#13 = #53#14;
     #99#14 = #53#15;
     #99#15 = #53#16;
     #99#16 = #53#19;
     #99#17 = #53#20;

     |DDEFECTO #13;
     #13#0 = #99#17;
     |LEE 001#13=;
     #99#18 = #13#1;

     |GRABA 020#99n;
|FPRC;

|PROCESO MiraTempo;
     nFechaDesde = #0#0;
     nFechaHasta = #0#1;
     |PARA nDias = nFechaDesde;  |SI nDias [ nFechaHasta;  |HACIENDO nDias = nDias + 1;
           fFecha = nDias;
           |HAZ GrabaTempo;
     |SIGUE;
|FPRC;

|DEFBUCLE dsam0053;
     #53#3;
     20;
     #0#2, " ", #0#4;
     #0#2, "z", #0#5;
     ;
     NULL, MiraTempo;
|FIN;

|PROCESO ImprimeAviso;
     |PRINT;
|FPRC;

|DEFBUCLE dsaw0020I;
     #99#1;
     ;
     #0#0, "00.00.0000", 00, 00, 00000, "00.00.0000", 00, 00, 00;
     #0#1, "31.12.9999", 99, 99, 99999, "31.12.2999", 99, 99, 99;
     ;
     NULL, ImprimeAviso;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFichero = (Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #99 aFichero;
     |ABRE #99;  |CIERRA #99;  |DELINDEX #99;

     nSwGraba = 0;
     |ABRE #13;
     |ABRE #99;
     |BUCLE dsam0053;
     |CIERRA #99;
     |CIERRA #13;

     |SI nSwGraba = 0;
         |FINIMP;
         |MENAV "       Seleccion Vacia.";
         |ACABA;
     |FINSI;

     |INFOR "dsay0003";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |BUCLE dsaw0020I;

     |PIEINF;
     |FININF;
     |FINIMP;

     |DELINDEX #99;
|FPRC;
