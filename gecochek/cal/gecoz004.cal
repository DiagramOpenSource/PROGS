|FICHEROS;
     gecoz004 #0;
     gecom010 #10;
     gecom017 #17;
     gecow001 #901;

     :/dslpd/def/dslpm000 #200;
|FIN;

|VARIABLES;
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";
     aDir        = "";
     aDocu1      = "";
     aDocu2      = "";
     aDocu3      = "";
     aCampoA     = "";
     aCampoB     = "";
     aCampoC     = "";
     aCampoD     = "";
     aCampoE     = "";
     aCampoF     = "";
     aCampoG     = "";
     aCampoH     = "";
     aCampoI     = "";
     aCampoJ     = "";
     aCampoK     = "";
     aCampoL     = "";
     aCampoM     = "";
     aCampoN     = "";
     aCampoO     = "";
     aCampoP     = "";
     aCampoQ     = "";
     aEsc1       = "";
     aEsc2       = "";
     aRetu       = "";
     aTecla      = "";
     aDirec      = "";
     aHoja1      = "";
     aHoja2      = "";
     aHoja3      = "";
     aLong       = "";
     aCaracter   = "";
     aBaseDslpd  = "";
     aSG         = "";

     nHandleDslpd = 0;
     nSwHay      = 0;
     nVersion    = 0;
     nCampo      = 0;
     nBoton1     = 0;
     nBoton2     = 0;
     nPanta      = 0;
     nLong       = 0;
     nPos        = 0;

     &enImportados = 0;
|FIN;

|PROCESO CargaDatos;
     #10#0  = aCampoA;
     |LEE 101#10=;
     |SI FSalida ! 0;
         |DDEFECTO #10;
         #10#0  = aCampoA;
         |GRABA 020#10b;
     |FINSI;

     #10#1  = aCampoB;
     #10#2  = aCampoC;
     #10#3  = aCampoD;
     #10#4  = aCampoE;
     #10#5  = aCampoF;
     #10#6  = aCampoG;
     #10#7  = aCampoH;
     #10#8  = aCampoI;
     #10#9  = aCampoJ;
     #10#10 = aCampoK;
     #10#11 = aCampoL;
     #10#12 = aCampoM;
     #10#13 = aCampoN;
     #10#14 = aCampoO;
     #10#15 = aCampoP;
     #10#16 = aCampoQ;

     |GRABA 020#10a;
     |LIBERA #10;

     #901#0 = aCampoA;
     #901#1 = aCampoB;

     |PINTA #901#0;
     |PINTA #901#1;
     |PULSATECLA;

     |SI enImportados = 0;
         |DBASS aBaseDslpd;  |QBF aBaseDslpd;
         aBaseDslpd = aBaseDslpd + "dslpd/def/dslpm520.mas";
         |XABRE "E", aBaseDslpd, nHandleDslpd;
         |SI FSalida ] 0;
             |ABRE #200;
             |LEE 101#200p;
             |SI FSalida ! 0;
                 |DDEFECTO #200;
                 |GRABA 020#200b;
             |FINSI;
             #200#17 = 1;
             |GRABA 020#200a;
             |LIBERA #200;
             |CIERRA #200;
         |FINSI;

         enImportados = 1;
     |FINSI;
|FPRC;

|PROCESO LeeHojaExcel1;
     aLong  = aDir % 0;
     nLong  = aLong;
     aHoja1 = "";
     |PARA nCampo = 1;  |SI nCampo [ nLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aDir % nPos;
           |SI aCaracter = "/";  aCaracter = "\";  |FINSI;

           aHoja1 = aHoja1 + aCaracter;
     |SIGUE;

     aHoja2 = (aHoja1 - aDocu1) + aDocu2;
     aHoja3 = (aHoja1 - aDocu1) + aDocu3;

     |ALFACALLDLL "agixl97.dll", "carga_book", aHoja1;
     |SI FSalida < 0;
         |MENAV "0000 Puede haber otro usuario con el Libro ya abierto.";
         |ACABA;
     |FINSI;

     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";

     nCampo = 1;
     |PARA; |SI; |HACIENDO;
           aCampoA = "A" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoA;  |QBF aCampoA;
           |SI aCampoA = "";    |SAL;  |FINSI;
           |SI aCampoA = "A1";  |SAL;  |FINSI;
           aCampoA = ("00000" + aCampoA) % -105;

           aCampoB = "B" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoB;

           aCampoC = "C" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoC;

           aCampoD = "D" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoD;

           aCampoE = "E" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoE;

           aCampoF = "F" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoF;

           aCampoG = "G" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoG;

           aCampoH = "H" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoH;

           aCampoI = "I" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoI;

           aCampoJ = "J" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoJ;

           aCampoK = "K" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoK;

           aCampoL = "L" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoL;

           aCampoM = "M" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoM;

           aCampoN = "N" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoN;

           aCampoO = "O" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoO;

           aCampoP = "P" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoP;

           aCampoQ = "Q" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoQ;

           |HAZ CargaDatos;

           nCampo = nCampo + 1;
     |SIGUE;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";

     #0#1   = aAlfa3;          |PINTA #0#1;
     #0#2   = aAlfa1 % 902;    |PINTA #0#2;
     #0#3   = aAlfa1 % 1102;   |PINTA #0#3;
|FPRC;

|PROCESO CargaDatos2;
     aAlfa = aCampoD % 301;
     aSG   = "";
     |SI aAlfa = " ";  |O aAlfa = "/";
         aSG = aCampoD % 102;
         aCampoD = aCampoD % 440;
     |FINSI;

     #17#0  = aCampoN;
     #17#1  = aCampoB;
     #17#2  = aCampoA;
     |LEE 101#17=;
     |SI FSalida ! 0;
         |DDEFECTO #17;
         #17#0  = aCampoN;
         #17#1  = aCampoB;
         #17#2  = aCampoA;
         |GRABA 020#17b;
     |FINSI;

     aAlfa = (aCampoM % 104) > "";
     |SI aAlfa = "ESPA";
         aCampoM = "ESPAÑA";
     |FINSI;

     #17#3  = aCampoC;
     #17#4  = aSG;
     #17#5  = aCampoD;
     #17#6  = aCampoE;
     #17#8  = aCampoF;
     #17#10 = aCampoG;
     #17#11 = aCampoH;
     #17#12 = aCampoJ;
     #17#13 = aCampoI;
     #17#15 = aCampoK;
     #17#16 = aCampoL;
     #17#18 = aCampoM;

     |GRABA 020#17a;
     |LIBERA #17;

     #901#0 = aCampoN;
     #901#1 = aCampoC;

     |PINTA #901#0;
     |PINTA #901#1;

     |PULSATECLA;
|FPRC;

|PROCESO LeeHojaExcel2;
     |ALFACALLDLL "agixl97.dll", "carga_book", aHoja2;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";

     nCampo = 1;
     |PARA; |SI; |HACIENDO;
           aCampoA = "A" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoA;  |QBF aCampoA;
           |SI aCampoA = "";    |SAL;  |FINSI;
           |SI aCampoA = "A1";  |SAL;  |FINSI;

           aCampoB = "B" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoB;

           aCampoC = "C" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoC;

           aCampoD = "D" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoD;

           aCampoE = "E" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoE;

           aCampoF = "F" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoF;

           aCampoG = "G" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoG;

           aCampoH = "H" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoH;

           aCampoI = "I" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoI;

           aCampoJ = "J" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoJ;

           aCampoK = "K" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoK;

           aCampoL = "L" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoL;

           aCampoM = "M" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoM;

           aCampoN = "N" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoN;

           |HAZ CargaDatos2;

           nCampo = nCampo + 1;
     |SIGUE;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
|FPRC;

|PROCESO LeeHojaExcel3;
     |ALFACALLDLL "agixl97.dll", "carga_book", aHoja3;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";

     nCampo = 1;
     |PARA; |SI; |HACIENDO;
           aCampoA = "A" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoA;  |QBF aCampoA;
           |SI aCampoA = "";    |SAL;  |FINSI;
           |SI aCampoA = "A1";  |SAL;  |FINSI;

           aCampoB = "B" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoB;

           aCampoC = "C" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoC;

           aCampoD = "D" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoD;

           aCampoE = "E" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoE;

           aCampoF = "F" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoF;

           aCampoG = "G" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoG;

           aCampoH = "H" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoH;

           aCampoI = "I" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoI;

           aCampoJ = "J" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoJ;

           aCampoK = "K" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoK;

           aCampoL = "L" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoL;

           aCampoM = "M" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoM;

           aCampoN = "N" + nCampo;
           |ALFACALLDLL "agixl97.dll", "peek_dato", aCampoN;

           |HAZ CargaDatos2;

           nCampo = nCampo + 1;
     |SIGUE;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
|FPRC;

|PROCESO TrataDocumento;
     aAlfa = (aDocu1 % 103) < "";
     |SI aAlfa ! "xls";  |ACABA;  |FINSI;

     aAlfa1 = aDocu1 % 412;
     aAlfa2 = (#0#1 % -104) + (#0#1 % 402) + (#0#1 % 102) + #0#2 + #0#3;
     aAlfa3 = (aAlfa1 % 702) + "." + (aAlfa1 % 502) + "." + (aAlfa1 % 104);

     |SI aAlfa1 [ aAlfa2;
         |RFBORRA aDir;

         aAlfa = (aDir - aDocu1) + aDocu2;   |RFBORRA aAlfa;
         aAlfa = (aDir - aDocu1) + aDocu3;   |RFBORRA aAlfa;

         nVersion = 1;
         |ACABA;
     |FINSI;

     nSwHay   = 1;
     nVersion = 0;

     |BORRA_HIJOS_PAN #0#0;
     |SUB_PINPA #0#901, nPanta;

     |ABRE #10;
     |ABRE #17;

     |ATRI S;  |PINTA 1617, "Clientes General      ";  |ATRI s;  |HAZ LeeHojaExcel1;
     |ATRI S;  |PINTA 1617, "Clientes y Proveedores";  |ATRI s;  |HAZ LeeHojaExcel2;
     |ATRI S;  |PINTA 1617, "Trabajadores          ";  |ATRI s;  |HAZ LeeHojaExcel3;

     |CIERRA #10;
     |CIERRA #17;

     |BORRA_HIJOS_PAN #0#0;
|FPRC;

|PROCESO Ejecuta;
     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";

     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
         |MENAV "0000No se puede usar agixl97.dll";
         |ACABA;
     |FINSI;

     aDir   = aDirec + "/xls*.xls"
     nSwHay = 0;
     |R_PDIR aDir;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          aDocu1 = aDir % -119;
          aDocu2 = (aDocu1 % 102) + "c" + (aDocu1 % 419);
          aDocu3 = (aDocu1 % 102) + "t" + (aDocu1 % 419);

          |HAZ TrataDocumento;
          |R_SDIR aDir;
     |SIGUE;

     |DESCARGADLL "agixl97.dll";

     |SI nSwHay = 0;
         |SI nVersion = 1;
             |MENAV "0000 Hay una Importacion con Fecha de Actualizacion Igual o Superior. Proceso Cancelado.";
         |SINO;
             |MENAV "0000 No hay nada a Importar";
         |FINSI;
     |FINSI;

     |PTEC 802;
|FPRC;

|PROCESO MiraSiHay;
     nSwHay = 0;
     aDir   = aDirec + "/xls*.xls"
     |R_PDIR aDir;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          aDocu1 = aDir % -119;
          aAlfa  = (aDocu1 % 103) < "";
          |SI aAlfa = "xls";  nSwHay = 1;  |SAL;   |FINSI;
          |R_SDIR aDir;
     |SIGUE;
|FPRC;

|PROCESO Ubicacion;
     aDirec = "D";
     |BROWSE aDirec;
     aDirec = aDirec % 290;  |QBF aDirec;

     |HAZ MiraSiHay;
     |SI nSwHay = 0;
         |MENAV "0000 No existe Documentos en la Ubicacion seleccionada.";

         |ESTADO_CONTROL nBoton1, "ENABLE";
         |ESTADO_CONTROL nBoton2, "DISABLE";
     |SINO;
         |ESTADO_CONTROL nBoton1, "DISABLE";
         |ESTADO_CONTROL nBoton2, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     FSalida = 2899;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         |GRABA 020#0b;
     |FINSI;

     |PINPA #0#0;
     nPanta = FSalida;

     |PINDA #0#0;

     |CONTROL_SIMPLE nPanta, "BOTON,{{218}} Buscar Ubicacion ", 2758, 2777, Ubicacion;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{217}} Importar ", 2783, 2797, Ejecuta;
     nBoton2 = FSalida;

     aAlfa = "C:/DOCUMENTOS";                     |RMKDIR aAlfa;
     aAlfa = "C:/DOCUMENTOS/ADMONNET";            |RMKDIR aAlfa;

     aDirec = "C:/DOCUMENTOS/ADMONNET";
     |HAZ MiraSiHay;

     |SI nSwHay = 0;
         |ESTADO_CONTROL nBoton1, "ENABLE";
         |ESTADO_CONTROL nBoton2, "DISABLE";
     |SINO;
         |ESTADO_CONTROL nBoton1, "DISABLE";
         |ESTADO_CONTROL nBoton2, "ENABLE";
     |FINSI;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::Salir";
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;

     |GRABA 020#0a;
     |LIBERA #0;
     |CIERRA #0;

     |PULSATECLA;
|FPRO;
