|FICHEROS;
     gecow010 #910;

     gecom011 #11;
     gecom019 #19;

/*
     gecom014 #14;


     :/dsoporte/def/dsprem99 #99;
     :/dsoporte/def/dsprem01 #101;
     :/dsoporte/def/dsprem02 #102;
     :/dsoporte/def/dsprem03 #103;
     :/dsoporte/def/dsprem04 #104;
     :/dsoporte/def/dsprem05 #105;
     :/dsoporte/def/dsprem06 #106;
     :/dsoporte/def/dsprem07 #107;
     :/dsoporte/def/dsprem08 #108;
     :/dsoporte/def/dsorm001 #201;
*/
     referen1@ #900;
|FIN;

|VARIABLES;
     nRango        = 0;
     nPos1         = 0;
     nPos2         = 0;
     nGrid1        = 0;
     nGrid2        = 0;
     nPanta0       = 0;
     nPanta1       = 0;
     nCampo        = 0;
     nVentana      = 0;
     nGrupo        = 0;
     nReg          = 0;
     nBoton1_1     = 0;
     nBoton1_2     = 0;
     nBoton1_3     = 0;
     nBoton1_4     = 0;

     aEsc1         = "";
     aEsc2         = "";
     aRetu         = "";
     aTecla        = "";
     aBase         = "";
     aMas          = "";
     aFichero      = "";
     aAlfa         = "";
     aGrupo        = "";
     aPathDSoporte = "";
     aHora         = "";
     aOperacion    = "";
     aDOperacion   = "";
     aDateUsuario  = "";
     aDateSistema  = "";
     aEjercicio    = "";
     aFic          = "";
     aDirec        = "";

     fFecha        = @;

     &enCliente    = 0;
     ||&enDelega     = 0;
     &eaUsuario    = "";
     &enModo       = 0;
     &enInstalar   = 0;
     &enError      = 0;
     &eaApli       = "";
     &eaEmpPat     = "";
     &eaEmpDes     = "";
     &enHay        = 0;
     &enEmpresa    = 0;
|FIN;

|PROCESO BajaPanta1_1;
     #19#0 = #11#0;
     #19#1 = 000001;
|FPRC;

|PROCESO AltaPanta1_1;
     #19#0 = #11#0;
     #19#1 = 99999;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     |ABRET #19;

     FSalida = 2799;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #19;
|FPRC;

|PROCESO EventoPanta1_1;
     |SI FSalida = 1;
         |ESTADO_CONTROL nBoton1_1, "ENABLE";
         |ESTADO_CONTROL nBoton1_3, "ENABLE";

         |LEE 000#19=;
         |SI FSalida = 0;  |Y  #19#0 = #910#0;
         /*
             |SI #19#1 = 1;
                 ||ESTADO_CONTROL nBoton1_2, "ENABLE";
                 |ESTADO_CONTROL nBoton1_3, "DISABLE";
                 ||ESTADO_CONTROL nBoton1_4, "ENABLE";
             |SINO;
                 ||ESTADO_CONTROL nBoton1_2, "ENABLE";
                 |ESTADO_CONTROL nBoton1_3, "ENABLE";
                 ||ESTADO_CONTROL nBoton1_4, "ENABLE";
             |FINSI;
         */
         |SINO;
             ||ESTADO_CONTROL nBoton1_2, "DISABLE";
             |ESTADO_CONTROL nBoton1_3, "DISABLE";
             ||ESTADO_CONTROL nBoton1_4, "DISABLE";
         |FINSI;
     |FINSI;
|FPRC;

/*
|PROCESO dsprem07;
     #103#0 = #102#0;
     #103#1 = #102#1;
     #103#2 = #102#2;
     #103#3 = #107#0;
     #103#4 = #107#1;
     |LEE 101#103=;
     |SI FSalida ! 0;
         |DDEFECTO #103;
         #103#0 = #102#0;
         #103#1 = #102#1;
         #103#2 = #102#2;
         #103#3 = #107#0;
         #103#4 = #107#1;
         |GRABA 020#103b;
     |FINSI;

     |SI #103#11 = 0;
         |DBASS aBase;  |QBF aBase;
         aMas = aBase + "dsoporte/def/dsprem03.mas";
         |CARGA_DEF aMas, referen1@;
         |SI FSalida = 0;
             |PATH_DAT #900 aPathDSoporte;
             |ABRE #900;
             |SELECT #2#900;
             |LEE 040#900u;
             |SI FSalida ! 0;  |DDEFECTO #900;  |FINSI;
             |CIERRA #900;

             #103#11 = #900#11 + 1;
             |SI #103#11 = 8888;  #103#11 = #103#11 + 1;  |FINSI;

             |DESCARGA_DEF #referen1@;
         |FINSI;
     |FINSI;

     #103#5  = #101#1;
     #103#6  = #108#2;
     #103#7  = #102#3;
     #103#8  = #107#2;
     #103#9  = #107#3;
     aAlfa   = #103#8; |QBF aAlfa;
     aAlfa   = aAlfa + "-" + #103#9;
     #103#10 = #102#0 + (("00" + #102#1) % -102) + (("000" + #102#2) % -102) + " " + aAlfa;
     |GRABA 020#103a;
     |LIBERA #103;

     #201#0 = #103#11;
     |LEE 101#201=;
     |SI FSalida ! 0;
         |DDEFECTO #201;
         #201#0 = #103#11;
         |GRABA 020#201b;
     |FINSI;
     #201#1 = #103#10;
     |GRABA 020#201a;
     |LIBERA #201;
|FPRC;

|DEFBUCLE dsprem07;
     #107#1;
     ;
     00, 00;
     99, 99;
     ;
     NULL, dsprem07;
|FIN;

|PROCESO AltaTesoreria;
     fFecha     = ~;
     aEjercicio = fFecha % -101;

     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "dstesor/def/dstem000.mas";
     aFic = aBase + "dstesor/fich/";

     |CARGA_DEF aMas, referen1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PATH_DAT #900 aFic;

     |ABRE #900;
     |DDEFECTO #900;
     #900#0  = #102#17;
     #900#1  = #18#2;
     #900#2  = #102#12;
     #900#3  = aEjercicio;
     #900#4  = #102#16;
     #900#5  = "S";
     #900#6  = "~~~~~~~~~~";

     |GRABA 020#900n;
     |LIBERA #900;
     |CIERRA #900;

     aAlfa = aBase + "dstesor/fich/" + (("00000" + #900#0) % -105);
     |MKDIR aAlfa;

     eaApli   = "dstesor";
     eaEmpPat = "99999";
     eaEmpDes = (("00000" + #900#0) % -105);
     enHay    = 0;
     |SUB_EJECUTA ":dsoporte/dsorz013";

     |SI enHay = 0;
          |MENAV "0000 La empresa [99999-Patrones de la Gestion de Tesoreria] inaccesible.";
     |FINSI;

     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO ModiTesoreria;
     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "dstesor/def/dstem000.mas";
     aFic = aBase + "dstesor/fich/";

     |CARGA_DEF aMas, referen1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PATH_DAT #900 aFic;

     |ABRE #900;
     |DDEFECTO #900;
     #900#0  = #102#17;
     |LEE 101#900=;
     |SI FSalida = 0;
         #900#1  = #18#2;
         |GRABA 020#900a;
         |LIBERA #900;
     |FINSI;
     |CIERRA #900;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO BorraTesoreria;
     |DBASS aBase;  |QBF aBase;
     aMas = aBase + "dstesor/def/dstem000.mas";
     aFic = aBase + "dstesor/fich/";
     |CARGA_DEF aMas, referen1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PATH_DAT #900 aFic;

     |ABRE #900;
     aAlfa  = nGrupo + (("00"  + #11#1) % -102) + (("00" + #18#1) % -102);
     #900#0 = aAlfa;
     |LEE 000#900=;
     |SI FSalida = 0;
         aAlfa  = aFic + (("00000" + #900#0) % -105);
         aDirec = "";
         |DIRECTORIO aDirec; |QBF aDirec;
         aAlfa = aDirec + "bin/agirm -r " + aAlfa;
         |SYSTEM aAlfa;

         |BORRA 020#900a;
         |LIBERA #900;
     |FINSI;
     |CIERRA #900;

     |DESCARGA_DEF #referen1@;
|FPRC;
*/

|PROCESO Boton1_1;
     |VENTANA 0501, 2799, -1, -1, "";
     nVentana = FSalida;

     enCliente = #910#0;
     enEmpresa = #19#1;
     enModo    = 1;
     |SUB_EJECUTA_NP "gecow011";

     |FINVENTANA nVentana;

/*
     |SI enError = 0;
         #19#0 = enCliente;
         #19#1 = enEmpresa;
         |LEE 000#19=;
         |SI FSalida = 0;
             |ABRE #101;
             #101#0 = nGrupo;
             |LEE 101#101=;
             |SI FSalida ! 0;  |DDEFECTO #101;  |FINSI;
             |CIERRA #101;

             |ABRE #108;
             #108#0 = nGrupo;
             #108#1 = #11#1;
             |LEE 101#108=;
             |SI FSalida ! 0;  |DDEFECTO #108;  |FINSI;
             |CIERRA #108;

             |ABRE #102;
             #102#0 = nGrupo;
             #102#1 = #11#1;
             #102#2 = 1;
             |LEE 000#102=;
             |SI FSalida ! 0;  |DDEFECTO #102;  |FINSI;
             aAlfa = #102#3;

             #102#0 = nGrupo;
             #102#1 = #11#1;
             #102#2 = #18#1;
             |LEE 101#102=;
             |SI FSalida ! 0;
                 |DDEFECTO #102;
                 #102#0  = nGrupo;
                 #102#1  = #11#1;
                 #102#2  = #18#1;
                 #102#3  = #18#2;
                 #102#5  = "N";
                 #102#6  = nGrupo;
                 #102#7  = #11#1;
                 #102#8  = 1;
                 #102#9  = #101#1;
                 #102#10 = #108#2;
                 #102#11 = aAlfa;

                 aAlfa   = #102#0 + (("00"  + #102#1) % -102) + "01";
                 #102#12 = aAlfa;
                 #102#13  = ("00"  + #102#1) % -102;
                 #102#14  = "001";
                 #102#15 = aAlfa;
                 #102#16 = aAlfa;
                 aAlfa   = #102#0 + (("00"  + #102#1) % -102) + (("00"  + #102#2) % -102);
                 #102#17 = aAlfa;
                 #102#18 = aAlfa;
                 #102#19 = aAlfa;
                 |GRABA 020#102n;
                 |LIBERA #102;

                 |ABRE #103;
                 |ABRE #201;
                 |BUCLE dsprem07;
                 |CIERRA #103;
                 |CIERRA #201;

                 |HAZ AltaTesoreria;
             |FINSI;
             |CIERRA #102;
         |FINSI;
     |FINSI;

*/
     |REFRESCACONTROL nGrid1;
|FPRC;

/*
|PROCESO Boton1_2;
     |VENTANA 0501, 2799, -1, -1, "";
     nVentana = FSalida;

     |LEE 000#18=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     enCliente = #908#0;
     enDelega  = #18#1;
     enModo    = 2;
     |SUB_EJECUTA_NP "gecow009";

     |FINVENTANA nVentana;

     |SI enError = 0;
         #18#0 = enCliente;
         #18#1 = enDelega;
         |LEE 000#18=;
         |SI FSalida = 0;
             |ABRE #102;
             #102#0 = nGrupo;
             #102#1 = #11#1;
             #102#2 = #18#1;
             |LEE 101#102=;
             |SI FSalida = 0;
                 #102#3  = #18#2;
                 |GRABA 020#102a;
                 |LIBERA #102;
             |FINSI;
             |CIERRA #102;

             |HAZ ModiTesoreria;
         |FINSI;
     |FINSI;

     |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO dsprem04B;
     |BORRA 020#104a;
     |LIBERA #104;

     #105#0 = 1;
     |LEE 000#105=;
     |SI FSalida ! 0;  |DDEFECTO #105;  |FINSI;

     #106#0 = 1;
     |LEE 000#106=;
     |SI FSalida ! 0;  |DDEFECTO #106;  |FINSI;

     aOperacion  = "B";
     aDOperacion = "BAJA DEL USUARIO";
     |HORA aHora;

     nReg = 1;
     |LEE 000#99u;
     |SI FSalida = 0;
         nReg = #99#0 + 1;
     |FINSI;

     #99#0  = nReg;
     |GRABA 020#99b;

     #99#1  = #104#5;
     #99#2  = ~;
     #99#3  = aHora;
     #99#4  = aOperacion;
     #99#5  = aDOperacion;
     #99#6  = nGrupo + (("00" + #102#1) % -102) + (("00" + #102#2) % -102);
     #99#7  = #104#3;
     #99#8  = #104#4;
     #99#9  = aGrupo;
     #99#10 = #11#2;
     #99#11 = #103#7;
     #99#12 = #105#1;
     #99#13 = #106#1;
     aAlfa  = #105#1; |QBF aAlfa;
     aAlfa  = aAlfa + "-" + #106#1;
     #99#14 = nGrupo + (("00" + #103#1) % -102) + (("00" + #103#2) % -102) + " " + aAlfa;
     #99#15 = "N";
     #99#16 = "N";
     #99#17 = #104#11;
     #99#18 = #103#11;
     #99#19 = #104#8;
     #99#20 = Usuario % 810;
     |GRABA 020#99a;
     |LIBERA #99;
|FPRC;

|DEFBUCLE dsprem04B;
     #104#1;
     ;
     #103#0, #103#1, #103#2, #103#3, #103#4, "          ";
     #103#0, #103#1, #103#2, #103#3, #103#4, "zzzzzzzzzz";
     be;
     NULL, dsprem04B;
|FIN;

|PROCESO dsprem03B;
     |ABRE #105;
     |ABRE #106;
     |ABRE #99;
     |BUCLE dsprem04B;
     |CIERRA #105;
     |CIERRA #106;
     |CIERRA #99;

     |BORRA 020#103a;
     |LIBERA #103;
|FPRC;

|DEFBUCLE dsprem03B;
     #103#1;
     ;
     #102#0, #102#1, #102#2, 01, 01;
     #102#0, #102#1, #102#2, 99, 99;
     be;
     NULL, dsprem03B;
|FIN;
*/
|PROCESO Boton1_3;
     |LEE 000#19=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
/*
     aAlfa = "0000NSeguro de dar de baja la Delegacion " + #18#2;  |QBF aAlfa;
     aAlfa = aAlfa + " y todos sus Usuarios ";
     |CONFI aAlfa;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
*/
     |BORRA 020#19a;
     |LIBERA #19;
/*
     |ABRE #102;
     #102#0 = nGrupo;
     #102#1 = #11#1;
     #102#2 = #18#1;
     |LEE 101#102=;
     |SI FSalida = 0;
         |BUCLE dsprem03B;

         |BORRA 020#102a;
         |LIBERA #102;

         |HAZ BorraTesoreria;
     |FINSI;
     |CIERRA #102;
*/
     |REFRESCACONTROL nGrid1;
|FPRC;

/*
|PROCESO dsprem04A;
     |BORRA 020#104a;
|FPRC;

|DEFBUCLE dsprem04A;
     #104#1;
     ;
     nGrupo, #11#1, #18#1, 00, 00, "          ";
     nGrupo, #11#1, #18#1, 99, 99, "zzzzzzzzzz";
     be;
     NULL, dsprem04A;
|FIN;

|PROCESO gecom014;
     aDateUsuario = (#14#7  % -104) + (#14#7  % 402) + (#14#7  % 102) + (("00" + #14#8) % -102) + (("00" + #14#9) % -102);

     |SI aDateSistema > aDateUsuario;  |ACABA;  |FINSI;

     #104#0 = nGrupo;
     #104#1 = #11#1;
     #104#2 = #18#1;
     #104#3 = #14#10;
     #104#4 = #14#11;
     #104#5 = #14#1;
     |LEE 101#104=;
     |SI FSalida ! 0;
         |DDEFECTO #104;
         #104#0  = nGrupo;
         #104#1  = #11#1;
         #104#2  = #18#1;
         #104#3  = #14#10;
         #104#4  = #14#11;
         #104#5  = #14#1;
         #104#9  = "N";
         #104#10 = "N";
         |GRABA 020#104b;
     |FINSI;
     #104#6  = #14#2;
     #104#7  = #14#3;
     #104#11 = #14#4;
     #104#12 = #14#5;
     #104#15 = #14#6;
     |GRABA 020#104a;
     |LIBERA #104;
|FPRC;

|DEFBUCLE gecom014;
     #14#1;
     ;
     #18#0, #18#1, "          ";
     #18#0, #18#1, "zzzzzzzzzz";
     ;
     NULL, gecom014;
|FIN;

|PROCESO CargaUsuarios;
     |BUCLE dsprem04A;

     fFecha = ~;
     |HORA aHora;

     aDateSistema = (fFecha % -104) + (fFecha % 402) + (fFecha % 102) + (aHora % 102) + (aHora % 402);

     |ABRE #104;
     |BUCLE gecom014;
     |CIERRA #104;
|FPRC;

|PROCESO Boton1_4;
     |VENTANA 0501, 2799, -1, -1, "";
     nVentana = FSalida;

     enCliente = #18#0;
     enDelega  = #18#1;
     |SUB_EJECUTA "gecow005";

     |FINVENTANA nVentana;

     |HAZ CargaUsuarios;

     enInstalar = 1;
|FPRC;
*/
|PROCESO BotonesPanta1;
     |CONTROL_SIMPLE nPanta1, "BOTON,{{193}} Nuevo", 0777, 0898, Boton1_1;
     nBoton1_1 = FSalida;

     || CONTROL_SIMPLE nPanta1, "BOTON,{{197}} Modificar", 1077, 1198, Boton1_2;
     || nBoton1_2 = FSalida;

     |CONTROL_SIMPLE nPanta1, "BOTON,{{199}} Baja ", 1377, 1498, Boton1_3;
     nBoton1_3 = FSalida;

     || CONTROL_SIMPLE nPanta1, "BOTON,{{199}} Usuarios ", 1677, 1798, Boton1_4;
     || nBoton1_4 = FSalida;

     |ESTADO_CONTROL nBoton1_1, "ENABLE";
     ||ESTADO_CONTROL nBoton1_2, "DISABLE";
     |ESTADO_CONTROL nBoton1_3, "DISABLE";
     ||ESTADO_CONTROL nBoton1_4, "DISABLE";
|FPRC;

|PROGRAMA;
     |DBASS aBase;  |QBF aBase;
/*
     aGrupo  = aBase % -201;
     nGrupo  = aGrupo;
     |SI nGrupo = 0;
         nGrupo = 1;
     |FINSI;

     aGrupo  = aBase % -205;
*/
     || aPathDSoporte = aBase + "dsoporte/fich/";

     ||aPathDLaboral = aBase + "laboral/fich/";

     ||PATH_DAT #99  aPathDLaboral;
/*
     |PATH_DAT #99  aPathDSoporte;
     |PATH_DAT #101 aPathDSoporte;
     |PATH_DAT #102 aPathDSoporte;
     |PATH_DAT #103 aPathDSoporte;
     |PATH_DAT #104 aPathDSoporte;
     |PATH_DAT #105 aPathDSoporte;
     |PATH_DAT #106 aPathDSoporte;
     |PATH_DAT #107 aPathDSoporte;
     |PATH_DAT #108 aPathDSoporte;
     |PATH_DAT #201 aPathDSoporte;
*/

     |ABRE #11;
     #11#0 = enCliente;
     |LEE 000#11=;
     |SI FSalida ! 0;  |CIERRA #11;  |ACABA;  |FINSI;
     |CIERRA #11;
     |CABEZA "Empresas Laboral";

     |PULSATECLA;

     |PINPA #0#910;  nPanta0 = FSalida;
     |PINPA #1#910;  nPanta1 = FSalida;

     #910#0 = #11#0;   |PINTA #910#0;
     #910#1 = #11#2;   |PINTA #910#1;

     nRango = 4 + 8 + 16 + 32 + 128;
     nPos1  = 0601;
     nPos2  = 2058;

     |LINEAL_SIMPLE #1#19, nRango, nPos1, nPos2, BajaPanta1_1, AltaPanta1_1, EventoPanta1_1;
     nGrid1 = FSalida;

     |FOCOTECLADO nGrid1;

     |HAZ BotonesPanta1;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::Salir," + nGrid1;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1_1;
     |FIN_CONTROL_WINDOWS nBoton1_2;
     |FIN_CONTROL_WINDOWS nBoton1_3;
     |FIN_CONTROL_WINDOWS nBoton1_4;

     |DESTRUYECONTROL nGrid1;

     |PULSATECLA;
|FPRO;
