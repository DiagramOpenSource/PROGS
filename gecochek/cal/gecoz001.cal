|FICHEROS;
     gecoz001 #0;
     empresa@ #1;
     fichero@ #2;
     gecom005 #5;
|FIN;

|VARIABLES;
     aParam = "";
     aFic = "";
     nMaxCampo = 0;
     aDat = "";
     aBase = "";
     aEmp = "";
     aDef = "";
     nConta = 0;
     aAlfa = "";
     nConta010 = 0;
     nConta134 = 0;
     nConta077 = 0;
     nConta079 = 0;
|FIN;

|PROCESO CuentaCon;
     nConta = nConta + 1;
     |SI #0#0 = 2;
          |DDEFECTO #5;
          #5#0 = aEmp; ||Fecha
          #5#1 = #2#1; ||Empresa;
          |LEE 101#5=;
          |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
          #5#20 = #5#20 + 1;
          |GRABA 020#5a;
          |LIBERA #5;
     |FINSI;
|FPRC;

|DEFBUCLE CuentaCon;
     #2#1003;
     ;
     01, "01.01.0000", 000001;
     99, "31.12.9999", 999999;
     ;
     NULL, CuentaCon;
|FIN;

|PROCESO canempre;
     aEmp = (("00000" + #1#2) % -105) + #1#3;
     aDat = aBase + "contagen/fich/" + aEmp + "/";

     aDef = aBase + "contagen/def/camaasic";

     nConta = 0;
     |CARGA_DEF aDef, fichero@;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar " + aDef;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          |PATH_DAT #2 aDat;
          |BUCLE CuentaCon;
          |DESCARGA_DEF #fichero@;
     |FINSI;

     |SI #0#0 = 1;
          |DDEFECTO #5;
          #5#0 = aEmp;
          #5#1 = ~;
          |LEE 101#5=;
          |SI FSalida = 0;
               |PDEFECTO #5, 7, nMaxCampo;
          |SINO;
               |GRABA 020#5b;
          |FINSI;
          #5#2 = nConta;
          |GRABA 020#5a;
          |LIBERA #5;
     |FINSI;
|FPRC;

|DEFBUCLE canempre;
     #1#1002;
     ;
     00001, 0;
     99999, 9;
     ;
     NULL, canempre;
|FIN;

|PROCESO CuentaGes;
     nConta = nConta + 1;
     |SI #0#0 = 2;
          |DDEFECTO #5;
          #5#0 = aEmp; ||Fecha
          #5#1 = #2#1; ||Empresa;
          |LEE 101#5=;
          |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
          |SI aFic = "010"; #5#21 = #5#21 + 1; |FINSI;
          |SI aFic = "134"; #5#22 = #5#22 + 1; |FINSI;
          |SI aFic = "077"; #5#23 = #5#23 + 1; |FINSI;
          |SI aFic = "079"; #5#24 = #5#24 + 1; |FINSI;
          |GRABA 020#5a;
          |LIBERA #5;
     |FINSI;
|FPRC;

|DEFBUCLE CuentaGes;
     #2#1002;
     ;
     "     ", 000001;
     "zzzzz", 999999;
     ;
     NULL, CuentaGes;
|FIN;

|PROCESO CuentaGes0;
     nConta = 0;
     |CARGA_DEF aDef, fichero@;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar " + aDef;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          |PATH_DAT #2 aDat;
          |BUCLE CuentaGes;
          |DESCARGA_DEF #fichero@;
     |FINSI;
|FPRC;

|PROCESO agifa041;
     aEmp = ("00000" + #1#0) % -105;
     aDat = aBase + "dscomer9/fich/" + aEmp + "/";

     aDef = aBase + "dscomer9/def/agifa010"; ||Alb Vta
     aFic = "010";
     |HAZ CuentaGes0;
     nConta010 = nConta;

     aDef = aBase + "dscomer9/def/agifa134"; ||Fac Vta
     aFic = "134";
     |HAZ CuentaGes0;
     nConta134 = nConta;

     aDef = aBase + "dscomer9/def/agifa077"; ||Alb Com
     aFic = "077";
     |HAZ CuentaGes0;
     nConta077 = nConta;

     aDef = aBase + "dscomer9/def/agifa079"; ||Fac Com
     aFic = "079";
     |HAZ CuentaGes0;
     nConta079 = nConta;

     |SI #0#0 = 1;
          |DDEFECTO #5;
          #5#0 = aEmp;
          #5#1 = ~;
          |LEE 101#5=;
          |SI FSalida = 0;
               |PDEFECTO #5, 7, nMaxCampo;
          |SINO;
               |GRABA 020#5b;
          |FINSI;
          #5#3 = nConta010;
          #5#4 = nConta134;
          #5#5 = nConta077;
          #5#6 = nConta079;
          |GRABA 020#5a;
          |LIBERA #5;
     |FINSI;
|FPRC;

|DEFBUCLE agifa041;
     #1#1001;
     ;
     00001;
     99999;
     ;
     NULL, agifa041;
|FIN;

|PROCESO Ponceros;
     |PDEFECTO #5, 7, nMaxCampo;
     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|DEFBUCLE Ponceros;
     #5#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, Ponceros;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#1 ! "SI"; |ACABA; |FINSI;

     aAlfa = "|NC";
     aAlfa = #5#aAlfa#;
     nMaxCampo = aAlfa;

     |SI #0#0 = 2;
          |BUCLE Ponceros;
     |FINSI;

     |ABRE #5;
     |DBASS aBase;

     aDat = aBase + "dscomer9/fich/";
     aDef = aBase + "dscomer9/def/agifa041";
     |CARGA_DEF aDef, empresa@;
     |SI FSalida ! 0;
          |SI aParam = ""; |MENAV "0000Error al cargar 'agifa041'"; |FINSI;
     |SINO;
          |PATH_DAT #1 aDat;
          |BUCLE agifa041;
          |DESCARGA_DEF #empresa@;
     |FINSI;

     aDat = aBase + "contagen/fich/";
     aDef = aBase + "contagen/def/canempre";
     |CARGA_DEF aDef, empresa@;
     |SI FSalida ! 0;
          |SI aParam = ""; |MENAV "0000Error al cargar 'canempre'"; |FINSI;
     |SINO;
          |PATH_DAT #1 aDat;
          |BUCLE canempre;
          |DESCARGA_DEF #empresa@;
     |FINSI;
     |CIERRA #5;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |SI aParam = "";
          |MANTE #0;
     |SINO;
          #0#0 = aParam;
          #0#1 = "SI";
          |HAZ Tipo3;
     |FINSI;
|FPRO;
