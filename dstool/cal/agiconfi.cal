|FICHEROS;
    agiconfi #0;
    agicontm #1;    || tmp. para lineas no reconocidas
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;

    dbase = "";
    fabre = "";
    fcanl = "";
    field = "";
    sw_inicial = 0;
    sw_cargando = 0;
    c_field = "";
    v_field = "";
    x_field = "";
    n_field = 0;
    longi = 0;
    tabla_com = 0;
    tabla_100 = 0;
    sw_graba = 0;
    bufer = "";
    nro_reg = 0;
    mas = 0;
    sw_baja = 0;
|FIN;
____________________________________/
|PROCESO pulsaf5; |TIPO 0;
|SI FSalida = 13;

    |ATRI R;
    |MENSA "    Introduce el contenido del parametro 'RWIndexBuffers' ...";
    |ATRI 0;

    |DEL_BUF tabla_100, 104, v_field;
        bufer = v_field;

    |PINTA 1939, "Buffers (RWIndexBuffers) ..:    ";
        E_sup = 3;
        E_inf = "";
        bufer = 1968 ? 0;

        v_field = bufer;
    |AL_BUF tabla_100, 104, v_field;

    |PINTA 1939, "                                ";
    |ATRI R;
    |BLIN 4;
    |ATRI 0;
|FINSI;
|FPRC;

|PROCESO pulsaf6; |TIPO 0;
|SI FSalida = 14;

    |ATRI R;
    |MENSA "    Introduce el contenido del parametro 'RWFastOpen' ...";
    |ATRI 0;

    |DEL_BUF tabla_100, 105, v_field;
        bufer = v_field;

    |PINTA 1939, "Parametro (RWFastOpen) ....:    ";
        E_sup = 1;
        E_inf = "";
        bufer = 1968 ? 0;

        v_field = bufer;
    |AL_BUF tabla_100, 105, v_field;

    |PINTA 1939, "                                ";
    |ATRI R;
    |BLIN 4;
    |ATRI 0;
|FINSI;
|FPRC;

|PROCESO min;
    #1#0 = 1;
|FPRC;

|PROCESO max;
    #1#0 = 9999;
|FPRC;

|PROCESO pulsaf7; |TIPO 0;
|SI FSalida = 15;
    |PUSHV 0501 2380;
    |ENTLINEAL #1#1, 1, 3, 21, 1, min, max;
    |POPV;
|FINSI;
|FPRC;
____________________________________/
|PROGRAMA;
|CLS;
|CABEZA "Config. AGIsys";
|PINPA #0#0;
|DDEFECTO #0;
|ABRE #0;
|LEE 140#0=;                  || bloqueando, sin mensajes, sin espera
    FEstado = FSalida;
|SI FEstado = 111;
        #0#31 = Usuario;
    |GRABA 020#0b;            || bloqueando
|SINO;
    |SI FEstado = 0;
            alfa1 = #0#87;
        |DDEFECTO #0;
            #0#87 = alfa1;    || enviar instalacion
            #0#31 = Usuario;  || usuario
        |GRABA 020#0a;        || actualizando
    |FINSI;
|FINSI;

|SI FEstado = 107;
    |LEE 000#0=;              || solo lectura
        alfa1 = #0#31;   |QBF alfa1;
        alfa2 = "    Configuracion Bloqueada por " + alfa1 + " ...";
    |MENAV alfa2;
|SINO;
    |DIRECTORIO dbase;
    |DIMENSIONA 200, tabla_com, 0;
    |DIMENSIONA 200, tabla_100, 0;
        nume1 = tabla_com + tabla_100;
    |SI nume1 ] 0;
        |DELINDEX #1;
        |ABRE #1;
        |HAZ lee_agiini;
        |CIERRA #1;
        |PINDA #0#0;
        |ENDATOS #1#0;
        |SI FSalida = 0;
            |HAZ renumera_ins;     || renumera las posibles lineas insertadas
            |ABRE #1;
            |HAZ gra_agiini;
            |CIERRA #1;
        |FINSI;
        |FINDIM tabla_com;
        |FINDIM tabla_100;
        |DELINDEX #1;
    |SINO;
        |MENAV "    Error dimensionando tabla ...";
    |FINSI;
    ||BORRA 020#0a;
    |GRABA 020#0a;
|FINSI;

|LIBERA #0;
|CIERRA #0;
|FPRO;
____________________________________/ LECTURA DEL DS.INI
|PROCESO cargando3;
    alfa1 = c_field % 106;

|SI alfa1 = "InsPaq";
        #0#9 = #0#9 + 1;           || cuenta el nro. de modulos
        nume1 = #0#9 + 31;
        #0nume1 = v_field;         || guarda la clave de paquete

    |AL_BUF tabla_com, nume1, x_field;       || guarda comentario
|FINSI;

|SI alfa1 = "PFunci";
        #0#10 = #0#10 + 1;         || cuenta el nro. de funciones definidas
|FINSI;

|SI n_field = 0;|Y alfa1 ! "InsPaq";|Y alfa1 ! "PFunci";
    |HAZ graba_resto;
|FINSI;
|FPRC;

|PROCESO cargando2;
    n_field = 0;

|SI c_field = "Activacion";        n_field = 1;   sw_inicial = 1;  |FINSI;
|SI c_field = "A_Red";             n_field = 82;  |FINSI;
|SI c_field = "Sistema1";          n_field = 83;  |FINSI;
|SI c_field = "Sistema2";          n_field = 84;  |FINSI;
|SI c_field = "Sistema3";          n_field = 85;  |FINSI;
|SI c_field = "Sistema4";          n_field = 86;  |FINSI;
|SI c_field = "MenuAlfanumerico";  n_field = 2;   |FINSI;
|SI c_field = "AutoReturn";        n_field = 3;   |FINSI;
|SI c_field = "DesplegaMenus";     n_field = 4;   |FINSI;
|SI c_field = "DuplicarUsuario";   n_field = 5;   |FINSI;
|SI c_field = "TiempoUsuario";     n_field = 6;   |FINSI;
|SI c_field = "TiempoAplicacion";  n_field = 7;   |FINSI;
|SI c_field = "NombreDeListado";   n_field = 8;   |FINSI;
|SI c_field = "PFuncion01";        n_field = 11;  |FINSI;
|SI c_field = "PFuncion02";        n_field = 12;  |FINSI;
|SI c_field = "PFuncion03";        n_field = 13;  |FINSI;
|SI c_field = "PFuncion04";        n_field = 14;  |FINSI;
|SI c_field = "PFuncion05";        n_field = 15;  |FINSI;
|SI c_field = "PFuncion06";        n_field = 16;  |FINSI;
|SI c_field = "PFuncion07";        n_field = 17;  |FINSI;
|SI c_field = "PFuncion08";        n_field = 18;  |FINSI;
|SI c_field = "PFuncion09";        n_field = 19;  |FINSI;
|SI c_field = "PFuncion10";        n_field = 20;  |FINSI;
|SI c_field = "PFuncion11";        n_field = 21;  |FINSI;
|SI c_field = "PFuncion12";        n_field = 22;  |FINSI;
|SI c_field = "PFuncion13";        n_field = 23;  |FINSI;
|SI c_field = "PFuncion14";        n_field = 24;  |FINSI;
|SI c_field = "PFuncion15";        n_field = 25;  |FINSI;
|SI c_field = "PFuncion16";        n_field = 26;  |FINSI;
|SI c_field = "PFuncion17";        n_field = 27;  |FINSI;
|SI c_field = "PFuncion18";        n_field = 28;  |FINSI;
|SI c_field = "PFuncion19";        n_field = 29;  |FINSI;
|SI c_field = "PFuncion20";        n_field = 30;  |FINSI;
|SI c_field = "AnularColores";     n_field = 101; |FINSI;
|SI c_field = "PaqDesde";          n_field = 102; |FINSI;
|SI c_field = "PaqHasta";          n_field = 103; |FINSI;
|SI c_field = "RWIndexBuffers";    n_field = 104; |FINSI;
|SI c_field = "RWFastOpen";        n_field = 105; |FINSI;

|SI n_field ! 0;
    |SI n_field < 101;
            #0n_field = v_field;             || guarda contenido (def)
    |SINO;
        |AL_BUF tabla_100, n_field, v_field; || guarda contenido (tabla)
    |FINSI;
    |AL_BUF tabla_com, n_field, x_field;     || guarda comentario
|FINSI;
|FPRC;

|PROCESO cargando1;
    alfa1 = field % 101;
|SI alfa1 ! ";";|Y alfa1 ! "";
        alfa2 = field % 0;    longi = alfa2;
        c_field = "";
        v_field = "";
        x_field = "";
        sw_cargando = 0;
    |PARA para1 = 1; |SI para1 [ longi; |HACIENDO para1 = para1 + 1;
            nume1 = (para1 * 100) + 1;
            alfa1 = field % nume1;
        |SI alfa1 = "=";
                sw_cargando = 1;
        |SINO;
            |SI alfa1 = ";";
                |SI sw_cargando = 1;
                        sw_cargando = 2;
                |SINO;
                    |SAL;
                |FINSI;
            |SINO;
                |SI sw_cargando = 0;  c_field = c_field + alfa1;  |FINSI;
                |SI sw_cargando = 1;  v_field = v_field + alfa1;  |FINSI;
                |SI sw_cargando = 2;  x_field = x_field + alfa1;  |FINSI;
            |FINSI;
        |FINSI;
    |SIGUE;
    |QBT c_field;
    |HAZ cargando2;
    |HAZ cargando3;
|SINO;
    |HAZ graba_resto;
|FINSI;
|FPRC;

|PROCESO graba_resto;
|DDEFECTO #1;
    #1#0 = nro_reg;           || nro. registro
    #1#1 = field - &13;       || texto
    #1#2 = "N";               || insertada NO
|GRABA 020#1n;
|FPRC;

|PROCESO lee_agiini;
|ATRI P;   |MENSA "    Leyendo Configuracion Actual ...";   |ATRI 0;

    nro_reg = 0;
    sw_inicial = 0;
    fabre = "r   " + dbase + "ds.ini";
|FABRE fabre;
|SI FSalida ] 0;
        fcanl = FSalida;
    |PARA; |SI; |HACIENDO;
            field = fcanl + " 254";
        |FLEE field;
        |SI FSalida ] 0;
                nro_reg = nro_reg + 1;
            |HAZ cargando1;
        |SINO;
            |SAL;
        |FINSI;
    |SIGUE;
    |FCIERRA fcanl;
        Pos = -1;
|FINSI;
|SI sw_inicial = 0;
    |ATRI P;
    |MENSA "2400<INSTALACION INICIAL>";
    |ATRI 0;
    |CAMPO_MODIFICA #0#1, 1, "S";       || clave activacion AGIsys
    |CAMPO_MODIFICA #0#82, 1, "S";      || clave activacion red
    |CAMPO_MODIFICA #0#83, 1, "S";      || clave sistema 1
    |CAMPO_MODIFICA #0#84, 1, "S";      || clave sistema 2
    |CAMPO_MODIFICA #0#85, 1, "S";      || clave sistema 3
    |CAMPO_MODIFICA #0#86, 1, "S";      || clave sistema 4
|SINO;
    |SI #0#9 = 50;
        |ATRI P;
        |MENSA "2400<PENDIENTE DE DEPURAR MODULOS>";
        |ATRI 0;
    |FINSI;
|FINSI;

|ATRI R;   |BLIN 4;                                         |ATRI 0;
|FPRC;
____________________________________/ GRABACION DEL ds.INI
|PROCESO grabalo;
    nro_reg = nro_reg + 1;
    #1#0 = nro_reg;
|LEE 000#1=;
|PARA; |SI FSalida = 0; |HACIENDO;
        alfa1 = #1#1;    |QBF alfa1;
        field = fcanl + " " + alfa1;
    |FGRABA field;

        nro_reg = nro_reg + 1;
    |LEE 000#1s;
    |SI FSalida ! 0;|O #1#0 ! nro_reg;  |SAL;     |FINSI;
|SIGUE;

    field = fcanl + " " + c_field;
|FGRABA field;
|FPRC;

|PROCESO traduce;
    c_field = "-1";

|SI n_field = 1;    c_field = "Activacion";       |FINSI;
|SI n_field = 82;   c_field = "A_Red";            |FINSI;
|SI n_field = 83;   c_field = "Sistema1";         |FINSI;
|SI n_field = 84;   c_field = "Sistema2";         |FINSI;
|SI n_field = 85;   c_field = "Sistema3";         |FINSI;
|SI n_field = 86;   c_field = "Sistema4";         |FINSI;
|SI n_field = 2;    c_field = "MenuAlfanumerico"; |FINSI;
|SI n_field = 3;    c_field = "AutoReturn";       |FINSI;
|SI n_field = 4;    c_field = "DesplegaMenus";    |FINSI;
|SI n_field = 5;    c_field = "DuplicarUsuario";  |FINSI;
|SI n_field = 6;    c_field = "TiempoUsuario";    |FINSI;
|SI n_field = 7;    c_field = "TiempoAplicacion"; |FINSI;
|SI n_field = 8;    c_field = "NombreDeListado";  |FINSI;
|SI n_field = 11;   c_field = "PFuncion01";       |FINSI;
|SI n_field = 12;   c_field = "PFuncion02";       |FINSI;
|SI n_field = 13;   c_field = "PFuncion03";       |FINSI;
|SI n_field = 14;   c_field = "PFuncion04";       |FINSI;
|SI n_field = 15;   c_field = "PFuncion05";       |FINSI;
|SI n_field = 16;   c_field = "PFuncion06";       |FINSI;
|SI n_field = 17;   c_field = "PFuncion07";       |FINSI;
|SI n_field = 18;   c_field = "PFuncion08";       |FINSI;
|SI n_field = 19;   c_field = "PFuncion09";       |FINSI;
|SI n_field = 20;   c_field = "PFuncion10";       |FINSI;
|SI n_field = 21;   c_field = "PFuncion11";       |FINSI;
|SI n_field = 22;   c_field = "PFuncion12";       |FINSI;
|SI n_field = 23;   c_field = "PFuncion13";       |FINSI;
|SI n_field = 24;   c_field = "PFuncion14";       |FINSI;
|SI n_field = 25;   c_field = "PFuncion15";       |FINSI;
|SI n_field = 26;   c_field = "PFuncion16";       |FINSI;
|SI n_field = 27;   c_field = "PFuncion17";       |FINSI;
|SI n_field = 28;   c_field = "PFuncion18";       |FINSI;
|SI n_field = 29;   c_field = "PFuncion19";       |FINSI;
|SI n_field = 30;   c_field = "PFuncion20";       |FINSI;
|SI n_field = 32;   c_field = "InsPaq01";         |FINSI;
|SI n_field = 33;   c_field = "InsPaq02";         |FINSI;
|SI n_field = 34;   c_field = "InsPaq03";         |FINSI;
|SI n_field = 35;   c_field = "InsPaq04";         |FINSI;
|SI n_field = 36;   c_field = "InsPaq05";         |FINSI;
|SI n_field = 37;   c_field = "InsPaq06";         |FINSI;
|SI n_field = 38;   c_field = "InsPaq07";         |FINSI;
|SI n_field = 39;   c_field = "InsPaq08";         |FINSI;
|SI n_field = 40;   c_field = "InsPaq09";         |FINSI;
|SI n_field = 41;   c_field = "InsPaq10";         |FINSI;
|SI n_field = 42;   c_field = "InsPaq11";         |FINSI;
|SI n_field = 43;   c_field = "InsPaq12";         |FINSI;
|SI n_field = 44;   c_field = "InsPaq13";         |FINSI;
|SI n_field = 45;   c_field = "InsPaq14";         |FINSI;
|SI n_field = 46;   c_field = "InsPaq15";         |FINSI;
|SI n_field = 47;   c_field = "InsPaq16";         |FINSI;
|SI n_field = 48;   c_field = "InsPaq17";         |FINSI;
|SI n_field = 49;   c_field = "InsPaq18";         |FINSI;
|SI n_field = 50;   c_field = "InsPaq19";         |FINSI;
|SI n_field = 51;   c_field = "InsPaq20";         |FINSI;
|SI n_field = 52;   c_field = "InsPaq21";         |FINSI;
|SI n_field = 53;   c_field = "InsPaq22";         |FINSI;
|SI n_field = 54;   c_field = "InsPaq23";         |FINSI;
|SI n_field = 55;   c_field = "InsPaq24";         |FINSI;
|SI n_field = 56;   c_field = "InsPaq25";         |FINSI;
|SI n_field = 57;   c_field = "InsPaq26";         |FINSI;
|SI n_field = 58;   c_field = "InsPaq27";         |FINSI;
|SI n_field = 59;   c_field = "InsPaq28";         |FINSI;
|SI n_field = 60;   c_field = "InsPaq29";         |FINSI;
|SI n_field = 61;   c_field = "InsPaq30";         |FINSI;
|SI n_field = 62;   c_field = "InsPaq31";         |FINSI;
|SI n_field = 63;   c_field = "InsPaq32";         |FINSI;
|SI n_field = 64;   c_field = "InsPaq33";         |FINSI;
|SI n_field = 65;   c_field = "InsPaq34";         |FINSI;
|SI n_field = 66;   c_field = "InsPaq35";         |FINSI;
|SI n_field = 67;   c_field = "InsPaq36";         |FINSI;
|SI n_field = 68;   c_field = "InsPaq37";         |FINSI;
|SI n_field = 69;   c_field = "InsPaq38";         |FINSI;
|SI n_field = 70;   c_field = "InsPaq39";         |FINSI;
|SI n_field = 71;   c_field = "InsPaq40";         |FINSI;
|SI n_field = 72;   c_field = "InsPaq41";         |FINSI;
|SI n_field = 73;   c_field = "InsPaq42";         |FINSI;
|SI n_field = 74;   c_field = "InsPaq43";         |FINSI;
|SI n_field = 75;   c_field = "InsPaq44";         |FINSI;
|SI n_field = 76;   c_field = "InsPaq45";         |FINSI;
|SI n_field = 77;   c_field = "InsPaq46";         |FINSI;
|SI n_field = 78;   c_field = "InsPaq47";         |FINSI;
|SI n_field = 79;   c_field = "InsPaq48";         |FINSI;
|SI n_field = 80;   c_field = "InsPaq49";         |FINSI;
|SI n_field = 81;   c_field = "InsPaq50";         |FINSI;
|SI n_field = 101;  c_field = "AnularColores";    |FINSI;
|SI n_field = 102;  c_field = "PaqDesde";         |FINSI;
|SI n_field = 103;  c_field = "PaqHasta";         |FINSI;
|SI n_field = 104;  c_field = "RWIndexBuffers";   |FINSI;
|SI n_field = 105;  c_field = "RWFastOpen";       |FINSI;

|SI c_field ! "-1";
        sw_graba = 0;
        c_field = c_field + "=";                  || variable cargada
    |SI n_field < 101;
            alfa1 = #0n_field;    |QBT alfa1;
        |SI alfa1 ! "";
                alfa1 = #0n_field;    |QBF alfa1;
                c_field = c_field + alfa1;        || contenido def cargado
                sw_graba = 1;
        |FINSI;
    |SINO;
        |DEL_BUF tabla_100, n_field, alfa1;  |QBT alfa1;
        |SI alfa1 ! "";
            |DEL_BUF tabla_100, n_field, alfa1;
                c_field = c_field + alfa1;        || contenido tabla cargado
                sw_graba = 1;
        |FINSI;
    |FINSI;
    |SI sw_graba = 1;
        |DEL_BUF tabla_com, n_field, alfa1;  |QBT alfa1;
        |SI alfa1 ! "";
                c_field = c_field + &59 + alfa1;  || comentario cargado
        |FINSI;
        |HAZ grabalo;
    |FINSI;
|FINSI;
|FPRC;

|PROCESO gra_agiini;
|ATRI P;   |MENSA "    Grabando Configuracion Nueva ...";   |ATRI 0;

    nro_reg = 0;
    fabre = "w   " + dbase + "ds.ini";
|FABRE fabre;
|SI FSalida ] 0;
        fcanl = FSalida;

||        c_field = &59 + "Configuracion AGIsys - ds.ini";
||    |HAZ grabalo;
    |PARA para1 = 1; |SI para1 [ 81; |HACIENDO para1 = para1 + 1;
        |SI para1 ! 9;|Y para1 ! 10;|Y para1 ! 31;
||            |SI para1 = 1;    c_field = &59; |HAZ grabalo;  |FINSI;
||            |SI para1 = 2;    c_field = &59; |HAZ grabalo;  |FINSI;
||            |SI para1 = 11;   c_field = &59; |HAZ grabalo;  |FINSI;
||            |SI para1 = 32;   c_field = &59; |HAZ grabalo;  |FINSI;
            |SI para1 = 32;
                    n_field = 102; |HAZ traduce;       || PaqDesde
                    n_field = 103; |HAZ traduce;       || PaqHasta
||                    c_field = &59; |HAZ grabalo;
            |FINSI;
                n_field = para1;
            |HAZ traduce;
            |SI para1 = 1;
                    n_field = 82;  |HAZ traduce;
                    n_field = 83;  |HAZ traduce;
                    n_field = 84;  |HAZ traduce;
                    n_field = 85;  |HAZ traduce;
                    n_field = 86;  |HAZ traduce;
            |FINSI;
        |FINSI;
    |SIGUE;
||        c_field = &59;   |HAZ grabalo;
        n_field = 101;   |HAZ traduce;       || AnularColores
        n_field = 104;   |HAZ traduce;       || RWIndexBuffers
        n_field = 105;   |HAZ traduce;       || RWFastOpen

        #1#0 = nro_reg;
    |LEE 000#1];
    |PARA; |SI FSalida = 0; |HACIENDO;
            alfa1 = #1#1;    |QBF alfa1;
            field = fcanl + " " + alfa1;
        |FGRABA field;
        |LEE 000#1s;
    |SIGUE;

    |FCIERRA fcanl;
|SINO;
        alfa1 = "    Fichero [" + dbase + "ds.ini] NO ACCESIBLE ...";
    |MENAV alfa1;
|FINSI;
    Pos = -1;

|ATRI R;   |BLIN 4;                                         |ATRI 0;
|FPRC;
____________________________________/ RENUMERACION DE LAS LINEAS INSERTADAS
|PROCESO lee_tempo2_1;
|BORRA 020#1a;
|LIBERA #1;

    #1#0 = #1#0 - 10000;
|GRABA 020#1n;
|FPRC;

|DEFBUCLE lee_tempo2;
 #1#1;
 ;
 10001;
 99999;
 be;
 NULL, lee_tempo2_1;
|FIN;

|PROCESO lee_tempo1_1;
|BORRA 020#1a;
|LIBERA #1;

    #1#0 = #1#0 + 10000 + mas;
|SI #1#2 = "S";
        mas = mas + 1;
|FINSI;
|GRABA 020#1n;
|FPRC;

|DEFBUCLE lee_tempo1;
 #1#1;
 ;
    1;
 9999;
 be;
 NULL, lee_tempo1_1;
|FIN;

|PROCESO renumera_ins;
    mas = 0;
|BUCLE lee_tempo1;
|BUCLE lee_tempo2;
|FPRC;
________________________/ PROCESO EJECUTADO DESDE LA RELACION CON 'agicontm'
|PROCESO detec_baja; |TIPO 7;
    sw_baja = 1;
|FPRC;

|PROCESO no_baja; |TIPO 2;
|SI #1#2 = "S";     sw_baja = 1;   |FINSI;

|SI FEntrada = 303;|Y sw_baja = 0;
    |MENAV "    Para eliminar lineas use su editor favorito, por favor ...";
    |ERROR;
|FINSI;
    sw_baja = 0;
|FPRC;
