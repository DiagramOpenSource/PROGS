|FICHEROS;
     logger07  #0;  ||Acota
     logger03  #3;  ||Fichero de apoyo
     referen@;
|FIN;

|VARIABLES;
     nHay = 0;
     nSwConsulta = 0;
     aDef = "";
     aDes = "";
     aBase = "";
     aFic = "";
     nPrime = 0;
     aPath = "";
     aPathOrg = "";
     aOrg = "";
     aFecha = "";
     fFecha = @;
     aHora = "";
     nOk = 0;

     aDCampo = "";
     aHCampo = "";
     aDEmpresa = "";
     aHEmpresa = "";
     aDTipo = "";
     aHTipo = "";
     aDAccion = "";
     aHAccion = "";
     &PRMNT_eExtrae = "";
     &PRMNT_eVersio = 0;
     aRestauraIni = "";
     aDsini1 = "";
     aDsini2 = "";

     {-1}menu = "";
     menu1 = "1400";
     menu2 = "2";
     menu3 = "2";
     menu4 = "Conservar ultima extraccion";
     menu5 = "Nueva Extraccion";


     {-1}men2 = "";
     men21 = "1400";
     men22 = "1";   ||Opcion por defecto
     men23 = "4";   ||Numero de opciones
     men24 = "";
     men25 = "";
     men26 = "";
     men27 = "";
     men28 = "";
     men29 = "";
     men2A = "";
     men2B = "";
     opcdef = 0;
     nTmp = 0;

     fHoy = @;
     aHoy = "";
     aDia = "";
     nDia = 0;
     aMes = "";
     aAnyo = "";
     aNom = "";
     aAbre = "";
     nHandle = 0;

     nActi = 0;
     nPara1 = 0;
     nPosic = 0;
     aAscii = "";
     aLongi = "";
     nLongi = 0;
     aAlfa = "";
     aAlfa1 = "";
     aAlfa2 = "";
     nCodAsc = 0;
     aChar = "";

     &eaLogger = "";

     aUsrIni = "";
     aUsrFin = "";
     fFechaIni = @;
     fFechaFin = @;
     aHoraIni = "";
     aHoraFin = "";
     aTipo = "";
     nAcc = 0;
     aTabDefI = "";
     aTabDefF = "";
     nCmpoIni = 0;
     nCmpoFin = 0;
     aClauIni = "";
     aClauFin = "";
     nNuevaVer= 0;
     aDest    = "";
|FIN;

|PROCESO Tipo0; |TIPO 0;
|FPRC;


|PROCESO Tipo7; |TIPO 7;

     ||Es para poner dinamicamente un cmapo como no modificable

     |SI #0#6 = "*";
          |C_M #0#10, 1, "S";
          |C_M #0#11, 1, "S";
          |C_M #0#12, 1, "S";
          |C_M #0#13, 1, "S";
          |C_M #0#23, 1, "S";
          |C_M #0#24, 1, "S";
          |C_V #0#10, 1, "S";
          |C_V #0#11, 1, "S";
          |C_V #0#12, 1, "S";
          |C_V #0#13, 1, "S";
          |C_V #0#23, 1, "S";
          |C_V #0#24, 1, "S";

          men22 = 1;
          men23 = 1;
          men24 = "Todas las Acciones";
          |MENUG men2;
     |FINSI;
     |SI #0#6 = "T";
          #0#10 = 000;
          #0#11 = 999;
          #0#12 = "";
          #0#13 = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"
          |C_M #0#10, 1, "N";
          |C_M #0#11, 1, "N";
          |C_M #0#12, 1, "N";
          |C_M #0#13, 1, "N";
          |C_M #0#23, 1, "N";
          |C_M #0#24, 1, "N";
          |C_V #0#10, 1, "N";
          |C_V #0#11, 1, "N";
          |C_V #0#12, 1, "N";
          |C_V #0#13, 1, "N";
          |C_V #0#23, 1, "N";
          |C_V #0#24, 1, "N";

          |SI opcdef [ 2;
               men22 = opcdef;
          |SINO;
               opcdef = 1;
               men22 = opcdef;
          |FINSI;
          men23 = 2; ||Numero de opciones
          men24 = "Entrando en el TAB";
          men25 = "Saliendo del TAB";
          |MENUG men2;
          |SI FSalida = 1;
               #0#7 = 1;
          |FINSI;
          |SI FSalida = 2;
               #0#7 = 2;
          |FINSI;
     |FINSI;
     |SI #0#6 = "D";
          #0#10 = 000;
          #0#11 = 999;
          #0#12 = "";
          #0#13 = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"

          |C_M #0#10, 1, "N";
          |C_M #0#11, 1, "N";
          |C_M #0#12, 1, "N";
          |C_M #0#13, 1, "N";
          |C_M #0#23, 1, "N";
          |C_M #0#24, 1, "N";
          |C_V #0#10, 1, "N";
          |C_V #0#11, 1, "N";
          |C_V #0#12, 1, "N";
          |C_V #0#13, 1, "N";
          |C_V #0#23, 1, "N";
          |C_V #0#24, 1, "N";

          |SI opcdef ] 11;|Y opcdef [ 23;
               |SI opcdef [ 13;
                    nTmp = opcdef - 10;
                    men22 = nTmp;
               |FINSI;
               |SI opcdef ] 21;
                    nTmp = opcdef - 17;
                    men22 = nTmp;
               |FINSI;
          |SINO;
               opcdef = 1;
               men22 = opcdef;
          |FINSI;
          men23 = 8; ||Numero de opciones
          men24 = "Entrando en el DEF modo ALTA";
          men25 = "Entrando en el DEF modo BAJA";
          men26 = "Entrando en el DEF modo MODIF";
          men27 = "Entrando en el DEF modo IMPRIMIR";
          men28 = "Saliendo del DEF modo ALTA";
          men29 = "Saliendo del DEF modo BAJA";
          men2A = "Saliendo del DEF modo MODIF";
          men2B = "Saliendo del DEF modo IMPRIMIR";
          |MENUG men2;
          |SI FSalida = 1;
               #0#7 = 11;
          |FINSI;
          |SI FSalida = 2;
               #0#7 = 12;
          |FINSI;
          |SI FSalida = 3;
               #0#7 = 13;
          |FINSI;
          |SI FSalida = 4;
               #0#7 = 21;
          |FINSI;
          |SI FSalida = 5;
               #0#7 = 22;
          |FINSI;
          |SI FSalida = 6;
               #0#7 = 23;
          |FINSI;
     |FINSI;
     |SI #0#6 = "R";
          #0#10 = 000;
          #0#11 = 999;

          |C_M #0#10, 1, "N";
          |C_M #0#11, 1, "N";
          |C_M #0#12, 1, "S";
          |C_M #0#13, 1, "S";
          |C_M #0#23, 1, "S";
          |C_M #0#24, 1, "S";
          |C_V #0#10, 1, "N";
          |C_V #0#11, 1, "N";
          |C_V #0#12, 1, "S";
          |C_V #0#13, 1, "S";
          |C_V #0#23, 1, "S";
          |C_V #0#24, 1, "S";

          |SI opcdef [ 2;
               men22 = opcdef;
          |SINO;
               opcdef = 1;
               men22 = opcdef;
          |FINSI;
          men23 = 4; ||Numero de opciones
          men24 = "Nueva ficha";
          men25 = "Baja ficha";
          men26 = "Modificando registro";
          men27 = "Todas las acciones de registro";
          |MENUG men2;
          |SI FSalida = 1;
               #0#7 = 31;
          |FINSI;
          |SI FSalida = 2;
               #0#7 = 32;
          |FINSI;
          |SI FSalida = 3;
               #0#7 = 33;
          |FINSI;
          |SI FSalida = 4;
               #0#7 = 99;
          |FINSI;
     |FINSI;
     |SI #0#6 = "C";
          |C_M #0#10, 1, "S";
          |C_M #0#11, 1, "S";
          |C_M #0#12, 1, "S";
          |C_M #0#13, 1, "S";
          |C_M #0#23, 1, "S";
          |C_M #0#24, 1, "S";
          |C_V #0#10, 1, "S";
          |C_V #0#11, 1, "S";
          |C_V #0#12, 1, "S";
          |C_V #0#13, 1, "S";
          |C_V #0#23, 1, "S";
          |C_V #0#24, 1, "S";

          men22 = 1;
          men23 = 1; ||Numero de opciones
          men24 = "Actualizando Campo";
          |MENUG men2;
          |SI FSalida = 1;
               #0#7 = 34;
          |FINSI;
     |FINSI;
     opcdef = #0#7;      ||Guardamos en esta variable la opcion que se ha elegido
     |PINPA #0#0;
     |PINDA #0#0;
|FPRC;

|PROCESO logger03;
     |SI nSwConsulta = 0;
          |PRINT;
     |SINO;
          |SALVA_DATOS #3;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|PROCESO DesactivaLogger;
     aDsini1 = "LOGGER";
     |VALOR_INI aDsini1,aDsini2;
     aRestauraIni = aDsini2; |QBF aRestauraIni;
     |SI aRestauraIni ! "";
          aDsini2 = "";       || VACIO = DESACTIVADO
          aDsini1 = aDsini1 + "=" + aDsini2;
          |VALOR_INI aDsini1,aDsini2;
     |FINSI;
|FPRC;

|PROCESO ActivaLogger;
     |SI aRestauraIni ! "";
          aDsini2 = aRestauraIni;
          aDsini1 = "LOGGER="+ aDsini2;
          |VALOR_INI aDsini1,aDsini2;
     |FINSI;
|FPRC;

|DEFBUCLE logger03;
     #3#1;
     ;
     #0#0,#0#2,#0#4,aDTipo,aDAccion,#0#8,aDCampo,#0#12,#0#21,aDEmpresa;
     #0#1,#0#3,#0#5,aHTipo,aHAccion,#0#9,aHCampo,#0#13,#0#22,aHEmpresa;
     ;
     DesactivaLogger, logger03, NULL, NULL, ActivaLogger;
|FIN;

|PROCESO Imprime; |TIPO 3;
     |SI #0#6 = "*";
          aDTipo = ""
          aHTipo = "z";
          aDAccion = "00";
          aHAccion = "99";
     |SINO;
          aDTipo = #0#6;
          aHTipo = #0#6;
          aDAccion = #0#7;
          aHAccion = #0#7;
     |FINSI;
     |SI #0#7 = 99;
          aDAccion = "";
          aHAccion = "zz";
     |FINSI;
     aDCampo = ("000" + #0#10) % -103;
     aHCampo = ("000" + #0#11) % -103;
     aDEmpresa = #0#23;
     aHEmpresa = #0#24;

     |SI #0#19 = "I";
          Impresora = "Crystal Reports";
          |IMPRE 0;
          |SI FSalida = 0;
               |SI Impresora ! "CrystalReport";   ||Revisar este punto
                    |MENAV "0000Informe recomendado para impresora CrystalReports.";
                    |MENAV "0000Para ello debera instalar http://www.diagram.es/ geconet/DSCrystal_X.msi ";
               |FINSI;
               |INFOR "logger03";
               |SI FSalida = 0;
                    nSwConsulta = 0; |BUCLE logger03;
                    |PIEINF;
                    |FININF;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #0#19 = "G";
          |DDEF aDef;
          aDef = aDef + "logger03";
          |CARGA_DEF aDef, referen@;
          |SI FSalida = 0;
               aAlfa = "lg" + Usuario;
               |NOME_DAT #referen@#aAlfa#;
               |ABRE #referen@;
               nSwConsulta = 1; |BUCLE logger03;
               |LEE 000#referen@.p;
               |CONSULTA_CLAVE #1#referen@;
               |CIERRA #referen@;
               |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;
     |SI PARAMETRO = "total";
          |ABRE #3;
          |LEE 000#3p;
          |CONSULTA_CLAVE #1#3;
          |CIERRA #3;
     |SINO;
          |MANTE #0;
     |FINSI;
|FPRO;
