|FICHEROS;
    defmacrc #0;  || Cab. macros
    defmacrl #1;  || Fichero temporal de contadores
    macrotmp #2;  || Temporal
|FIN;

|VARIABLES;
  programa="";
  variable=0;
  varalfa="";
  &entradalineal=0;
  &controlc=0;
  como_salgo=0;
  mensaje="";
  ncontador=0;
  modo = 0;
  path="";
|FIN;

|| Mediante este proceso controlare en el programa agifa902 con que
|| tecla salgo de la entrada lineal. Debo controlar en principio solo
|| que no me salga con <CTRL>+<C>

|PROCESO tecla;|TIPO 11;
   |SI entradalineal = 1;
      |SI FSalida = 7;|O FSalida = 1;   || He salido con <CTRL>+<C> o <ESC>
          controlc=1;
      |FINSI;
       |SI FSalida = 9;   || He salido con <F1>
           |HAZ contadores;
           |ERROR;
       |FINSI;
   |FINSI;
|FPRC;


|| Cargo el usuario que ha creado la macro. Ya que despues en la seleccion
|| de macros el solo podra ver la suya.
|PROCESO usuario;
  |SI entradalineal=0;
     #0#2=Usuario;
     |PINTA #0#2;
  |FINSI;
|FPRC;

|| Monto un contador
|PROCESO contador;|TIPO 7;
 modo = (FEntrada / 100)!0;

   |SI modo=1;    || Solo si estoy en alta
     |LEE 001#0u;
     ncontador = #0#0;
     |DDEFECTO #0;
     #0#0=ncontador+1;
     |PINTA #0#0;
   |FINSI;
|FPRC;


|PROCESO contadores;
    |ABRE #macrotmp;
    #macrotmp#0 ="A";
    |LEE 101#macrotmp.=;
    || si no existe lo creo
    |SI FSalida ! 0;
        |GRABA 021#macrotmp.c;
    |FINSI;

    |PUSHV 0543 1279;
    |PINPA #0#macrotmp;
    |PINDA #0#macrotmp;

    |ENDATOS #2#macrotmp;
    |GRABA 021#macrotmp.a;
    |CIERRA #macrotmp;
    |POPV;
|FPRC;
