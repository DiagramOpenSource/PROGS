|FICHEROS;
     dssat001 #0;
|FIN;

|VARIABLES;
     aBat = "";
     nHandle = 0;

     aCadFin = "";
     nCampo = 0;
     aCampo = "";
     nNumSaca = 0;
     aLetra = "";

     aAlfa1 = "";
     aAlfa2 = "";
     nNume1 = 0;
     aUltimo = "";

     aPathBase = "";
     aMensaje = "";
     aUsuario = "";
     aBase = "";
     aIni = "";

     {-1}aSerie = "";
     nIni = 0;

     aEjecuta = "";

     {1}aContiene = "";
     {1}aLocal = "";
     aBaseLocal = "";
     aVersion1 = "";
     aVersion2 = "";
     aIPRemoto = "";
     aOrigen = "";
     aDestino = "";
|FIN;

|PROCESO DameNumIni;
     aSerie = "";
     |ESPECIFICA "SERIALIZACION", aSerie;
     aSerie = FSalida;
     nIni = aSerie;
     aIni = ("000000" + nIni) % -106;
|FPRC;

|PROGRAMA;
     aIni = "";
     |HAZ DameNumIni;

     |SI nIni = "";
          aMensaje = "0000Problemas para obtener el Numero de Licencia (NumIni)";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;
     aUsuario = Usuario % 810;

     |DBASS aPathBase;
     |QBF aPathBase;
     aAlfa2 = aPathBase % 0;
     nNume1 = aAlfa2;

     aUltimo = aPathBase % -101;
     |SI aUltimo = "/"; |O aUltimo = "\";
          nNume1 = 100 + (nNume1 - 1)
          aPathBase = aPathBase % nNume1;
     |FINSI;

     aCadFin = "";
     |PARA nCampo = 1; |SI nCampo [ nNume1; |HACIENDO nCampo = nCampo + 1;
          aCampo = nCampo + "01";
          nNumSaca = aCampo;
          aLetra = aPathBase % nNumSaca;
          |SI aLetra = "\";
               aLetra = "/";
          |FINSI;
          aCadFin = aCadFin + aLetra;
     |SIGUE;
     aPathBase = aCadFin;


     ||Utilizare .. dsabreweb.exe

     aDestino = "c:\documentos\";
     |RMKDIR aDestino;
     aDestino = "c:\documentos\agitool\";
     |RMKDIR aDestino;

     aDestino = aDestino + "dsabreweb.exe";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aVersion1 = FSalida;  |QBF aVersion1;

     |DBASE aBase;  |QBF aBase;
     aOrigen = aBase + "plugins/dsabreweb.exe";
     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aVersion2 = FSalida;  |QBF aVersion2;

     |SI aVersion1 ! aVersion2;
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     |CLS;

||     |PINPA #0#0;

     |MENSA "0000Accediendo al servicio WEB de Atención Telefónica de Diagram Software";

     |PTEC 806;
     |PAUSA;

     aEjecuta = "START c:\documentos\agitool\dsabreweb.exe " + &34 + "http://www.geconet.net/at.php?dsini="
     aEjecuta = aEjecuta + aIni + "&dsusu=" + aUsuario + "&dsdir=" + aPathBase + &34;

     aBat = "c:\documentos\agitool\" + aUsuario + ".bat";
     |FBORRA aBat;

     |XABRE "WC", aBat, nHandle;
     |SI FSalida ] 0;
          aAlfa1 = "@ECHO OFF";
          |XGRABA nHandle, aAlfa1;

          |XGRABA nHandle, aEjecuta;
     |FINSI;
     |XCIERRA nHandle;

     aEjecuta = "cmd " + &34 + "/c " + aBat + &34;
     |RSYSTEM aEjecuta;

     |SLEEP 3;
|FPRO;
