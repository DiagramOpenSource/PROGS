|FICHEROS;
     dsam0016@;
     av060m02@;
     av060m03@;

     dsam9998@;

     laboru01@;
|FIN;

|VARIABLES;
     nHandle          = 0;
     nHndlMen         = 0;
     nHndlPlt         = 0;
     nDias            = 0;
     nAviso           = 0;
     nIni             = 0;
     nLong            = 0;
     nVoy             = 0;
     nSaca            = 0;
     nCarac           = 0;
     nPos             = 0;
     nSeg             = 0;
     nOpc1            = 0;
     nOpc2            = 0;
     nOpc3            = 0;
     nOpc4            = 0;
     nOpc5            = 0;
     nOpc6            = 0;
     nOpc7            = 0;
     nOk              = 0;
     nDCmp            = 0;
     nHCmp            = 0;
     nCmp             = 0;

     aMas             = "";
     aUsuario         = "";
     aFichero         = "";
     aCR              = "";
     aLF              = "";
     aCadena          = "";
     aAlfa            = "";
     aUsu1            = "";
     aUsu2            = "";
     aUsu3            = "";
     aAbre            = "";
     aCarp            = "";
     aLee             = "";
     aOrigen          = "";
     aDestino         = "";
     aMD5Ori          = "";
     aMD5Des          = "";
     aBass            = "";
     aBase            = "";
     aBas             = "";
     aUrl             = "";
     aUrlAP           = "";
     aApi             = "";
     aPathPlugins     = "";
     aLogSincro       = "";
     aEjeSincro       = "";
     aIni             = "";
     aLong            = "";
     aLetra           = "";
     aAse             = "";
     aCaracter        = "";
     aPython          = "";
     aDefec           = "";
     aFic             = "";
     aIP              = "";
     aQS              = "";
     aMen             = "";
     aPlt             = "";
     aPathUsu         = "";
     aEjec            = "";
     aOpcMen          = "";
     aAlf1            = "";
     aAlf2            = "";
     aAlf3            = "";
     aAlf4            = "";
     aAlf5            = "";
     aAlf6            = "";
     aAlf7            = "";

     fFecha           = @;

  {1}aContiene        = "";

 {-1}aAviso           = "";
     aAviso1          = "";
     aAviso2          = "";
     aAviso3          = "";
     aAviso4          = "";

 {-1}aSerie           = "";
 {23}aOpc             = "";

     &enAprobacion    = 0;
     &eaPrograma      = "";
|FIN;

|PROCESO DSARCHI_INI;
     enAprobacion = 0;

     |DBASS aBass;  |QBF aBass;
     aFichero = aBass + "dsarchi/dsarchi.ini";
     |XABRE "AB", aFichero, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aCR        = &10;
     aLF        = &13;
     aCadena    = "";

     |XLEE nHandle, 1, aAlfa;
     |PARA; |SI FSalida > 0; |HACIENDO;
            |SI aAlfa = aCR;
                |SI aCadena = eaPrograma;
                    enAprobacion = 1;
                    |SAL;
                |FINSI;

                aCadena = "";
            |SINO;
                |SI aAlfa ! aLF;
                    aCadena = aCadena + aAlfa;
                |FINSI;
            |FINSI;
            |XLEE nHandle, 1, aAlfa;
     |SIGUE;

     |SI aCadena = eaPrograma;
          enAprobacion = 1;
     |FINSI;

     |XCIERRA nHandle;
|FPRC;

|PROCESO av060m03;
     #av060m02@#0 = #av060m03@#0;
     #av060m02@#1 = #av060m03@#1;
     |LEE 000#av060m02@.=;
     |SI FSalida ! 0;  |DDEFECTO #av060m02@;  |FINSI;

     aUsu1 = #av060m02@#4;  |QBF aUsu1;
     aUsu2 = "";

     |SI #av060m03@#8 = "N";
         nDias = fFecha - #av060m03@#5;
         |SI nDias ] #av060m02@#6;
             aUsu2 = #av060m02@#5;  |QBF aUsu2;
         |FINSI;
     |FINSI;

     |SI aUsu1 = "";  |Y aUsu2 = "";
         |SI aUsu3 = aUsuario;
             nAviso = 1;
             |ERROR10;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI aUsu1 = aUsuario;
         nAviso = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI aUsu2 = aUsuario;
         nAviso = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE av060m03;
     #av060m03@#2003;
     ;
     "N", "            ", "            ";
     "N", "zzzzzzzzzzzz", "zzzzzzzzzzzz";
     ;
     NULL, av060m03;
|FIN;

|PROCESO AvisosZero;
     aMas = aBass + "integral/def/dsam0016.mas";
     |CARGA_DEF aMas, dsam0016@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aMas = aBass + "integral/def/av060m02.mas";
     |CARGA_DEF aMas, av060m02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #dsam0016@;
         |ACABA;
     |FINSI;

     aMas = aBass + "integral/def/av060m03.mas";
     |CARGA_DEF aMas, av060m03@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #av060m02@;
         |DESCARGA_DEF #dsam0016@;
         |ACABA;
     |FINSI;

     aUsu1 = "";
     aUsu2 = "";
     aUsu3 = "";

     |ABRE #dsam0016@;
     #dsam0016@#0 = aUsuario;
     |LEE 000#dsam0016@.=;
     |SI FSalida = 0;
         aUsu3 = #dsam0016@#0;  |QBF aUsu3;
     |FINSI;
     |CIERRA #dsam0016@;

     nAviso = 0;
     |ABRE #av060m02@;
     |BUCLE av060m03;
     |CIERRA #av060m02@;

     |DESCARGA_DEF #av060m03@;
     |DESCARGA_DEF #av060m02@;
     |DESCARGA_DEF #dsam0016@;

     |SI nAviso = 1;
         aAviso1 = "0";
         aAviso2 = "2";
         aAviso3 = "Plataforma Integrada DS";
         aAviso4 = "Tiene avisos DEH, recuerde comprobarlos en su mantenimiento";
         |ESPECIFICA "MENSAJETRAY", aAviso;
     |FINSI;
|FPRC;

|PROCESO AvisosManuales;
     aMas = aBass + "integral/def/dsam0016.mas";
     |CARGA_DEF aMas, dsam0016@;

     |ABRE #dsam0016@;
     #dsam0016@#0 = aUsuario;
     |LEE 000#dsam0016@.=;
     |SI FSalida = 0;
         |SI #dsam0016@#1 ! fFecha;
             aAviso1 = "0";
             aAviso2 = "2";
             aAviso3 = "Plataforma Integrada DS";
             aAviso4 = "Recuerde comprobar las DEH";
             |ESPECIFICA "MENSAJETRAY", aAviso;
         |FINSI;
     |FINSI;
     |CIERRA #dsam0016@;

     |DESCARGA_DEF #dsam0016@;
|FPRC;

|PROCESO AvisosLabornet;
     aMas = aBass + "laboral/def/laboru01.mas";
     |XABRE "E", aMas, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aMas = aBass + "laboral/def/laboru01.mas";
     |CARGA_DEF aMas, laboru01@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |ABRE #laboru01@;
     #laboru01@#0 = aUsuario;
     |LEE 000#laboru01@.=;
     |SI FSalida ! 0;
         |CIERRA #laboru01@;
         |DESCARGA_DEF #laboru01@;
         |ACABA;
     |FINSI;
     |CIERRA #laboru01@;

     |DESCARGA_DEF #laboru01@;

     |SUB_EJECUTA ":laboral/laboru02";
|FPRC;

|PROCESO Avisos;
     || Mensajes globos al usuario para la gestiones del DEH

     |DBASS aBass;  |QBF aBass;
     aMas = aBass + "integral/def/dsam0016.mas";
     |XABRE "E", aMas, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aUsuario = Usuario % 810;
     fFecha   = ~;

     eaPrograma = "ACTIVADEH";
     |HAZ DSARCHI_INI;

     |SI enAprobacion = 1;
         |HAZ AvisosZero;
     |SINO;
         |HAZ AvisosManuales;
     |FINSI;

     |HAZ AvisosLabornet;
|FPRC;

|PROCESO GrabaLin;
     aAlfa = aLee % 101;
     |SI aAlfa ! "[";  |ACABA;  |FINSI;

     aAlf1 = aLee % 203;
     aAlf2 = aLee % 603;
     aAlf3 = aLee % 1001;
     aAlf4 = aLee % 1201;
     aAlf5 = aLee % 1401;
     aAlf6 = aLee % 1601;
     aAlf7 = aLee % 1801;

     nOk   = 1;
     aEjec = "S";
     |SI aAlf1 ! "001";  |Y aAlf1 ! "   ";
         nOk   = 0;
         aEjec = "N";
         nDCmp = aAlf1;
         nHCmp = aAlf2;
         |PARA nCmp = nDCmp;  |SI nCmp [ nHCmp;  |HACIENDO nCmp = nCmp + 1;
               |SI #dsam9998@#nCmp# ! "X";
                   nOk = 1;
               |FINSI;

               |SI #dsam9998@#nCmp# = "S";
                   aEjec = "S";
               |FINSI;
         |SIGUE;
     |FINSI;

     |SI nOk = 0;
         |ACABA;
     |FINSI;

     |SI aAlf3 = "C";
         nOpc1 = nOpc1 + 1;
         nOpc2 = 0;
         nOpc3 = 0;
         nOpc4 = 0;
         nOpc5 = 0;
     |FINSI;

     |SI aAlf4 = "C";
         nOpc2 = nOpc2 + 1;
         nOpc3 = 0;
         nOpc4 = 0;
         nOpc5 = 0;
     |FINSI;

     |SI aAlf5 = "C";
         nOpc3 = nOpc3 + 1;
         nOpc4 = 0;
         nOpc5 = 0;
     |FINSI;

     |SI aAlf6 = "C";
         nOpc4 = nOpc4 + 1;
         nOpc5 = 0;
     |FINSI;

     |SI aAlf7 = "C";
         nOpc5 = nOpc5 + 1;
     |FINSI;

     |SI aAlf3 = " "; nOpc1 = 0;  |FINSI;
     |SI aAlf4 = " "; nOpc2 = 0;  |FINSI;
     |SI aAlf5 = " "; nOpc3 = 0;  |FINSI;
     |SI aAlf6 = " "; nOpc4 = 0;  |FINSI;
     |SI aAlf7 = " "; nOpc5 = 0;  |FINSI;

     |SI nOpc1 ! 0;  aOpcMen = nOpc1;                   |FINSI;
     |SI nOpc2 ! 0;  aOpcMen = aOpcMen  + "," + nOpc2;  |FINSI;
     |SI nOpc3 ! 0;  aOpcMen = aOpcMen  + "," + nOpc3;  |FINSI;
     |SI nOpc4 ! 0;  aOpcMen = aOpcMen  + "," + nOpc4;  |FINSI;
     |SI nOpc5 ! 0;  aOpcMen = aOpcMen  + "," + nOpc5;  |FINSI;

     aOpcMen = aOpcMen + ":" + (aLee % 20);

     |SI aEjec = "N";
         aEjec = aOpcMen - "{{";
         |SI FSalida ! 0;
             aAlfa   = FSalida;
             aAlfa   = aAlfa % 102;
             nPos    = aAlfa;
             nPos    = 100 + (nPos - 1);
             aAlfa   = aOpcMen % nPos;
             aOpcMen = aAlfa + "{{:integral/dsaz9998;MENSAJECOMERCIAL}}";
         |FINSI;
     |FINSI;

     aOpcMen = aOpcMen +  &13 + &10;
     |XGRABA nHndlMen, aOpcMen;
|FPRC;

|PROCESO CreaMenu;
     aPlt = aBass + "integral/plantillas/pibox.txt";
     |XABRE "E", aPlt, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aMen = aPathUsu + "pibox.men";
     |XABRE "W ", aMen, nHndlMen;

     aAlfa = "#:PIBOX" + &13 + &10;
     |XGRABA nHndlMen, aAlfa;

     aPlt = aBass + "integral/plantillas/pibox.txt";
     |XABRE " ", aPlt, nHndlPlt;
     |PARA;  |SI;  |HACIENDO;
          |XLEE nHndlPlt, 250, aLee;
          |SI FSalida < 0;  |SAL;  |FINSI;

          |HAZ GrabaLin;
     |SIGUE;

     |XCIERRA nHndlPlt;
     |XCIERRA nHndlMen;
|FPRC;

|PROCESO CreaMenPibox;
     aUsuario = Usuario % 810;  |QBF aUsuario;

     aAbre = aBass + "dev/usr/ds_sys.psw";

     aCarp = "";
     |XABRE " ", aAbre, nHandle;
     |PARA;  |SI;  |HACIENDO;
          |XLEE nHandle, 200, aLee;
          |SI FSalida [ 0;  |SAL;  |FINSI;

          aAlfa = aLee % 410;  |QBF aAlfa;
          |SI aAlfa = aUsuario;
              aCarp = aLee % 103;
              |SAL;
          |FINSI;
     |SIGUE;
     |XCIERRA nHandle;

     |SI aCarp = "";  |ACABA;  |FINSI;

     aPathUsu = aBass + "dev/usr/" + aCarp;  |MKDIR aPathUsu;
     aPathUsu = aBass + "dev/usr/" + aCarp + "/";

     |HAZ CreaMenu;
|FPRC;

|PROCESO TraeWeb;
     aBas   = aBass % -2;
     aAse   = "";
     aLong  = aBas % 0;
     nLong  = aLong;
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos       = (nCarac * 100) + 1;
           aCaracter  = aBas % nPos;
           aAse       = aAse + aCaracter;

           |SI aCaracter = "/";  |O aCaracter = "\";
               aAse = "";
           |FINSI;
     |SIGUE;

     aUrl         = "https://porconstruir.com"
     aPathPlugins = aBase + "plugins/";
     aApi         = aPathPlugins + "peticiones_api.py";
     aLogSincro   = aBase + "peticiones_api.log";
     |FBORRA aLogSincro;

     aOpc1  = "A";
     aOpc2  = "S";
     aOpc3  = "S";
     aOpc4  = "S";
     aOpc5  = "S";
     aOpc6  = "S";
     aOpc7  = "S";
     aOpc8  = "S";
     aOpc9  = "S";
     aOpc10 = "S";
     aOpc11 = "S";
     aOpc12 = "S";
     aOpc13 = "S";
     aOpc14 = "S";
     aOpc15 = "S";
     aOpc16 = "S";
     aOpc17 = "S";
     aOpc18 = "S";
     aOpc19 = "S";
     aOpc20 = "S";
     aOpc21 = "S";
     aOpc22 = "S";
     aOpc23 = "S";

     |SI aDefec ! "";
         aOpc1  = aDefec % 101;
         aOpc2  = aDefec % 201;
         aOpc3  = aDefec % 301;
         aOpc4  = aDefec % 401;
         aOpc5  = aDefec % 501;
         aOpc6  = aDefec % 601;
         aOpc7  = aDefec % 701;
         aOpc8  = aDefec % 801;
         aOpc9  = aDefec % 901;
         aOpc10 = aDefec % 1001;
         aOpc11 = aDefec % 1101;
         aOpc12 = aDefec % 1201;
         aOpc13 = aDefec % 1301;
         aOpc14 = aDefec % 1401;
         aOpc15 = aDefec % 1501;
         aOpc16 = aDefec % 1601;
         aOpc17 = aDefec % 1701;
         aOpc18 = aDefec % 1801;
         aOpc19 = aDefec % 1901;
         aOpc20 = aDefec % 2001;
         aOpc21 = aDefec % 2101;
         aOpc22 = aDefec % 2201;
         aOpc23 = aDefec % 2301;
     |FINSI;

/*
     aEjeSincro = aPython;
     aEjeSincro = aEjeSincro + " " + aApi;
     aEjeSincro = aEjeSincro + " " + aUrl;
     aEjeSincro = aEjeSincro + " /myapi/sincro/ase/";
     aEjeSincro = aEjeSincro + " " + aUrlAP;
     aEjeSincro = aEjeSincro + " " + aIni;
     aEjeSincro = aEjeSincro + " " + aLogSincro;
     |SYSTEM aEjeSincro;

     nSeg = 0;
     |PARA;  |SI;  |HACIENDO;
          |XABRE "E", aLogSincro, 0;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |SLEEP 1;

          nSeg = nSeg + 1;
          |SI nSeg ] 3;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     |XABRE "E", aLogSincro, 0;
     |SI FSalida ] 0;
         |XABRE "", aLogSincro, nHandle;
         |XLEE nHandle, 255, aLee;
         |XCIERRA nHandle;

         |QBF aLee;
         aLong = aLee % 0;
         |SI aLong = "23";
             aOpc1  = aLee % 101;
             aOpc2  = aLee % 201;
             aOpc3  = aLee % 301;
             aOpc4  = aLee % 401;
             aOpc5  = aLee % 501;
             aOpc6  = aLee % 601;
             aOpc7  = aLee % 701;
             aOpc8  = aLee % 801;
             aOpc9  = aLee % 901;
             aOpc10 = aLee % 1001;
             aOpc11 = aLee % 1101;
             aOpc12 = aLee % 1201;
             aOpc13 = aLee % 1301;
             aOpc14 = aLee % 1401;
             aOpc15 = aLee % 1501;
             aOpc16 = aLee % 1601;
             aOpc17 = aLee % 1701;
             aOpc18 = aLee % 1801;
             aOpc19 = aLee % 1901;
             aOpc20 = aLee % 2001;
             aOpc21 = aLee % 2101;
             aOpc22 = aLee % 2201;
             aOpc23 = aLee % 2301;
         |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO AveriguaINI;
     aUrlAP  = "";
     aIni    = "";

     aSerie = "";
     |ESPECIFICA "SERIALIZACION", aSerie;
     aIni = FSalida;
     aIni = aIni % 106;
     nIni = aIni;
     aIni = ("000000" + nIni) % -106;

     aLong = aBass % A0;
     nLong = aLong;
     |PARA nVoy = 1; |SI nVoy [ nLong; |HACIENDO nVoy = nVoy + 1;
          nSaca  = (nVoy * 100) + 1;
          aLetra = aBass % nSaca;
          |SI aLetra = "/";  |O aLetra = "\";
               aLetra = "_";
          |FINSI;
          aUrlAP = aUrlAP + aLetra;

          |SI aLetra = ":";
              aUrlAP = "";
          |FINSI;
     |SIGUE;

     FSalida = 0;
|FPRC;

|PROCESO QuePython;
     aFic = aBass + "integral/integral.ini";
     |XABRE "", aFic, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aPython = "";
     aDefec  = "";
     |PARA;  |SI;  |HACIENDO;
          |XLEE nHandle, 250, aLee;
          |SI FSalida < 0;  |SAL;  |FINSI;

          |QBT aLee;

          aAlfa = aLee - "python=";
          |SI FSalida ! 0;
              aPython = aAlfa;
          |FINSI;

          aAlfa = aLee - "defectospibox=";
          |SI FSalida ! 0;
              aDefec  = aAlfa;
          |FINSI;
     |SIGUE;

     |XCIERRA nHandle;

     |SI aPython = "";
         aPython  = "python2.7";

         aIP = ""; |IP_REMOTO aIP;
         aQS = ""; |QUE_SISTEMA aQS;
         |SI aIP = ""; |O aQS = "ESDOS";
             aPython  = "python";
         |FINSI;
     |FINSI;
|FPRC;


|PROCESO ConfMenus;
/*
     aUsuario = Usuario % 810;
     |SI aUsuario = "JUANMA";
          |DEBUG;
     |FINSI;
*/

     |DBASS aBass;
     |DBASE aBase;

     aMas = aBass + "integral/def/dsam9998.mas";
     |CARGA_DEF aMas, dsam9998@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |HAZ QuePython;
     |HAZ AveriguaINI;
     |HAZ TraeWeb;

     |ABRE #dsam9998@;
     |LEE 101#dsam9998@.p;
     |SI FSalida ! 0;
         |DDEFECTO #dsam9998@;
         |GRABA 020#dsam9998@.b;
     |FINSI;

     #dsam9998@#1  = aOpc1;
     #dsam9998@#2  = aOpc2;
     #dsam9998@#3  = aOpc3;
     #dsam9998@#4  = aOpc4;
     #dsam9998@#5  = aOpc5;
     #dsam9998@#6  = aOpc6;
     #dsam9998@#7  = aOpc7;
     #dsam9998@#8  = aOpc8;
     #dsam9998@#9  = aOpc9;
     #dsam9998@#10 = aOpc10;
     #dsam9998@#11 = aOpc11;
     #dsam9998@#12 = aOpc12;
     #dsam9998@#13 = aOpc13;
     #dsam9998@#14 = aOpc14;
     #dsam9998@#15 = aOpc15;
     #dsam9998@#16 = aOpc16;
     #dsam9998@#17 = aOpc17;
     #dsam9998@#18 = aOpc18;
     #dsam9998@#19 = aOpc19;
     #dsam9998@#20 = aOpc20;
     #dsam9998@#21 = aOpc21;
     #dsam9998@#22 = aOpc22;
     #dsam9998@#23 = aOpc23;

     |GRABA 020#dsam9998@.a;
     |LIBERA #dsam9998@;

     |CIERRA #dsam9998@;

     |HAZ CreaMenPibox;

     |DESCARGA_DEF #dsam9998@;
|FPRC;

|PROGRAMA;
     |HAZ ConfMenus;
     |HAZ Avisos;
|FPRO;
