|FICHEROS;
     referen@;
     autorun #0;
|FIN;

|VARIABLES;
     nConta = 0;
     aMacEther = "";
     aDirWebFondo = "";
     aMensaje = "";
     aSistema = "";
     aNumAse = "";
     aLong = "";
     nLong = 0;
     nCampo = 0;
     nSaca = 0;
     aSaca = "";
     aBusca = "";
     {1}aLocal = "";
     aDirLocal = "";
     aEjecuta = "";
     aBorra = "";
     aExiste = "";
     nHandleE = 0;
     aAlfa5 = "";
     aUno = "";
     aDos = "";
     aTgz = "";
     aTar = "";

     aPatFondos     = "";
     aFicInstalado  = "";
     aNomFicTgz     = "";
     aNomFicTar     = "";
     aDir           = "";
     aAlfa          = "";
     aPrograma      = "";
     aParametro     = "";
     aUsuario       = "";
     aIni           = "";
     aAbre          = "";
     aBase          = "";
     aCR            = "";
     aLF            = "";
     aCadena        = "";
     aCadenaBusca   = "";
     aOrigen        = "";
     aDestino       = "";
     aRemoto        = "";
     aServidor      = "";
     aIPRemoto      = "";
     aBaseLocal     = "";
     aPathWeb       = "";
     aWeb           = "";
     aCad           = "";

     nIni           = 0;
     nControl       = 0;
     nErrorEje      = 0;
     nErrorCad      = 0;
     nHandle        = 0;
     nHandle1       = 0;
     nHandle2       = 0;
     nInstalar      = 0;
     nCalc          = 0;
     nCalc1         = 0;

     {-1}aSerie     = "";
     {1}aContiene   = "";

     aIP = "";
     aPath = "";
     aFic = "";
     aTmp = "";
     nSw = 0;
     nTmp = 0;
     nPanta = 0;
     i = 0;


||     aAlfa = "";
     aBass = "";
     aBassLocal = "";
     aExe = "";
     aUsu = "";
     aProg = "";
     aClave = "";
||     nHandle = 0;
     nNume1 = 0;
     nNume2 = 0;
     aAlfa1 = "";
     aAlfa2 = "";
||     aIP = "";
||     i = 0;
||  {1}aLocal = "";
     aBat = "";
     aExeLogin = "";
     aCHMOD = "";
     nDebugando = 0;
|FIN;

/*
|PROCESO SacaClave;
     aAlfa = aBass + "dev/usr/ds_sys.psw";
     |XABRE "", aAlfa, nHandle;
     |SI FSalida = 0;
          |XLEE nHandle, 250, aAlfa;
          |PARA; |SI FSalida ] 0; |HACIENDO;
               aClave = aAlfa % 1420;
               aAlfa = aAlfa % 410; |QBF aAlfa;
               |SI aAlfa = aUsu; |SAL; |FINSI;
               |XLEE nHandle, 250, aAlfa;
          |SIGUE;
          |XCIERRA nHandle;
     |FINSI;

     aAlfa = "";
     |PARA i = 1; |SI i [ 20; |HACIENDO i = i + 2;
          nNume1 = (i * 100) + 1;       aAlfa1 = aClave % nNume1;
          nNume1 = ((i + 1) * 100) + 1; aAlfa2 = aClave % nNume1;
          nNume1 = &aAlfa2;
          nNume1 = nNume1 - 65;
          nNume2 = &aAlfa1;
          nNume2 = nNume2 - 65;
          nNume2 = ((nNume2 * 26) + nNume1) / 2;
          aAlfa = aAlfa + &nNume2;
     |SIGUE;
     aClave = aAlfa; |QBF aClave;
|FPRC;

|PROCESO EjeDsParcli;
     |DBASS aBass;
     aAlfa = aBass + "dsparcli/def/dstelz16.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida < 0; |ACABA; |FINSI;        || No existe

     aUsu = Usuario % 810; |QBF aUsu;

     aAlfa = aBass + "dsparcli/def/dsparm05.mas";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aExeLogin = "N";
     aAlfa = aBass + "dsparcli/fich/";
     |PATH_DAT #referen@#aAlfa#;
     |ABRE #referen@;
     |SELECT #3#referen@;
     #referen@#2 = aUsu;
     |LEE 140#referen@.=;
     |SI FSalida = 0; |Y #referen@#15 = "S"; |Y #referen@#16 = "N";
          #referen@#16 = "S";
          |GRABA 020#referen@.a;
          aExeLogin = "S";
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
     |SI aExeLogin = "N"; |ACABA; |FINSI;

     |HAZ SacaClave;

     aIP = "";
     |IP_LOCAL aIP;

     |ESPECIFICA "RBASS", aLocal;
     aBassLocal = aLocal;
     aExe = aBassLocal + "bin/diagramx.exe";

     aProg = aExe + " /DS:" + &34 + "@" + aBassLocal + " @-C:" + aIP + "-M";
     aProg = aProg + aBass + " $$$" + aUsu + "," + aClave + "#";
     aProg = aProg + " //(dsparcli)|:dsparcli/dstelz36;login" + &34;
     ||RSYSTEM aProg;  -> falla, por eso hago el bat

     aBat = aBassLocal + "dstelz36.bat";
     |XABRE "CW", aBat, nHandle;
     |XGRABA nHandle, "@echo off";
     |XGRABA nHandle, aProg;
     |XGRABA nHandle, "exit";
     |XCIERRA nHandle;

||    aAlfa = "cmd " + &34 + "/c START /MIN " + aBat + &34;
     aAlfa = aBat;
     |RSYSTEM aAlfa;
|FPRC;
*/

|PROCESO EjeDsParcli;
     |DBASS aBass;
     aAlfa = aBass + "dsparcli/def/dstelz16.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida < 0; |ACABA; |FINSI;        || No existe

     aUsu = Usuario % 810; |QBF aUsu;

     aAlfa = aBass + "dsparcli/def/dsparm05.mas";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aAlfa = aBass + "dsparcli/fich/";
     |PATH_DAT #referen@#aAlfa#;
     |ABRE #referen@;
     |SELECT #3#referen@;
     #referen@#2 = aUsu;
     |LEE 000#referen@.=;
     |SI FSalida ! 0;  |DDEFECTO #referen@;  |FINSI;
     |CIERRA #referen@;

     |SI #referen@#15 = "N";
         |DESCARGA_DEF #referen@;
         |ACABA;
     |FINSI;
     |DESCARGA_DEF #referen@;

     |SUB_EJECUTA ":dsparcli/dstely05;AUTO";
|FPRC;

|PROCESO AveriguaINI;
     aSerie = "";
     |ESPECIFICA "SERIALIZACION", aSerie;
     aSerie = aSerie % 106;          ||Esto es el numero de ORO
     nIni = aSerie;
     aIni = ("000000" + nIni) % -106;
|FPRC;

|PROCESO LeeAgitoolIni;
     |DBASE aBase;  |QBF aBase;
     aAbre = aBase + "agitool.ini";

     aIP = ""; |IP_REMOTO aIP;
     |SI aIP = "";       || modo local
          |XABRE "C", aAbre, nHandle;
     |SINO;              || modo C/S
          |XABRE "", aAbre, nHandle;
     |FINSI;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aCadena    = "";
     nErrorEje  = 0;
     nErrorCad  = 0;

     |PARA;  |SI;  |HACIENDO;
             |XLEE nHandle, 250, aCadena;
             |SI FSalida < 0;  |SAL;  |FINSI;
             |QBF aCadena;

             |SI aCadena = "DS_EJE_PHP";
                  nErrorEje = 1;
             |FINSI;

             |SI aCadena = "DS_CAD_PHP";
                  nErrorCad = 1;
             |FINSI;
     |SIGUE;

     |XCIERRA nHandle;
|FPRC;

|PROCESO EnviaConMD5;
     aIPRemoto = ""; |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     aContiene1 = aDestino;
     |SI aIPRemoto ! "";
          |ESPECIFICA "REMOTOMD5", aContiene;
     |SINO;
          |ESPECIFICA "MD5", aContiene;
     |FINSI;
     aRemoto = FSalida;  |QBF aRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aServidor = FSalida;  |QBF aServidor;

     |PULSATECLA;

     nInstalar = 0;

     |SI aRemoto ! aServidor;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;

         nInstalar = 1;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO LeeWebEje;
     |DBASE aBase;  |QBF aBase;
     aAbre = aBase + "plugins/ds_eje_php.txt";

     |XABRE "AB", aAbre, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |XLEE nHandle, 250, aWeb;
     |QBF aWeb;

     |PARA;  |SI;  |HACIENDO;
          aWeb = aWeb - &13;
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     |PARA;  |SI;  |HACIENDO;
          aWeb = aWeb - &10;
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     |XCIERRA nHandle;
|FPRC;

|PROCESO LeeWebCad;
     |DBASE aBase;  |QBF aBase;
     aAbre = aBase + "plugins/ds_cad_php.txt";

     |XABRE "AB", aAbre, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |XLEE nHandle, 250, aWeb;
     |QBF aWeb;

     |PARA;  |SI;  |HACIENDO;
          aWeb = aWeb - &13;
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     |PARA;  |SI;  |HACIENDO;
          aWeb = aWeb - &10;
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     |XCIERRA nHandle;
|FPRC;

|PROCESO ActDefault;
     |ACABA;   || R.PRIEGO-05.04.2012: puesto para que no se ejecute por falta
               || de uso

     aIP = ""; |IP_REMOTO aIP;
     |SI aIP = "";
          |DBASS aPath;
          aPath = aPath + "dev/";
          aFic = aPath + "default.fnt";
     |SINO;
          aContiene = "";
          |ESPECIFICA "RBASS", aContiene;
          aBaseLocal = aContiene1;
          aAlfa = aBaseLocal + "dev/default.fnt";
          |DBASS aPath;
          aFic = aPath + "default.ser";
          |RECIBE_FICHERO aAlfa, aFic;
     |FINSI;

     aTmp = aPath + "default.tmp";
     aCadena = "; Versión básico mínima requerida: 9.10.086-45";
     nSw = 0;
     |XABRE "", aFic, nHandle;
     |SI FSalida ] 0;
          |XABRE "W", aTmp, nTmp;
          |SI FSalida ] 0;
               |PARA i = 1; |SI i [ 4; |HACIENDO i = i + 1;
                    |XLEE nHandle, 250, aAlfa;
                    |SI FSalida < 0; |SAL; |FINSI;
                    |SI i ! 4; |XGRABA nTmp, aAlfa; |FINSI;
               |SIGUE;
               |SI aAlfa ! aCadena;
                    |XGRABA nTmp, aCadena;
                    aCadena = ";-------------------------------------------------------PANTALLAS DE 10";
                    |PARA; |SI; |HACIENDO;
                         |XLEE nHandle, 250, aAlfa;
                         |SI FSalida < 0; |SAL; |FINSI;
                         |SI aAlfa = aCadena; |SAL; |FINSI;
                         |XGRABA nTmp, aAlfa;
                    |SIGUE;
                    |DBASE aAlfa;
                    aAlfa = aAlfa + "plugins/pantallax.txt";
                    |XABRE "", aAlfa, nPanta;
                    |SI FSalida ] 0;
                         |PARA; |SI; |HACIENDO;
                              |XLEE nPanta, 250, aAlfa;
                              |SI FSalida < 0; |SAL; |FINSI;
                              |XGRABA nTmp, aAlfa;
                         |SIGUE;
                         nSw = 1;
                         |XCIERRA nPanta;
                    |FINSI;
               |FINSI;
               |XCIERRA nTmp;
          |FINSI;
          |XCIERRA nHandle;
     |FINSI;

     |SI nSw = 1;
          |SI aIP = "";
               |COPIA_FICHERO aTmp, aFic;
          |SINO;
               |FBORRA aFic;
               aFic = aBaseLocal + "dev/default.fnt";
               |ENVIA_FICHERO aTmp, aFic;
          |FINSI;
     |FINSI;
     |FBORRA aTmp;
|FPRC;

|PROCESO ControlFondo;        ||Se baja si existe AAAAAABBBB.tgz y lo descomprime en el puesto
                              ||dentro hay una carpeta "fondo", con el fondo WEB

     |ACABA;   || R.PRIEGO-19.07.2011: puesto para que no se ejecute por falta
               || de pruebas


     ||SI es distinto de UNIX . o no es C/S ... no hace nada

     aDirWebFondo = "http://www.geconet.net/.gecoplug/";
     |QUE_SISTEMA aSistema;
     |QBF aSistema;
     |SI aSistema = "ESDOS"; |ACABA; |FINSI;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto; |QBT aIPRemoto;

     |SI aIPRemoto = ""; |ACABA; |FINSI;


     |DBASS aBase;
     |QBF aBase;

     aNumAse = "0000";
     aAlfa = aBase - "/ase";
     |SI FSalida ! 0;
          aLong = aBase % A0;
          nLong = aLong;
          |PARA nCampo = 1; |SI nCampo [ nLong; |HACIENDO nCampo = nCampo + 1;
               nSaca = nCampo * 100;
               nSaca = nSaca + 4;
               aSaca = nSaca;
               aBusca = aBase % aSaca;
               |SI aBusca = "/ase";
                    nSaca = nCampo + 4;
                    nSaca = nSaca * 100;
                    nSaca = nSaca + 4;
                    aSaca = nSaca;
                    aNumAse = aBase % aSaca;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;

     |ESPECIFICA "RBASS", aLocal;
     aDirLocal = aLocal;
     |QBF aDirLocal;

     |DBASE aBase;
     |QBF aBase;

     ||Me traigo el wget.exe. con EnviaConMD5
     aOrigen  = aBase + "wget.exe";
     aDestino = aDirLocal + "wget.exe";
     |HAZ EnviaConMD5;

     aBorra = aDirLocal + aIni + aNumAse + ".tgz";
     |RFBORRA aBorra;
     aBorra = aDirLocal + aIni + aNumAse + ".log";
     |RFBORRA aBorra;

     aEjecuta = "cmd " + &34 + "/c " + aDestino + " -o " + aDirLocal + aIni + aNumAse + ".log " + aDirWebFondo + aIni + aNumAse + ".tgz" + &34;
     |RSYSTEM aEjecuta;

     aExiste = aDirLocal + aIni + aNumAse + ".tgz";
     |XABRE "CE", aExiste, nHandleE;
     |SI FSalida ! 1;
          ||No se ha bajado nada, NO tengo nada que hacer
          |ACABA;
     |FINSI;

     aAlfa = aDirLocal + aIni + aNumAse + ".tgz";
     aContiene1 = aAlfa;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aUno = FSalida;
     |QBF aUno;

     aAlfa = aDirLocal + aIni + aNumAse + ".ya";
     aContiene1 = aAlfa;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDos = FSalida;
     |QBF aDos;

     |SI aUno ! aDos;
          ||Son distintos, o el .ya NO existe.
          ||Tengo que descomprimir el .tgz y renombrarlo como .ya

          aTgz = aDirLocal + aIni + aNumAse + ".tgz";
          |RDESCOMPRIME aTgz;
          |SI FSalida = 0;
               aTar = aDirLocal + aIni + aNumAse + ".tar";
               |RDETAR aTar, aDirLocal;

               ||Supongo que hasta aqui ha ido todo bien.

               aUno = aDirLocal + aIni + aNumAse + ".tgz";
               aDos = aDirLocal + aIni + aNumAse + ".ya";

               |RRENOMBRA_FICHERO aUno, aDos;

               |RFBORRA aTar;
          |FINSI;
     |FINSI;
     ||ARA38

     aMensaje = "0000Control Fondo. " + aIni + aNumAse;
     ||MENAV aMensaje;
|FPRC;

|PROCESO MacEther;
     |DFICE aFic;
     aFic = aFic + Usuario;

     |QUE_SISTEMA aAlfa;
     |SI aAlfa = "ESDOS"
          |DBASE aAlfa;
          aAlfa = aAlfa + "plugins/macether.vbs " + aFic;
          aAlfa = "cmd " + &34 + "/c START /MIN /WAIT " + aAlfa + &34;
     |SINO;
          |DBASE aAlfa;
          aAlfa = aAlfa + "plugins/";
          aAlfa = aAlfa + "macether.sh";
          aCHMOD = "chmod 777 " + aAlfa;
          |SYSTEM aCHMOD;

          |DBASE aAlfa;
          aAlfa = aAlfa + "plugins/";
          aAlfa = aAlfa + "macether.sh " + aAlfa + "macether.py " + aFic;
     |FINSI;

     |SI nDebugando = 1; #0#0 = "SYSTEM maceher.sh ON"; |PINTA #0#0; |FINSI;
     |SYSTEM aAlfa;

     |SI nDebugando = 1; #0#0 = "SYSTEM maceher.sh OFF"; |PINTA #0#0; |FINSI;

     |PARA nConta = 0; |SI nConta [ 3; |HACIENDO nConta = nConta + 1;
          |XABRE "E", aFic, nHandle;
          |SI FSalida ] 0;
               |XABRE "", aFic, nHandle;
               |SI FSalida ] 0;
                    |XLEE nHandle, 250, aMacEther;
                    |XCIERRA nHandle;
               |FINSI;
               |FBORRA aFic;
               |SAL;
          |SINO;
               |SLEEP 1;
          |FINSI;
     |SIGUE;
     ||aAlfa = "0000" + aMacEther; |MENAV aAlfa;
|FPRC;

|PROCESO ControlAcceso;
     |IP_REMOTO aIP;
     |SI aIP = "";                 || para modo LOCAL
          |QUE_SISTEMA aAlfa;
          |SI aAlfa = "ESDOS";          || y solamente WINDOWS
               |HAZ LeeWebEje;
               |HAZ MacEther;

               |DBASE aBase;  |QBF aBase;
               aOrigen  = aBase + "plugins/ds_eje_php.exe";

               |DBASS aBase;  |QBF aBase;
               aPathWeb = aBase + "bin/";
               aDestino = aPathWeb + "ds_eje_php.exe";

               |HAZ EnviaConMD5;

               |DBASS aBase;  |QBF aBase;
               aPrograma  = aPathWeb + "ds_eje_php ";
               aParametro = "?Usuario=" + aUsuario + "&ini=" + aIni + "&path=L_" + aBase;
               aParametro = aParametro + "&mac=" + aMacEther;
               aAlfa = aPrograma + &34 + aWeb + aParametro + &34;
               |SYSTEM aAlfa;
          |FINSI;
     |SINO;
          |SI nDebugando = 1; #0#0 = "LeeWebEje";    |PINTA #0#0; |FINSI;
          |HAZ LeeWebEje;
          |SI nDebugando = 1; #0#0 = "MacEther";  |PINTA #0#0; |FINSI;
          |HAZ MacEther;

          |DBASE aBase;  |QBF aBase;
          aOrigen  = aBase + "plugins/ds_eje_php.exe";

          aContiene = "";
          |ESPECIFICA "RBASS", aContiene;
          aBaseLocal = aContiene1;
          aPathWeb   = aBaseLocal + "bin/";
          aDestino = aPathWeb + "ds_eje_php.exe";

          |SI nDebugando = 1; #0#0 = "EnviaConMD5"; |PINTA #0#0; |FINSI;
          |HAZ EnviaConMD5;

          |DBASS aBase;  |QBF aBase;
          aPrograma  = aPathWeb + "ds_eje_php ";
          aParametro = "?Usuario=" + aUsuario + "&ini=" + aIni + "&path=" + aBase;
          aParametro = aParametro + "&mac=" + aMacEther;
          aAlfa = aPrograma + &34 + aWeb + aParametro + &34;
          |SI nDebugando = 1; #0#0 = "RSYSTEM ds_eje_php ON"; |PINTA #0#0; |FINSI;
          |RSYSTEM aAlfa;
          |SI nDebugando = 1; #0#0 = "RSYSTEM ds_eje_php OFF"; |PINTA #0#0; |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaAgitoolIni;
     |DBASE aBase;  |QBF aBase;

     aOrigen  = aBase + "agitool.ini";
     aDestino = aBase + "agitool.old";
     |COPIA_FICHERO aOrigen, aDestino;

     aAbre = aBase + "agitool.old";
     aIP = ""; |IP_REMOTO aIP;
     |SI aIP = "";       || modo local
          |XABRE "C", aAbre, nHandle1;
     |SINO;              || modo C/S
          |XABRE "", aAbre, nHandle1;
     |FINSI;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aAbre = aBase + "agitool.ini";
     aIP = ""; |IP_REMOTO aIP;
     |SI aIP = "";       || modo local
          |XABRE "WC", aAbre, nHandle2;
     |SINO;              || modo C/S
          |XABRE "W", aAbre, nHandle2;
     |FINSI;

     aCadena    = "";
     nControl   = 0;

     |PARA;  |SI;  |HACIENDO;
             |XLEE nHandle, 250, aCadena;
             |SI FSalida < 0;  |SAL;  |FINSI;
             |QBF aCadena;

             |SI aCadena = "DS=1";
                 nControl = 1;

                 |SI aCad = "NO";
                     aCadena = "";
                 |FINSI;
             |FINSI;

             |XGRABA nHandle2, aCadena;
     |SIGUE;

     |SI nControl = 0;
         |SI aCad = "SI";
             aCadena = "DS=1";
             |XGRABA nHandle2, aCadena;
         |FINSI;
     |FINSI;

     |XCIERRA nHandle1;
     |XCIERRA nHandle2;

     aAlfa = aBase + "agitool.old";  |FBORRA aAlfa;
|FPRC;

|PROCESO ControlCaducidad;
     |IP_REMOTO aIP;
     |SI aIP = "";                 || para modo LOCAL
          |QUE_SISTEMA aAlfa;
          |SI aAlfa = "ESDOS";          || y solamente WINDOWS
               |HAZ LeeWebCad;

               |DBASE aBase;  |QBF aBase;
               aOrigen  = aBase + "plugins/ds_cad_php.exe";

               |DBASS aBase;  |QBF aBase;
               aPathWeb = aBase + "bin/";
               aDestino = aPathWeb + "ds_cad_php.exe";

               |HAZ EnviaConMD5;

               |DBASS aBase;  |QBF aBase;
               aPrograma  = aPathWeb + "ds_cad_php ";
               aParametro = "?ini=" + aIni + " " + aPathWeb + "ds_cad_res.txt";
               aAlfa = aPrograma + &34 + aWeb + aParametro + &34;
               |SYSTEM aAlfa;
          |FINSI;
     |SINO;
          |SI nDebugando = 1; #0#0 = "LeeWebCad";    |PINTA #0#0; |FINSI;
          |HAZ LeeWebCad;

          |DBASE aBase;  |QBF aBase;
          aOrigen  = aBase + "plugins/ds_cad_php.exe";

          aContiene = "";
          |ESPECIFICA "RBASS", aContiene;
          aBaseLocal = aContiene1;
          aPathWeb   = aBaseLocal + "bin/";
          aDestino   = aPathWeb + "ds_cad_php.exe";

          |SI nDebugando = 1; #0#0 = "EnviaConMD5"; |PINTA #0#0; |FINSI;
          |HAZ EnviaConMD5;

          |DBASS aBase;  |QBF aBase;
          aPrograma  = aPathWeb + "ds_cad_php ";
          aParametro = "?ini=" + aIni + " " + aPathWeb + "ds_cad_res.txt";
          aAlfa = aPrograma + &34 + aWeb + aParametro + &34;

          |SI nDebugando = 1; #0#0 = "RSYSTEM ds_eje_php ON"; |PINTA #0#0; |FINSI;
          |RSYSTEM aAlfa;

          |SI nDebugando = 1; #0#0 = "RSYSTEM ds_eje_php OFF"; |PINTA #0#0; |FINSI;
     |FINSI;

     aCad    = "";
     aAbre   = aPathWeb + "ds_cad_res.txt";
     |XABRE "C", aAbre, nHandle;

     |XLEE nHandle, 250, aCad;

     |XCIERRA nHandle;

     |QBF aCad;
     |SI aCad = "NO";  |HAZ GrabaAgitoolIni;  |FINSI;
     |SI aCad = "SI";  |HAZ GrabaAgitoolIni;  |FINSI;

     |RFBORRA aAbre;
|FPRC;

|PROCESO WebFondos;
     |DBASE aBase;
     aPatFondos = aBase + "fondos/";

     aDir  = aPatFondos + "*.tgz";
     |_PDIR aDir;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |MENUITEM 0, "2,6,1";
     aAlfa = FSalida;  |QBF aAlfa;
     |SI aAlfa = "UNCHECKED";
         aAlfa = "2,6,0";
         |MENUITEM 0, aAlfa;
     |FINSI;

     aNomFicTgz     = aDir - aPatFondos;
     aNomFicTar     = aNomFicTgz - ".tgz" + ".tar";
     aFicInstalado = aDir;

     |ESPECIFICA "RBASS", aLocal;
     aDirLocal = aLocal;
     |QBF aDirLocal;

     aDirLocal = aLocal + "fondo/";

     aOrigen  = aFicInstalado;
     aDestino = aDirLocal + aNomFicTgz;
     |HAZ EnviaConMD5;

     |SI nInstalar = 0;  |ACABA;  |FINSI;

     aDir = aDirLocal + "*.*";
     |R_PDIR aDir;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aDir;

          |R_SDIR aDir;
     |SIGUE;

     aOrigen  = aFicInstalado;
     aDestino = aDirLocal + aNomFicTgz;
     |HAZ EnviaConMD5;

     aAlfa = aDestino;
     |RDESCOMPRIME aAlfa;
     |SI FSalida = 0;
         aAlfa = aDirLocal + aNomFicTar;
         |RDETAR aAlfa, aDirLocal;
     |FINSI;

     |RFBORRA aAlfa;

     |MENAV "0000Se ha actualizado el fondo web en su equipo, vuelva a entrar";
     |PTEC 806;
|FPRC;

|PROGRAMA;
     |SI nDebugando = 1; #0#0 = "AveriguaINI";    |PINTA #0#0; |FINSI;
     |HAZ AveriguaINI;

     aUsuario = Usuario % 810;

     |SI nDebugando = 1; #0#0 = "autodspi";       |PINTA #0#0; |FINSI;
     |SUB_EJECUTA "autodspi";

     |SI nDebugando = 1; #0#0 = "ActDefault";     |PINTA #0#0; |FINSI;
     |HAZ ActDefault;

     |SI nDebugando = 1; #0#0 = "ControlFonto";   |PINTA #0#0; |FINSI;
     |HAZ ControlFondo;

     |SI nDebugando = 1; #0#0 = "LeeAgitoolIni";  |PINTA #0#0; |FINSI;
     |HAZ LeeAgitoolIni;

     |SI nDebugando = 1; #0#0 = "ControlAcceso";  |PINTA #0#0; |FINSI;
     |SI nErrorEje = 0;
          |HAZ ControlAcceso;
     |FINSI;

     |SI nDebugando = 1; #0#0 = "ControlCaducidad";    |PINTA #0#0; |FINSI;
     |SI nErrorCad = 0;
          |HAZ ControlCaducidad;
     |FINSI;

     |SI nDebugando = 1; #0#0 = "EjeDsParcli";    |PINTA #0#0; |FINSI;
     |HAZ EjeDsParcli;

     |SI nDebugando = 1; #0#0 = "webfondos";      |PINTA #0#0; |FINSI;
     |HAZ WebFondos;

     |SI nDebugando = 1; #0#0 = "Programar tareas";   |PINTA #0#0; |FINSI;
     |SUB_EJECUTA "protarea";
|FPRO;
