          Procesar, ProcesarTitulos

|FICHEROS;
     dsexcsv0 #0;
     dsexcsv1 #1,MANTE;
     dsexcsv4 #4;
     principal@;
     actual@;
     referen@;
     refere1@;
     refere2@;
     refere3@;
     refere4@;
     refere5@;
     refere6@;
     refere7@;
     refere8@;
     refere9@;
     refere10@;
     refere11@;
     refere12@;
     refere13@;
     refere14@;
     refere15@;
     refere16@;
     refere17@;
     refere18@;
     refere19@;
     refere20@;
|FIN;

|VARIABLES;
     aDesde = "";
     aHasta = "";
     aRelleno = "";
     aCampos = "";
     aD1 = "";
     aD2 = "";
     aD3 = "";
     aD4 = "";
     aD5 = "";
     aD6 = "";
     aD7 = "";
     aD8 = "";
     aD9 = "";
     aD10 = "";
     aD11 = "";
     aD12 = "";
     aD13 = "";
     aD14 = "";
     aD15 = "";
     aD16 = "";
     aH1 = "";
     aH2 = "";
     aH3 = "";
     aH4 = "";
     aH5 = "";
     aH6 = "";
     aH7 = "";
     aH8 = "";
     aH9 = "";
     aH10 = "";
     aH11 = "";
     aH12 = "";
     aH13 = "";
     aH14 = "";
     aH15 = "";
     aH16 = "";
     nNume = 0;
     aLon1 = "";
     aLon2 = "";
 {50}Valor = "";
     aSepara = ";";
     aFin = "";
     aH200 = "";
     aD200 = "";
     aLon = "";
     aCampo = "";
     aAlfa = "";
     aMas = "";
     nPos = 0;
     nError = 0;
     nMas = 0;
     aPath = "";
     aApli = "";
     aDef = "";
     aFic = "";
     nHandle = 0;
     aTitulo = "";
     aNombre = "";
     aEmp = "";
     aDat = "";
     aValor = "";
     nCampo = 0;
     aNum = "";
     aClave = "";
     i = 0;
     aRela = "";
     aCamClave = "";
     aCamRela = "";
     nCamClave = 0;
     nCamRela = 0;
     aDato = "";
     aCar = "";
     nSwOk = 0;
     nConta = 0;
     nReg = 0;
     aTipo = "";

     nNumero = 0;
     nDNumero = 0;
     nHNumero = 0;
     fFecha = @;
     fDFecha = @;
     fHFecha = @;
     aDAlfa = "";
     aHAlfa = "";
|FIN;

|PROCESO Punto2Coma;
     aAlfa = "";
     aLon =  aValor % A0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aCar = aValor % nPos;
          |SI aCar = ".";
               aCar = ",";
          |FINSI;
          aAlfa = aAlfa + aCar;
     |SIGUE;
     aValor = aAlfa;
|FPRC;

|PROCESO QuitaRarosExp;
     |QBF aValor;
     aLon = aValor % A0;
     aDato = "";
     |PARA i = 0; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = (i + 1) * 100 + 1;
          aCar = aValor % nPos;
          |SI aCar = "¥"; aCar = &209; |FINSI;
          |SI aCar = "¤"; aCar = &241; |FINSI;
          |SI aCar = " "; aCar = &225; |FINSI;
          |SI aCar = "‚"; aCar = &233; |FINSI;
          |SI aCar = "¡"; aCar = &237; |FINSI;
          |SI aCar = "¢"; aCar = &243; |FINSI;
          |SI aCar = "£"; aCar = &250; |FINSI;
          |SI aCar = "§"; aCar = &176; |FINSI;
          |SI aCar = "¦"; aCar = &170; |FINSI;
          |SI aCar = "°"; aCar = &176; |FINSI;  ||Euro

          |SI aCar = ";" aCar = ","; |FINSI;    ||el ; para el csv

          aDato = aDato + aCar;
     |SIGUE;
     aValor = aDato;
|FPRC;

|PROCESO GrabaValor;
     IValor = Valor1<-;
     |PARA i = 0; |SI i [ nConta; |HACIENDO i = i + 1;
          |SI nSwOk = 0;
               aAlfa = Valor;
               |XGRABA nHandle, aAlfa;
          |FINSI;
          Valor = "";
          IValor = IValor + 1;
     |SIGUE;
|FPRC;

|PROCESO Lineas;
     aCampo = #4#1; |QBF aCampo;
     aLon = aCampo % A0;
     |SI aLon = 3;
          nCampo = aCampo;
          aValor = #principal@#nCampo#;
     |SINO;
          |REFERENCIA_DEF actual@, #principal@;

          |PARA; |SI aLon > 3; |HACIENDO;
               aMas = aCampo % 108;
               aNum = aCampo % 903;     || n§ campos relacion
               |HAZ Referencia;
               aAlfa = "|K000";
               aAlfa = #referen@#aAlfa#;
               aClave = aAlfa % 103;    || n§ campos clave
               |SI aNum ! aClave; || los campos relaci¢n debe ser igual a los de la clave
                    aAlfa = "0000Relacion incorrecta:" + aCampo; |QBF aAlfa;
                    |MENAV aAlfa;
                    nError = 1;
                    |SAL;
               |SINO;
                    |DDEFECTO #referen@;
                    aClave = aAlfa % 4;
                    aRela = aCampo % 12;
                    |PARA i = 0; |SI i < aNum; |HACIENDO i = i + 1;
                         nPos = i * 300 + 103;
                         aCamClave = aClave % nPos; nCamClave = aCamClave;
                         aCamRela = aRela % nPos; nCamRela = aCamRela - 1;
                         #referen@#nCamClave# = #actual@#nCamRela#;
                    |SIGUE;
                    |LEE 000#referen@.=;

                    aAlfa = aCampo - "|";
                    nPos = FSalida;
                    nPos = ((nPos - 1) / 100) + 1;
                    aCampo = aCampo % nPos;
                    aLon = aCampo % A0;

                    |SI aLon = 3;
                         nCampo = aCampo;
                         aValor = #referen@#nCampo#;
                    |SINO;
                         |REFERENCIA_DEF actual@, #referen@;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;

     |SI #4#4 = "*";
          |SI #4#5 = "N";
               nNumero = aValor;
               nDNumero = #4#7;
               nHNumero = #4#8;
               |SI nNumero < nDNumero; |O nNumero > nHNumero;
                    nSwOk = 1;
               |FINSI;
          |FINSI;
          |SI #4#5 = "F";
               fFecha = aValor;
               fDFecha = #4#7;
               fHFecha = #4#8;
               |SI fFecha < fDFecha; |O fFecha > fHFecha;
                    nSwOk = 1;
               |FINSI;
          |FINSI;
          |SI #4#5 = "A";
               nPos = #4#6 + 100;
               aDAlfa = #4#7 % nPos;
               aHAlfa = #4#8 % nPos;
               |SI aValor < aDAlfa; |O aValor > aHAlfa;
                    nSwOk = 1;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nSwOk = 1;
          |ERROR10;
     |SINO;
          |SI #4#3 = "*";
               |SI #4#5 = "A"; |HAZ QuitaRarosExp; |FINSI;
               |SI #4#5 = "N"; |HAZ Punto2Coma; |FINSI;
               aAlfa = aValor; |QBF aAlfa;
               aValor = aAlfa + aSepara;
               aLon1 = aValor % A0;
               aLon2 = Valor % A0;
               nNume = aLon1 + aLon2;
               |SI nNume > 250;
                    nConta = nConta + 1;
                    IValor = IValor + 1;
                    Valor = aValor;
               |SINO;
                    Valor = Valor + aValor;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Lineas;
     #4#1;
     ;
     #0#0, aD200;
     #0#0, aH200;
     ;
     NULL, Lineas;
|FIN;

|PROCESO LinBucle;
     nSwOk = 0;
     nConta = 0;
     IValor = Valor1<-;
     |BUCLE Lineas;
     |SI nError ! 0; |ERROR10; |ACABA; |FINSI;
     |HAZ GrabaValor;
     |SI nSwOk = 0;
          |XGRABA nHandle, aFin;
          nReg = nReg + 1;
          |PINTA 2304, nReg;
     |FINSI;
|FPRC;

|DEFBUCLE B1;
     #principal@#1001;
     ;
     aD1;
     aH1;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B2;
     #principal@#1002;
     ;
     aD1, aD2;
     aH1, aH2;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B3;
     #principal@#1003;
     ;
     aD1, aD2, aD3;
     aH1, aH2, aH3;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B4;
     #principal@#1004;
     ;
     aD1, aD2, aD3, aD4;
     aH1, aH2, aH3, aH4;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B5;
     #principal@#1005;
     ;
     aD1, aD2, aD3, aD4, aD5;
     aH1, aH2, aH3, aH4, aH5;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B6;
     #principal@#1006;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6;
     aH1, aH2, aH3, aH4, aH5, aH6;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B7;
     #principal@#1007;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6, aD7;
     aH1, aH2, aH3, aH4, aH5, aH6, aH7;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B8;
     #principal@#1008;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6, aD7, aD8;
     aH1, aH2, aH3, aH4, aH5, aH6, aH7, aH8;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B9;
     #principal@#1009;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6, aD7, aD8, aD9;
     aH1, aH2, aH3, aH4, aH5, aH6, aH7, aH8, aH9;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B10;
     #principal@#1010;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6, aD7, aD8, aD9, aD10;
     aH1, aH2, aH3, aH4, aH5, aH6, aH7, aH8, aH9, aH10;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B11;
     #principal@#1011;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6, aD7, aD8, aD9, aD10, aD11;
     aH1, aH2, aH3, aH4, aH5, aH6, aH7, aH8, aH9, aH10, aH11;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B12;
     #principal@#1012;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6, aD7, aD8, aD9, aD10, aD11, aD12;
     aH1, aH2, aH3, aH4, aH5, aH6, aH7, aH8, aH9, aH10, aH11, aH12;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B13;
     #principal@#1013;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6, aD7, aD8, aD9, aD10, aD11, aD12, aD13;
     aH1, aH2, aH3, aH4, aH5, aH6, aH7, aH8, aH9, aH10, aH11, aH12, aH13;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B14;
     #principal@#1014;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6, aD7, aD8, aD9, aD10, aD11, aD12, aD13, aD14;
     aH1, aH2, aH3, aH4, aH5, aH6, aH7, aH8, aH9, aH10, aH11, aH12, aH13, aH14;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B15;
     #principal@#1015;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6, aD7, aD8, aD9, aD10, aD11, aD12, aD13, aD14, aD15;
     aH1, aH2, aH3, aH4, aH5, aH6, aH7, aH8, aH9, aH10, aH11, aH12, aH13, aH14, aH15;
     ;
     NULL, LinBucle;
|FIN;
|DEFBUCLE B16;
     #principal@#1016;
     ;
     aD1, aD2, aD3, aD4, aD5, aD6, aD7, aD8, aD9, aD10, aD11, aD12, aD13, aD14, aD15, aD16;
     aH1, aH2, aH3, aH4, aH5, aH6, aH7, aH8, aH9, aH10, aH11, aH12, aH13, aH14, aH15, aH16;
     ;
     NULL, LinBucle;
|FIN;

|PROCESO AcotaDefbucle;
     |ABRE #4;
     aAlfa = "|K" + (("000" + nNume) % -103);
     aAlfa = #principal@#aAlfa#;
     aCampos = aAlfa % 103;
     aAlfa = aAlfa % 4;
     |PARA i = 1; |SI i [ aCampos; |HACIENDO i = i + 1;
          aCampo = aAlfa % 103;
          aAlfa = aAlfa % 4;
          |DDEFECTO #4;
          #4#0 = #0#0;
          #4#1 = aCampo;
          |LEE 000#4=;
          |SI FSalida = 0;
               aDesde = #4#7; |QBF aDesde;
               aHasta = #4#8; |QBF aHasta;
               |SI #4#5 = "A";
                    aRelleno = " " * #4#6;
                    aDesde = aDesde + aRelleno;
                    aHasta = aHasta + aRelleno;
                    nPos = 100 + #4#6;
                    aDesde = aDesde % nPos;
                    aHasta = aHasta % nPos;
               |FINSI;
               |SI i = 1; aD1 = aDesde; aH1 = aHasta; |FINSI;
               |SI i = 2; aD2 = aDesde; aH2 = aHasta; |FINSI;
               |SI i = 3; aD3 = aDesde; aH3 = aHasta; |FINSI;
               |SI i = 4; aD4 = aDesde; aH4 = aHasta; |FINSI;
               |SI i = 5; aD5 = aDesde; aH5 = aHasta; |FINSI;
               |SI i = 6; aD6 = aDesde; aH6 = aHasta; |FINSI;
               |SI i = 7; aD7 = aDesde; aH7 = aHasta; |FINSI;
               |SI i = 8; aD8 = aDesde; aH8 = aHasta; |FINSI;
               |SI i = 9; aD9 = aDesde; aH9 = aHasta; |FINSI;
               |SI i = 10; aD10 = aDesde; aH10 = aHasta; |FINSI;
               |SI i = 11; aD11 = aDesde; aH11 = aHasta; |FINSI;
               |SI i = 12; aD12 = aDesde; aH12 = aHasta; |FINSI;
               |SI i = 13; aD13 = aDesde; aH13 = aHasta; |FINSI;
               |SI i = 14; aD14 = aDesde; aH14 = aHasta; |FINSI;
               |SI i = 15; aD15 = aDesde; aH15 = aHasta; |FINSI;
               |SI i = 16; aD16 = aDesde; aH16 = aHasta; |FINSI;
          |SINO;
               |MENAV "0000Error en seleccion, borre el registro y vuelva a crearlo...";
          |FINSI;
     |SIGUE;
     |CIERRA #4;
|FPRC;

|PROCESO Referencia;
     #1#0 = aMas;
     |LEE 020#1=;
     |SI #1#2 = 1; |REFERENCIA_DEF referen@, #refere1@; |FINSI;
     |SI #1#2 = 2; |REFERENCIA_DEF referen@, #refere2@; |FINSI;
     |SI #1#2 = 3; |REFERENCIA_DEF referen@, #refere3@; |FINSI;
     |SI #1#2 = 4; |REFERENCIA_DEF referen@, #refere4@; |FINSI;
     |SI #1#2 = 5; |REFERENCIA_DEF referen@, #refere5@; |FINSI;
     |SI #1#2 = 6; |REFERENCIA_DEF referen@, #refere6@; |FINSI;
     |SI #1#2 = 7; |REFERENCIA_DEF referen@, #refere7@; |FINSI;
     |SI #1#2 = 8; |REFERENCIA_DEF referen@, #refere8@; |FINSI;
     |SI #1#2 = 9; |REFERENCIA_DEF referen@, #refere9@; |FINSI;
     |SI #1#2 = 10; |REFERENCIA_DEF referen@, #refere10@; |FINSI;
     |SI #1#2 = 11; |REFERENCIA_DEF referen@, #refere11@; |FINSI;
     |SI #1#2 = 12; |REFERENCIA_DEF referen@, #refere12@; |FINSI;
     |SI #1#2 = 13; |REFERENCIA_DEF referen@, #refere13@; |FINSI;
     |SI #1#2 = 14; |REFERENCIA_DEF referen@, #refere14@; |FINSI;
     |SI #1#2 = 15; |REFERENCIA_DEF referen@, #refere15@; |FINSI;
     |SI #1#2 = 16; |REFERENCIA_DEF referen@, #refere16@; |FINSI;
     |SI #1#2 = 17; |REFERENCIA_DEF referen@, #refere17@; |FINSI;
     |SI #1#2 = 18; |REFERENCIA_DEF referen@, #refere18@; |FINSI;
     |SI #1#2 = 19; |REFERENCIA_DEF referen@, #refere19@; |FINSI;
     |SI #1#2 = 20; |REFERENCIA_DEF referen@, #refere20@; |FINSI;
|FPRC;

|PROCESO Cabecera;
     |SI #4#3 = "*";
          aTitulo = #4#2; |QBF aTitulo;
          aAlfa = aTitulo + aSepara;
          |XGRABA nHandle, aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE Cabecera;
     #4#1;
     ;
     #0#0, aD200;
     #0#0, aH200;
     ;
     NULL, Cabecera;
|FIN;

|PROCESO CargaDef;
     nMas = nMas + 1;
     |SI nMas > 20;
          nError = 1;
          |MENAV "0000Superado limite .mas";
          |ERROR10; |ACABA;
     |FINSI;

     #1#2 = nMas;
     |GRABA 020#1a;

     aMas = #1#0; |QBF aMas;
     aPath = #0#2; |QBF aPath;
     aApli = #0#1; |QBF aApli;
     aDef = aPath + "/" + aApli + "/def/" + aMas; |QBF aDef;
     |SI #1#2 = 1; |CARGA_DEF aDef, refere1@; |FINSI;
     |SI #1#2 = 2; |CARGA_DEF aDef, refere2@; |FINSI;
     |SI #1#2 = 3; |CARGA_DEF aDef, refere3@; |FINSI;
     |SI #1#2 = 4; |CARGA_DEF aDef, refere4@; |FINSI;
     |SI #1#2 = 5; |CARGA_DEF aDef, refere5@; |FINSI;
     |SI #1#2 = 6; |CARGA_DEF aDef, refere6@; |FINSI;
     |SI #1#2 = 7; |CARGA_DEF aDef, refere7@; |FINSI;
     |SI #1#2 = 8; |CARGA_DEF aDef, refere8@; |FINSI;
     |SI #1#2 = 9; |CARGA_DEF aDef, refere9@; |FINSI;
     |SI #1#2 = 10; |CARGA_DEF aDef, refere10@; |FINSI;
     |SI #1#2 = 11; |CARGA_DEF aDef, refere11@; |FINSI;
     |SI #1#2 = 12; |CARGA_DEF aDef, refere12@; |FINSI;
     |SI #1#2 = 13; |CARGA_DEF aDef, refere13@; |FINSI;
     |SI #1#2 = 14; |CARGA_DEF aDef, refere14@; |FINSI;
     |SI #1#2 = 15; |CARGA_DEF aDef, refere15@; |FINSI;
     |SI #1#2 = 16; |CARGA_DEF aDef, refere16@; |FINSI;
     |SI #1#2 = 17; |CARGA_DEF aDef, refere17@; |FINSI;
     |SI #1#2 = 18; |CARGA_DEF aDef, refere18@; |FINSI;
     |SI #1#2 = 19; |CARGA_DEF aDef, refere19@; |FINSI;
     |SI #1#2 = 20; |CARGA_DEF aDef, refere20@; |FINSI;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar " + aDef;
          |MENAV aAlfa;
     |SINO;
          aEmp = #0#3; |QBF aEmp;
          |SI aEmp = "";
              aDat = aPath + aApli + "/fich/";
          |SINO;
               aDat = aPath + aApli + "/fich/" + aEmp + "/";
          |FINSI;
          |SI #1#2 = 1; |PATH_DAT #refere1@#aDat#; |ABRE #refere1@; |FINSI;
          |SI #1#2 = 2; |PATH_DAT #refere2@#aDat#; |ABRE #refere2@; |FINSI;
          |SI #1#2 = 3; |PATH_DAT #refere3@#aDat#; |ABRE #refere3@; |FINSI;
          |SI #1#2 = 4; |PATH_DAT #refere4@#aDat#; |ABRE #refere4@; |FINSI;
          |SI #1#2 = 5; |PATH_DAT #refere5@#aDat#; |ABRE #refere5@; |FINSI;
          |SI #1#2 = 6; |PATH_DAT #refere6@#aDat#; |ABRE #refere6@; |FINSI;
          |SI #1#2 = 7; |PATH_DAT #refere7@#aDat#; |ABRE #refere7@; |FINSI;
          |SI #1#2 = 8; |PATH_DAT #refere8@#aDat#; |ABRE #refere8@; |FINSI;
          |SI #1#2 = 9; |PATH_DAT #refere9@#aDat#; |ABRE #refere9@; |FINSI;
          |SI #1#2 = 10; |PATH_DAT #refere10@#aDat#; |ABRE #refere10@; |FINSI;
          |SI #1#2 = 11; |PATH_DAT #refere11@#aDat#; |ABRE #refere11@; |FINSI;
          |SI #1#2 = 12; |PATH_DAT #refere12@#aDat#; |ABRE #refere12@; |FINSI;
          |SI #1#2 = 13; |PATH_DAT #refere13@#aDat#; |ABRE #refere13@; |FINSI;
          |SI #1#2 = 14; |PATH_DAT #refere14@#aDat#; |ABRE #refere14@; |FINSI;
          |SI #1#2 = 15; |PATH_DAT #refere15@#aDat#; |ABRE #refere15@; |FINSI;
          |SI #1#2 = 16; |PATH_DAT #refere16@#aDat#; |ABRE #refere16@; |FINSI;
          |SI #1#2 = 17; |PATH_DAT #refere17@#aDat#; |ABRE #refere17@; |FINSI;
          |SI #1#2 = 18; |PATH_DAT #refere18@#aDat#; |ABRE #refere18@; |FINSI;
          |SI #1#2 = 19; |PATH_DAT #refere19@#aDat#; |ABRE #refere19@; |FINSI;
          |SI #1#2 = 20; |PATH_DAT #refere20@#aDat#; |ABRE #refere20@; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE CargaDef;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CargaDef;
|FIN;

|PROCESO DescargaDef;
     |SI #1#2 = 1; |CIERRA #refere1@; |DESCARGA_DEF #refere1@; |FINSI;
     |SI #1#2 = 2; |CIERRA #refere2@; |DESCARGA_DEF #refere2@; |FINSI;
     |SI #1#2 = 3; |CIERRA #refere3@; |DESCARGA_DEF #refere3@; |FINSI;
     |SI #1#2 = 4; |CIERRA #refere4@; |DESCARGA_DEF #refere4@; |FINSI;
     |SI #1#2 = 5; |CIERRA #refere5@; |DESCARGA_DEF #refere5@; |FINSI;
     |SI #1#2 = 6; |CIERRA #refere6@; |DESCARGA_DEF #refere6@; |FINSI;
     |SI #1#2 = 7; |CIERRA #refere7@; |DESCARGA_DEF #refere7@; |FINSI;
     |SI #1#2 = 8; |CIERRA #refere8@; |DESCARGA_DEF #refere8@; |FINSI;
     |SI #1#2 = 9; |CIERRA #refere9@; |DESCARGA_DEF #refere9@; |FINSI;
     |SI #1#2 = 10; |CIERRA #refere10@; |DESCARGA_DEF #refere10@; |FINSI;
     |SI #1#2 = 11; |CIERRA #refere11@; |DESCARGA_DEF #refere11@; |FINSI;
     |SI #1#2 = 12; |CIERRA #refere12@; |DESCARGA_DEF #refere12@; |FINSI;
     |SI #1#2 = 13; |CIERRA #refere13@; |DESCARGA_DEF #refere13@; |FINSI;
     |SI #1#2 = 14; |CIERRA #refere14@; |DESCARGA_DEF #refere14@; |FINSI;
     |SI #1#2 = 15; |CIERRA #refere15@; |DESCARGA_DEF #refere15@; |FINSI;
     |SI #1#2 = 16; |CIERRA #refere16@; |DESCARGA_DEF #refere16@; |FINSI;
     |SI #1#2 = 17; |CIERRA #refere17@; |DESCARGA_DEF #refere17@; |FINSI;
     |SI #1#2 = 18; |CIERRA #refere18@; |DESCARGA_DEF #refere18@; |FINSI;
     |SI #1#2 = 19; |CIERRA #refere19@; |DESCARGA_DEF #refere19@; |FINSI;
     |SI #1#2 = 20; |CIERRA #refere20@; |DESCARGA_DEF #refere20@; |FINSI;
|FPRC;

|DEFBUCLE DescargaDef;
     #1#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, DescargaDef;
|FIN;

|PROCESO CargaMas;
     aCampo = #4#1; |QBF aCampo;
     aLon = aCampo % A0;
     |PARA; |SI aLon > 3; |HACIENDO;
          aMas = aCampo % 108;
          #1#0 = aMas;
          |GRABA 000#1n;

          aAlfa = aCampo - "|";
          nPos = FSalida;
          nPos = ((nPos - 1) / 100) + 1;
          aCampo = aCampo % nPos;
          aLon = aCampo % A0;
     |SIGUE;
|FPRC;

|DEFBUCLE CargaMas;
     #4#1;
     ;
     #0#0, aD200;
     #0#0, aH200;
     ;
     NULL, CargaMas;
|FIN;

|PROCESO Procesar;
     aFin = &13; aFin = aFin + &10

     aD200 = " " * 200;
     aH200 = "z" * 200;

     |DELINDEX #1;

     |ABRE #1;
     |BUCLE CargaMas;
     |CIERRA #1;

     nMas = 0; |BUCLE CargaDef;
     |SI nError ! 0; |ACABA; |FINSI;

     aMas = #0#5; |QBF aMas;
     aPath = #0#2; |QBF aPath;
     aApli = #0#1; |QBF aApli;
     aDef = aPath + "/" + aApli + "/def/" + aMas; |QBF aDef;
     |CARGA_DEF aDef, principal@;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar principal:" + aMas;
          |MENAV aAlfa;
     |SINO;
          aEmp = #0#3; |QBF aEmp;
          |SI aEmp = "";
              aDat = aPath + aApli + "/fich/";
          |SINO;
               aDat = aPath + aApli + "/fich/" + aEmp + "/";
          |FINSI;
          |PATH_DAT #principal@#aDat#;

          aFic = #0#6; |QBF aFic;
          |XABRE "WCB", aFic, nHandle;
          |SI FSalida ] 0;
               |ABRE #1;
               |BUCLE Cabecera;
               |XGRABA nHandle, aFin;

               nReg = 0;
               |SI #0#7 = 0;  || Sin clave
                    |ABRE #principal@;
                    |LEE 000#principal@.];
                    |PARA; |SI FSalida = 0; |HACIENDO;
                         |HAZ LinBucle;
                         |LEE 000#principal@.s;
                    |SIGUE;
                    |CIERRA #principal@;
               |SINO;    || Con clave
                    |HAZ AcotaDefbucle;
                    |SI aCampos = 1; |BUCLE B1; |FINSI;
                    |SI aCampos = 2; |BUCLE B2; |FINSI;
                    |SI aCampos = 3; |BUCLE B3; |FINSI;
                    |SI aCampos = 4; |BUCLE B4; |FINSI;
                    |SI aCampos = 5; |BUCLE B5; |FINSI;
                    |SI aCampos = 6; |BUCLE B6; |FINSI;
                    |SI aCampos = 7; |BUCLE B7; |FINSI;
                    |SI aCampos = 8; |BUCLE B8; |FINSI;
                    |SI aCampos = 9; |BUCLE B9; |FINSI;
                    |SI aCampos = 10; |BUCLE B10; |FINSI;
                    |SI aCampos = 11; |BUCLE B11; |FINSI;
                    |SI aCampos = 12; |BUCLE B12; |FINSI;
                    |SI aCampos = 13; |BUCLE B13; |FINSI;
                    |SI aCampos = 14; |BUCLE B14; |FINSI;
                    |SI aCampos = 15; |BUCLE B15; |FINSI;
                    |SI aCampos = 16; |BUCLE B16; |FINSI;
               |FINSI;
               |CIERRA #1;

               |XCIERRA nHandle;
          |FINSI;
          |DESCARGA_DEF #principal@;

          aAlfa  = "cmd " + &34 + "/c START /WAIT " + aFic + &34;
          |RSYSTEM aAlfa
     |FINSI;

     |BUCLE DescargaDef;
|FPRC;
-------------------------------------------------------------------
|PROCESO Titulos;
     aCampo = #4#1; |QBF aCampo;
     aLon = aCampo % A0;
     |SI aLon = 3;
          aMas = #0#5;
          |REFERENCIA_DEF referen@, #principal@;
     |SINO;
          |PARA; |SI aLon > 3; |HACIENDO;
               aMas = aCampo % 108;

               aAlfa = aCampo - "|";
               nPos = FSalida;
               nPos = ((nPos - 1) / 100) + 1;
               aCampo = aCampo % nPos;
               aLon = aCampo % A0;
          |SIGUE;
          |HAZ Referencia;
     |FINSI;
     aAlfa = "|TITULO";
     aTitulo = #referen@#aAlfa#;
     aAlfa = "|C" + aCampo + "NOMBRE";
     aNombre = #referen@#aAlfa#;

     aAlfa = #4#2; |QBF aAlfa;
     |SI aAlfa = "";
          aAlfa = aNombre + "|" + aTitulo;
          #4#2 = aAlfa;
     |FINSI;

     aAlfa = "|C" + aCampo + "TIPO";
     aTipo = #referen@#aAlfa#;
     #4#5 = aTipo;

     aAlfa = "|C" + aCampo + "LONGITUD";
     aLon = #referen@#aAlfa#;
     #4#6 = aLon;

     |GRABA 020#4a;
|FPRC;

|DEFBUCLE Titulos;
     #4#1;
     ;
     #0#0, aD200;
     #0#0, aH200;
     be;
     NULL, Titulos;
|FIN;

|PROCESO ProcesarTitulos;
     aD200 = " " * 200;
     aH200 = "z" * 200;

     |DELINDEX #1;

     |ABRE #1;
     |BUCLE CargaMas;
     |CIERRA #1;

     nMas = 0; |BUCLE CargaDef;
     |SI nError ! 0; |ACABA; |FINSI;

     aMas = #0#5; |QBF aMas;
     aPath = #0#2; |QBF aPath;
     aApli = #0#1; |QBF aApli;
     aDef = aPath + "/" + aApli + "/def/" + aMas; |QBF aDef;
     |CARGA_DEF aDef, principal@;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar principal:" + aMas;
          |MENAV aAlfa;
     |SINO;
          aEmp = #0#3; |QBF aEmp;
          |SI aEmp = "";
              aDat = aPath + aApli + "/fich/";
          |SINO;
               aDat = aPath + aApli + "/fich/" + aEmp + "/";
          |FINSI;
          |PATH_DAT #principal@#aDat#;

          |ABRE #1;
          |BUCLE Titulos;
          |CIERRA #1;
     |FINSI;

     |BUCLE DescargaDef;
|FPRC;
