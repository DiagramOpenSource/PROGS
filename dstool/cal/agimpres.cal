
|INCLUYE agiutili;  || Rutinas comunes a Etiquetas,Mailings e impresoras

|FICHEROS;
     agimpres #0;
     impresor  #1;
|FIN;

|VARIABLES;
     nbuf_imp       = 0;
     nlin_imp       = 0;
     nhasta         = 0;
     nbuenas        = 0;
     nlin_ini       = 0;
     nlin_fin       = 0;
     nlin_bue       = 0;
     nsalto_lin     = 0;
     nnueva         = 0;
     anueva         = "";
     modo           = 0;
     nerror         = 0;
     acortar        = "";
     ncortar        = 0;
     adigito        = "";
     ncampo         = 0;
     nascii         = 0;
     nconte         = 0;
     nada = "";
     traba = "";
     trab1 = "";
     trab2 = "";
     trab3 = "";
     nume = 0;
     num1 = 0;
     num2 = 0;
     x = 0;
     y = 0;
     xx = 0;
     sw_viejo = 0;

     mi_defecto = 0;

{-1}_menu = "";
    _menu1 = "0";
    _menu2 = "1";
    _menu3 = "5";
    _menu4 = "Texto 80 columnas tipo IBM";
    _menu5 = "Texto 132 columnas tipo IBM";
    _menu6 = "Laser o Chorro de Tinta tipo HP";
    _menu7 = "Windows";
    _menu8 = "Excel";
|FIN;

|PROCESO mayor;
  #0Campo = #0Campo > " ";
  |PINTA #0Campo;
|FPRC;

|| *********************** BAJA DE IMPRESORAS **********************
|| Borra el fichero *.prn
|PROCESO borra_impre;
      anom_fich = amodi_nom;
      |HAZ compon_fich;
      |FBORRA afich_imp;
      |SI FSalida ! 0;
            amensaje = "0000No se ha podido borrar " + afich_imp;
            |MENAV amensaje;
      |FINSI;
|FPRC;

|PROCESO baja_impre;
     nborrar = 0;
     |CONFI "2400NConfirmar Baja ";
     |SI FSalida = 0;
           |HAZ borra_impre;
           || Dar de baja el fichero *.prn
           nborrar = 1;
     |FINSI;
|FPRC;

|PROCESO menu_def_impre;
     |PUSHV 501 2480;
     |MENUG _menu;
     mi_defecto = FSalida;
     |POPV;
|FPRC;

|| *********************** ALTA DE ETIQUETAS **********************
|PROCESO alta_impre;
     || Se presentan en pantalla los valores por defecto
     || y despues de Endatos es correcto envio una orden
     || para insertar una nueva

  |PINPA #0#0;
  |DDEFECTO #0;
  |DDEFECTO #1;
  ||HAZ cambiaasci;
  |CAMPO_MODIFICA #0#0 ,1,"S";    || Nombre
  |CAMPO_MODIFICA #0#14,1,"S";    || Titulo menu

     || Lo pongo aqui, ya que me interesa que pase por "existe_ya" solo en
     || este punto y con ENCAMPO FEntrada no actua
  modo= 1;
  |ENCAMPO #0#0;
  |ENCAMPO #14#0;
  modo = 0;
  |CAMPO_MODIFICA #0#0  ,1,"N";    || Nombre
  |CAMPO_MODIFICA #0#14 ,1,"N";    || Titulo menu

  |HAZ menu_def_impre;
  |SI mi_defecto = 2;
     #agimpres#2 = 132;
     |VETE continua;
  |FINSI;
  |SI mi_defecto = 3;
     #agimpres#3 = "";
     #agimpres#4 = "";
     #agimpres#5 = "";
     #agimpres#6 = "\27\(s16.66H";
     #agimpres#7 = "\27\(s10.00H";
     #agimpres#8 = "\27\(s3B";
     #agimpres#9 = "\27\(s0B";
     #agimpres#10 = "\27\(s05.00H";
     #agimpres#11 = "\27\(s10.00H";
     #agimpres#12 = "";
     |VETE continua;
  |FINSI;
  |SI mi_defecto = 4;
     #agimpres#1 = "*dslaser";
     #agimpres#3 = "10#10#1#0#1#\10\";
     #agimpres#4 = "";
     #agimpres#5 = "#FIN#\10\";
     #agimpres#6 = "\139\";
     #agimpres#7 = "\140\";
     #agimpres#8 = "\141\";
     #agimpres#9 = "\142\";
     #agimpres#10 = "\143\";
     #agimpres#11 = "\144\";
     #agimpres#12 = "";
     |VETE continua;
  |FINSI;
  |SI mi_defecto = 5;
     #agimpres#1 = "{agixl97.dll}";
     #agimpres#2 = "250";
     #agimpres#3 = ",,solo datos";
     #agimpres#4 = "";
     #agimpres#5 = "";
     #agimpres#6 = "";
     #agimpres#7 = "";
     #agimpres#8 = "";
     #agimpres#9 = "";
     #agimpres#10 = "";
     #agimpres#11 = "";
     #agimpres#12 = "";
     #agimpres#13 = "99";
     #agimpres#15 = "N";
     |VETE continua;
  |FINSI;
|ET continua;
  |PINDA #0#0;
  |ENDATOS #1#0;
  nnueva = 0;
  |SI FSalida = 0;
      #1#0 = #0#0;
      anom_fich = #1#0;
      |HAZ compon_fich;

      |DIMENSIONA 206,nbuf_imp,0;
      |HAZ pasaanume;
      |HAZ carga_datos;
          |GRABASECUENCIAL afich_imp,nbuf_imp,0,206;
          |FINDIM nbuf_imp;

          |SI FSalida ! 0;
               amensaje = "0000No se ha podido grabar en " + afich_imp;
               |MENAV amensaje;
          |SINO;
               || Le envio el nombre y el titulo para que se incluya en imp.d
               amodi_nom = #1#0;
               amodi_tit = #1#204;
               nnueva =1;     || Ahora si que damos de alta en imp.d
          |FINSI;

     |FINSI;
|FPRC;



|| *********************** CARGA AL SECUENCIAL-COMUN ***********************

|PROCESO buenas_2;
  |SI sw_viejo = 0;
      nlin_fin = nlin_ini + nsalto_lin;
      nbuenas = 0;
      |PARA j = nlin_ini;|SI j [ nlin_fin;|HACIENDO j = j+1;
            nada = #1j;
            |QBF nada;
            |SI nada = "";    || Se ha acabado
                j = nlin_fin;          || Salgo
            |SINO;
                nbuenas = nbuenas + 1;
            |FINSI;
      |SIGUE;
  |SINO;
      nlin_fin = nlin_ini + nsalto_lin;
      nbuenas = 0;
      |PARA j = nlin_ini;|SI j [ nlin_fin;|HACIENDO j = j+1;
            nada = #1j;
            |QBF nada;
            |SI nada = "0";    || Se ha acabado
                #1j = "   ";
                j = nlin_fin;          || Salgo
            |SINO;
                nbuenas = nbuenas + 1;
            |FINSI;
      |SIGUE;
  |FINSI;
|FPRC;

|| Por cada secuencia, explorar cuantos son buenas, para guardarlo al final
|| del secuencial.
|PROCESO buenas;
 || Comprimido, negrita, expandido
   nlin_ini = 3
   || Por cada linea de control
   |PARA i = 194;|SI i [ 199;|HACIENDO i = i +1;
         nsalto_lin = 14;
         |HAZ buenas_2;
         atmp = nbuenas;
         |AL_BUF nbuf_imp,i,atmp;
         #1i = nbuenas;
         nlin_ini = nlin_ini + 15;             || Salta los bloques de 15 lineas por
   |SIGUE;

 || Salto de pagina, Otro caracter
   || Estan en medio el numero de lineas y el extendido de inicializacion
   || y finalizacion
   nlin_ini = 164;
   |PARA i = 202;|SI i [ 203;|HACIENDO i = i +1;
         nsalto_lin = 14;
         |HAZ buenas_2;
         atmp = nbuenas;
         |AL_BUF nbuf_imp,i,atmp;
         #1i = nbuenas;
         nlin_ini = nlin_ini + 15;             || Salta los bloques de 15 lineas por
   |SIGUE;

 || Inicializacion. Son 35 y esta en dos trozos
   nlin_ini = 93;
   nsalto_lin = 14;
   |HAZ buenas_2;
   #1#200 = 0;
   #1#200 = nbuenas;

   nlin_ini = 124;
   nsalto_lin = 20;
   |HAZ buenas_2;
   #1#200 = #1#200+nbuenas;
   atmp = #1#200;
  |AL_BUF nbuf_imp,200,atmp;

 || Finalizacion. Son 35 y esta en dos trozos
   nlin_ini = 108;
   nsalto_lin = 14;
   |HAZ buenas_2;
   #1#201 = 0;
   #1#201 = nbuenas;

   ||nlin_ini = 124;
   nlin_ini = 144;
   nsalto_lin = 20;
   |HAZ buenas_2;
   #1#201 = #1#201+nbuenas;
   atmp = #1#201;
  |AL_BUF nbuf_imp,201,atmp;
|FPRC;

|| Carga sobre el secuencial segun lo modificado
|PROCESO carga_datos;
     |HAZ buenas;

     |PARA i = 0;|SI i [ 203;|HACIENDO i = i+1;
          atmp = #1i;
          |SI atmp = "   ";
              atmp = "0";
          |FINSI;
          |AL_BUF nbuf_imp,i,atmp;
     |SIGUE;
     atmp = #1#205;
     |AL_BUF nbuf_imp,204,atmp;
     atmp = #1#206;
     |AL_BUF nbuf_imp,205,atmp;
|FPRC;

|| *********************** MODIFICACION DE ETIQUETAS **********************

|| Relleno de 999 todos aquellos que no tienen nada teniendo en cuenta la
|| informacion que hay en las lineas del 195 al 204 (Posicion en buffer
|| 194-203) que nos indican cuantas lineas de un bloque de 15 son buenas.
|| Esto lo hago para poder informar en un momento dado el caracter 0.
||RAFA
|PROCESO pon_999_2;
         nlin_fin = nlin_ini + nsalto_lin;
         nlin_bue = nlin_ini + nbuenas;        || Hasta esa son buenas
         |SI nlin_bue [ nlin_fin;
             |PARA j = nlin_bue;|SI j [ nlin_fin;|HACIENDO j = j+1;
                   #1j = "   ";
             |SIGUE;
        |FINSI;
|FPRC;


|PROCESO pon_999;

 || Comprimido, negrita, expandido
   nlin_ini = 3
   || Por cada linea de control
   |PARA i = 194;|SI i [ 199;|HACIENDO i = i +1;
         |DEL_BUF nbuf_imp,i,atmp;
         nbuenas = atmp;
         nsalto_lin = 14;
         |HAZ pon_999_2;
         nlin_ini = nlin_ini + 15;             || Salta los bloques de 15 lineas por
   |SIGUE;

 || Salto de pagina, Otro caracter
   || Estan en medio el numero de lineas y el extendido de inicializacion
   || y finalizacion
   nlin_ini = 164;
   |PARA i = 202;|SI i [ 203;|HACIENDO i = i +1;
         |DEL_BUF nbuf_imp,i,atmp;
         nbuenas = atmp;
         nsalto_lin = 14;
         |HAZ pon_999_2;
         nlin_ini = nlin_ini + 15;             || Salta los bloques de 15 lineas por
   |SIGUE;

 || Inicializacion. Son 35 y esta en dos trozos
   |DEL_BUF nbuf_imp,200,atmp;
   nbuenas = atmp;
   nlin_ini = 93;
   nsalto_lin = 14;
   |HAZ pon_999_2

   |SI nbuenas > 15;             || Si hay 2 trozos otra pasada
        nbuenas = nbuenas-15;    || Le quito las 15 que ya hemos contado
   |SINO;
        nbuenas = 0;
   |FINSI;
   nlin_ini = 124;
   nsalto_lin = 19;
   |HAZ pon_999_2

 || Finalizacion. Son 35 y esta en dos trozos
   |DEL_BUF nbuf_imp,201,atmp;
   nbuenas = atmp;
   nlin_ini = 108;
   nsalto_lin = 14;
   |HAZ pon_999_2

   |SI nbuenas > 15;             || Si hay 2 trozos otra pasada
        nbuenas = nbuenas-15;    || Le quito las 15 que ya hemos contado
   |SINO;
        nbuenas =0;
   |FINSI;
   nlin_ini = 144;
   nsalto_lin = 19;
   |HAZ pon_999_2;

|FPRC;

|| Lee datos del secuencial y lo pone en fichero temporal de pantalla
|PROCESO lee_datos;
  nhasta = nlin_imp -1;
  |PARA i =0; |SI i [ nhasta;|HACIENDO i = i+1;
        |DEL_BUF nbuf_imp,i,atmp;
        #1i = atmp;
  |SIGUE;
  #1#206 = #1#205;
  #1#205 = #1#204;
  |SI nhasta > 204;  |ACABA;   |FINSI;
  |SI nhasta > 123;  i = 193;  |FINSI;
  |SI nhasta > 202;  i = 204;  |FINSI;
  nlin_imp = 206;
  |PARA xx = i;  |SI xx [ 206;  |HACIENDO xx = xx + 1;
        #1xx = "0";
        atmp = "0";
        |AL_BUF nbuf_imp,xx,atmp;
  |SIGUE;
  nlin_imp = 206;
  sw_viejo = 1;
  |HAZ buenas;
|FPRC;


|PROCESO modi_impre;
      anom_fich = amodi_nom;
      |HAZ compon_fich;

      |LEESECUENCIAL afich_imp,nbuf_imp,nlin_imp,0,206;
      |SI nbuf_imp ] 0;
            |HAZ lee_datos;
            |SI nlin_imp > 193;
                |HAZ pon_999;
            |FINSI;
            |HAZ cambiaasci;
            sw_viejo = 0;
            |PINPA #0#0;
            |PINDA #0#0;
            |ENDATOS #2#0;
            |SI FSalida = 0;
                 |HAZ pasaanume;
                 |HAZ carga_datos;
                 |GRABASECUENCIAL afich_imp,nbuf_imp,0,nlin_imp;
            |FINSI;
            |FINDIM nbuf_imp;
      |SINO;
            amensaje = "0000No se puede abrir el fichero " + afich_imp;
            |MENAV amensaje;
      |FINSI;
|FPRC;


|| *************************** BUCLE PRINCIPAL *******************************
|PROGRAMA;
|ABRE #1;
  afich = "dev/imp/imp.d";

|| Bucle principal
  nsalir = 0;
  |PARA;|SI nsalir = 0;|HACIENDO;
|| Alta
        |SI nmodo = 1;
            |HAZ alta_impre;
            |SI nnueva = 1;
                nmenug_modo = 1;
            |SINO;
                nmenug_modo = 0;   || No hago nada con el *.d
            |FINSI;
        |FINSI;

|| Modificacion
        |SI nmodo = 2;
            |HAZ modi_impre;
            nmenug_modo = 2;
        |FINSI;

|| Baja
        |SI nmodo = 3;
            |HAZ baja_impre;
            |SI nborrar = 1;
                nmenug_modo = 3;
            |SINO;
                nmenug_modo = 0;   || Si hemos dicho que NO es Correcto
                                   || no tocamos el *.d
            |FINSI;
        |FINSI;

        |SI nmodo ] 1;
            |HAZ actualiza_sec;    ||  Agiutil.cal
        |FINSI;

        acabeza= "Definicion de impresoras";
       |HAZ menus;        || Agiutili.cal
  |SIGUE;
  |CIERRA #1;
|FPRO;

|| ************************** VALIDACIONES **********************************
|| Controla que se introduzcan solo numeros y ademas comprendidos entre
|| 0 y 255. El campo es un alfa por limpieza de pantalla cuando este blanco
|| teniendo que pueden ponerme 0 y ser validos
|PROCESO validacion;
     atmp = "";
     nerror = 0;
     |PARA i = 1;|SI i [3;|HACIENDO i = i+1;
          ncortar = (i*100)+1;
          acortar = ncortar;
          adigito = #1#Campo# % acortar;
          |SI adigito ! " ";
              nascii = &adigito;
              |SI nascii < 48;|O nascii > 57;
                 amensaje = "0000Debe introducir solo numeros ";
                 |MENAV amensaje;
                 nerror = 1;
                 |ERROR;
               |FINSI;
          |FINSI;
     |SIGUE;

     |SI nerror = 0;
         nconte = #1#Campo#;
         |SI nconte < 0;|O nconte > 255
               amensaje = "0000Introduzca un numero ASCII entre 0-255 o en Blanco";
               |MENAV amensaje;
               nerror = 1;
               |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|| No permito que lo deje en blanco, ya que sera el nombre del fichero *.prn
|| y podria hacer destrozos.Ademas quito todos los blancos.
|PROCESO no_blanco;
    #1#0 = #0#0;
    anueva = #1#0;
    |QBT anueva;
    |SI anueva = "";
         amensaje= "0000No puede dejarlo en blanco";
         |MENAV amensaje;
         |ERROR;
    |SINO;
         || Por si habia dejado espacios en blanco
         #1#0 = anueva;
         |PINTA #1#0;
         adigito = #1#0 % "101";
         |SI adigito ] "0";|Y adigito [ "9";
             amensaje= "0000No puede empezar por un numero";
             |MENAV amensaje;
             |ERROR;
         |SINO;
             |HAZ existe_ya;
         |FINSI;
    |FINSI;
    || Se podria afinar mas siguiendo las reglas de nombres de MSDOS.
|FPRC;

|| Compruebo que no exista ya la impresora;
|PROCESO existe_ya;
   |SI modo = 1;    || Viene de la linea anterior al encampo
      anueva = #1#0;
      anom_fich = anueva;
      |HAZ compon_fich;

      |LEESECUENCIAL afich_imp,nbuf_imp,nlin_imp,0,0;
      |SI nbuf_imp ] 0;
            |FINDIM nbuf_imp;
            amensaje = "0000La impresora ya existe";
            |MENAV amensaje;
            |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|| No dejo que me salga con Ctrl+c en el nombre en blanco sino al ser un
|| encampo se iria al siguiente y me desmonta
|PROCESO no_ctrlc;|TIPO 11;
     amensaje= "0000No puede dejarlo en blanco";
     |MENAV amensaje;
     |ERROR;
|FPRC;

|PROCESO cambiaasci;
  #0#0 =  #1#0;
  #0#1 =  #1#1;
  #0#2 =  #1#2;
  #0#13 = #1#123;
  #0#14 = amodi_tit;
  |SI #1#205 = "0";
       #0#15 = "S";
  |SINO;
       #0#15 = "N";
  |FINSI;
  |SI #1#206 = "0";
      #0#16 = "N";
  |SINO;
      #0#16 = "S";
  |FINSI;
||comprimido
  traba = "";
  |PARA x = 3; |SI x [ 17;  |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  #0#6 = traba;
  traba = "";
  |PARA x = 18; |SI x [ 32; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  #0#7 = traba
||negrilla
  traba = "";
  |PARA x = 33; |SI x [ 47; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  #0#8 = traba;
  traba = "";
  |PARA x = 48; |SI x [ 62; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  #0#9 = traba;
||EXPANDIDO
  traba = "";
  |PARA x = 63; |SI x [ 77; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  #0#10 = traba;
  traba = "";
  |PARA x = 78; |SI x [ 92; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  #0#11 = traba;
||INICIALIZACION
  traba = "";
  |PARA x = 93; |SI x [ 107; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  |PARA x = 124; |SI x [ 143; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  #0#3 = traba;
||FINALIZACION
  traba = "";
  |PARA x = 108; |SI x [ 122; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  |PARA x = 144; |SI x [ 163; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  #0#4 = traba;
||SALTO
  traba = "";
  |PARA x = 164; |SI x [ 178; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  #0#5 = traba;
  traba = "";
  |PARA x = 179; |SI x [ 193; |HACIENDO x = x + 1;
        trab1 = #1#x#;
        |HAZ asciletra;
        traba = traba + trab2;
  |SIGUE;
  #0#12 = traba;
|FPRC;

|PROCESO asciletra;
  trab2 = "";
  |QBF trab1;
  |SI trab1 = "";
      |ACABA;
  |FINSI;
  nume  = trab1;
  |SI nume = 92;
      trab2 = "\\";
  |SINO;
      |SI nume ] 33;  |Y nume [ 125;
          trab2 = &nume;
      |SINO;
          trab2 = "\" + nume + "\";
      |FINSI;
  |FINSI;
|FPRC;


|PROCESO pasaanume;
  |DDEFECTO #1;
  #1#0 = #0#0;
  #1#1 = #0#1;
  #1#2 = #0#2;
  |SI #0#15 = "S";
      #1#205 = "0";
  |SINO;
      #1#205 = "1";
  |FINSI;
  |SI #0#16 = "N";
      #1#206 = "0";
  |SINO;
      #1#206 = "1";
  |FINSI;
||COMPRIMIDA_#0#6
  y = 3;
  traba = #0#6;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu1;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
  |SIGUE;
|ET pasaanu1;
  y = 18;
  traba = #0#7;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu2;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
  |SIGUE;
|ET pasaanu2;
||NEGRITA
  y = 33;
  traba = #0#8;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu3;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
  |SIGUE;
|ET pasaanu3;
  y = 48;
  traba = #0#9;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu4;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
  |SIGUE;
|ET pasaanu4;
||EXPANDIDO
  y = 63;
  traba = #0#10;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu5;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
  |SIGUE;
|ET pasaanu5;
  y = 78;
  traba = #0#11;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu6;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
  |SIGUE;
|ET pasaanu6;
||INICIO
  y = 93;
  traba = #0#3;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu7;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
        |SI y = 108;
            y = 124;
       |FINSI;
  |SIGUE;
|ET pasaanu7;
||FINALIZACION
  y = 108;
  traba = #0#4;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu8;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
        |SI y = 123;
            y = 145;
       |FINSI;
  |SIGUE;
|ET pasaanu8;
||NUMERO DE LINEAS
#1#123 = #0#13;
||SALTO
  y = 164;
  traba = #0#5;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu9;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
  |SIGUE;
|ET pasaanu9;
||SALTO
  y = 164;
  traba = #0#5;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu10;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
  |SIGUE;
|ET pasaanu10;
||OTRO CARACTER
  y = 179;
  traba = #0#12;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  |SI nume = 0;
      |VETE pasaanu11;
  |FINSI;
  |PARA x = 1; |SI x [ nume;  |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        |SI trab1 = "\";
            |HAZ secescape;
            trab2 = trab1;
        |SINO;
            num1 = &trab1;
            trab2 = num1;
        |FINSI;
        #1#y# = trab2;
        y = y + 1;
  |SIGUE;
|ET pasaanu11;
#1#204 = #0#14;
amodi_tit = #1#204;
|FPRC;

|PROCESO secescape;
  trab3 = "";
  x = x + 1;
  num1 = (100 * x) + 1;
  trab2 = num1;
  trab1 = traba % trab2;
  |SI trab1 = "\";
      trab1 = "92";
      |ACABA;
  |FINSI;
  trab3 = trab3 + trab1;
  x = x + 1;
  num1 = (100 * x) + 1;
  trab2 = num1;
  trab1 = traba % trab2;
  |SI trab1 = "\";
      trab1 = trab3;
      |ACABA;
  |FINSI;
  trab3 = trab3 + trab1;
  x = x + 1;
  num1 = (100 * x) + 1;
  trab2 =  num1;
  trab1 = traba % trab2;
  |SI trab1 = "\";
      trab1 = trab3;
      |ACABA;
  |FINSI;
  trab3 = trab3 + trab1;
  x = x + 1;
  trab1 = trab3;
|FPRC;


|PROCESO comprueba;
  traba = #0Campo;
  |QBF traba;
  trab1 = traba % 0;
  nume = trab1;
  y = 0;
  |PARA x = 1;  |SI x [ nume; |HACIENDO x = x + 1;
        num1 = (100 *  x) + 1;
        trab2 = num1;
        trab1 = traba % trab2;
        num2 = 0;
        |SI trab1 = "\";
            |HAZ escapes;
        |FINSI;
        |SI num2 ! 0;
            |MENAV "     N£mero incongruente en secuencias de ESCAPE";
            |ERROR;
            |SAL;
        |FINSI;
        y = y + 1;
  |SIGUE;
  |SI Campo = 3;  |O Campo = 4;
      |SI y > 35;
          |MENAV "      El Campo tiene m s de 35 caracteres definidos";
          |ERROR;
      |FINSI;
  |SINO;
      |SI y > 15;
          |MENAV "      El Campo tiene m s de 15 caracteres definidos";
          |ERROR;
      |FINSI;
  |FINSI;
|FPRC;


|PROCESO escapes;
  trab3 = "":
  x = x + 1;
  num1 = (100 * x) + 1;
  trab2 = num1;
  trab1 = traba % trab2;
  |SI trab1 = "\";
      |ACABA;
  |FINSI;
  |SI trab1 < "0";  |O trab1 > "9";
      num2 = 1;
      |ACABA;
  |FINSI;
  trab3 = trab1;
  x = x + 1;
  num1 = (100 * x) + 1;
  trab2 = num1;
  trab1 = traba % trab2;
  |SI trab1 = "\";
      |ACABA;
  |FINSI;
  |SI trab1 < "0";  |O trab1 > "9";
      num2 = 1;
      |ACABA;
  |FINSI;
  trab3 = trab3 + trab1;
  x = x + 1;
  num1 = (100 * x) + 1;
  trab2 =  num1;
  trab1 = traba % trab2;
  |SI trab1 = "\";
      |ACABA;
  |FINSI;
  |SI trab1 < "0";  |O trab1 > "9";
      num2 = 1;
      |ACABA;
  |FINSI;
  trab3 = trab3 + trab1;
  x = x + 1;
  num1 = (100 * x) + 1;
  trab2 =  num1;
  trab1 = traba % trab2;
  |SI trab1 ! "\";
      |ACABA;
  |FINSI;
  |SI trab3 > "255";
      num2 = 1;
  |FINSI;
|FPRC;
