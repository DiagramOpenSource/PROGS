|FICHEROS;
     dspedido #0;

     agifa104@ #12;      ||Pedidos
     expor104@ #62;      ||Pedidos
     agifa073@ #13;      ||Lineas de Pedidos
     expor073@ #63;      ||Lineas de Pedidos

     agifa081@ #23;      ||Pedidos Compras
     expor081@ #73;      ||Pedidos Compras
     agifa067@ #24;      ||Lineas Pedidos Compras
     expor067@ #74;      ||Lineas Pedidos Compras

     dsm00005@ #4;       || Vertical
     expord05@ #5;       ||
|FIN;

|VARIABLES;
     aMensa    = "";
     codigo    = "";
     adj       = 0;
     nNume     = 0;
     i         = 0;
     swErr     = 0;
     aPath     = "";

     nVertical = 14;
     nTope073  = 52;
     nTope104  = 54;
     nTope081  = 43;
     nTope067  = 49;

     aTip      = "";
     aSer      = "";
     nNum      = 0;
     nLin      = 0;
     aAlfa     = "";

     aDef     = "";
     aDef1    = "";
     aDef2    = "";
     aDef3    = "";
     aDef4    = "";
     aDef5    = "";
     aDef6    = "";
     aDef7    = "";
     aDef8    = "";
     aDef9    = "";
     aDef0    = "";
|FIN;

|PROCESO PathDat;
     |DBASS aPath;
     aPath = aPath + "dscomer8/fich/";
     aPath = aPath + (("00" + #0#1) % -102) + "/";
     |PATH_DAT #12 aPath;
     |PATH_DAT #13 aPath;
     |PATH_DAT #23 aPath;
     |PATH_DAT #24 aPath;
     |PATH_DAT #4  aPath;

     ||DELINDEX #12;
     ||DELINDEX #13;
     ||DELINDEX #23;
     ||DELINDEX #24;
     ||DELINDEX #4;

     |DBASS aPath;
     aPath = aPath + "dscomer8/fich/";
     aPath = aPath + (("00" + #0#0) % -102) + "/";
     |PATH_DAT #62 aPath;
     |PATH_DAT #63 aPath;
     |PATH_DAT #73 aPath;
     |PATH_DAT #74 aPath;
     |PATH_DAT #5 aPath;
|FPRC;

|PROCESO CargaDef;
     |DBASS aPath;
     aPath = aPath + "dscomer8/";

     aDef1 = aPath + "def/" + "agifa104"; aDef  = aDef1;
     |CARGA_DEF aDef, expor104@;
     |SI FSalida ! 0;
          swErr = 1; aDef1 = ""; |ACABA;
     |FINSI;
     aDef2 = aPath + "def/" + "agifa073"; aDef  = aDef2;
     |CARGA_DEF aDef, expor073@;
     |SI FSalida ! 0;
          swErr = 1; aDef2 = ""; |ACABA;
     |FINSI;

     aDef3 = aPath + "def/" + "agifa081"; aDef  = aDef3;
     |CARGA_DEF aDef, expor081@;
     |SI FSalida ! 0;
          swErr = 1; aDef3 = ""; |ACABA;
     |FINSI;
     aDef4 = aPath + "def/" + "agifa067"; aDef  = aDef4;
     |CARGA_DEF aDef, expor067@;
     |SI FSalida ! 0;
          swErr = 1; aDef4 = ""; |ACABA;
     |FINSI;

     aDef5 = aPath + "def/" + "dsm00005"; aDef  = aDef5;
     |CARGA_DEF aDef, expord05@;
     |SI FSalida ! 0;
          swErr = 1; aDef5 = ""; |ACABA;
     |FINSI;

     aDef6 = aPath + "def/" + "agifa104"; aDef  = aDef6;
     |CARGA_DEF aDef, agifa104@;
     |SI FSalida ! 0;
          swErr = 1; aDef6 = ""; |ACABA;
     |FINSI;
     aDef7 = aPath + "def/" + "agifa073"; aDef  = aDef7;
     |CARGA_DEF aDef, agifa073@;
     |SI FSalida ! 0;
          swErr = 1; aDef7 = ""; |ACABA;
     |FINSI;

     aDef8 = aPath + "def/" + "agifa081"; aDef  = aDef8;
     |CARGA_DEF aDef, agifa081@;
     |SI FSalida ! 0;
          swErr = 1; aDef8 = ""; |ACABA;
     |FINSI;
     aDef9 = aPath + "def/" + "agifa067"; aDef  = aDef9;
     |CARGA_DEF aDef, agifa067@;
     |SI FSalida ! 0;
          swErr = 1; aDef9 = ""; |ACABA;
     |FINSI;

     aDef0 = aPath + "def/" + "dsm00005"; aDef  = aDef0;
     |CARGA_DEF aDef, dsm00005@;
     |SI FSalida ! 0;
          swErr = 1; aDef0 = ""; |ACABA;
     |FINSI;
|FPRC;

|PROCESO DesCargaDef;
     |SI aDef0 ! ""; |DESCARGA_DEF #dsm00005@; |FINSI;
     |SI aDef9 ! ""; |DESCARGA_DEF #agifa067@; |FINSI;
     |SI aDef8 ! ""; |DESCARGA_DEF #agifa081@; |FINSI;
     |SI aDef7 ! ""; |DESCARGA_DEF #agifa073@; |FINSI;
     |SI aDef6 ! ""; |DESCARGA_DEF #agifa104@; |FINSI;

     |SI aDef5 ! ""; |DESCARGA_DEF #expord05@; |FINSI;
     |SI aDef4 ! ""; |DESCARGA_DEF #expor067@; |FINSI;
     |SI aDef3 ! ""; |DESCARGA_DEF #expor081@; |FINSI;
     |SI aDef2 ! ""; |DESCARGA_DEF #expor073@; |FINSI;
     |SI aDef1 ! ""; |DESCARGA_DEF #expor104@; |FINSI;
|FPRC;

|PROCESO GrabaVertical;
     |PARA i = 0; |SI i [ nVertical; |HACIENDO i = i + 1;
          #4i = #5i;
     |SIGUE;
     |GRABA 000#4n;
|FPRC;

|DEFBUCLE GrabaVertical;
     #5#1005;
     ;
     aTip, aSer, nNum, nLin, "      ";
     aTip, aSer, nNum, nLin, "zzzzzz";
     ;
     NULL, GrabaVertical;
|FIN;
||======================== BORRADO PEDIDOS COMPRAS =========================
|PROCESO linpcom;
     |PARA i = 0; |SI i [ nTope067; |HACIENDO i = i + 1;
          #24i = #74i;
     |SIGUE;
     |GRABA 000#24n;
     |LIBERA #24;
     aTip = "PC";
     aSer = #24#28;
     nNum = #24#0;
     nLin = #24#1;
     |BUCLE GrabaVertical;
|FPRC;

|DEFBUCLE linpcom;
     #74#1003;
     ;
     #73#25, #73#0, 000;
     #73#25, #73#0, 999;
     ;
     NULL, linpcom;
|FIN;

|PROCESO mirapcom;
     nNume = #74#5 - #74#38;
     |SI nNume ! 0 ;
          adj = "N";
          |ERROR;
     |FINSI;
|FPRC;

|DEFBUCLE mirapcom;
     #74#1003;
     ;
     #73#25, #73#0, 000;
     #73#25, #73#0, 999;
     ;
     NULL, mirapcom;
|FIN;

|PROCESO cabpcom;
     |SI #73#1 ] #0#3; |Y #73#1 [ #0#4;
        ||  |SI #0#16 = "S";
               adj = "S";
               |BUCLE mirapcom;
               |SI adj = "S";
                    |ERROR;
                    |ACABA;
               |FINSI;
        ||  |SINO;
        ||       |ERROR;
        ||       |ACABA;
        ||  |FINSI;
     |FINSI;
     |PINTA 2145 , #73#0;
     |PARA i = 0; |SI i [ nTope081; |HACIENDO i = i + 1;
          #23i = #73i;
     |SIGUE;
     |GRABA 000#23n;
     |LIBERA #23;
     |BUCLE linpcom;
|FPRC;

|DEFBUCLE borrapcomp;
#73#1002;
;
"     " ,      0;
"zzzzz" , 999999;
e;
NULL , cabpcom;
|FIN;

||=========================== BORRADO DE PEDIDOS ===========================
|PROCESO linpedi;
     |PARA i = 0; |SI i [ nTope073; |HACIENDO i= i + 1;
          #13i = #63i;
     |SIGUE;
     |GRABA 000#13n;
     |LIBERA #13;
     aTip = "PV";
     aSer = #13#28;
     nNum = #13#0;
     nLin = #13#1;
     |BUCLE GrabaVertical;
|FPRC;

|DEFBUCLE linpedi;
     #63#1003;
     ;
     #62#25, #62#0, 000;
     #62#25, #62#0, 999;
     ;
     NULL, linpedi;
|FIN;

|PROCESO miralinpe;      ||miro si el pedido esta por adjudicar
     nNume = #63#5 - #63#43;
     |SI nNume ! 0;
          adj = "N";
          |ERROR;
     |FINSI;
|FPRC;

|DEFBUCLE miralinpe;
     #63#1003;
     ;
     #62#25, #62#0, 000;
     #62#25, #62#0, 999;
     ;
     NULL, miralinpe;
|FIN;

|PROCESO cabpedi;
     |SI #62#1 ] #0#3; |Y #62#1 [ #0#4;
       ||   |SI #0#5 = "S";
               adj = "S";
               |BUCLE miralinpe;
               |SI adj = "S";      ||Si todas las lineas estan adjudicadas
                    |ERROR;        ||no lo copio
                    |ACABA;
               |FINSI;
      ||    |SINO;
      ||         |ERROR;             ||Si no quiere mantener los pedidos
      ||         |ACABA;             ||Tampoco los copio
      ||    |FINSI;
     |FINSI;
     codigo = #62#25 + "/" + #62#0;
     |PINTA 2145 , codigo;
     |PARA i = 0; |SI i [ nTope104; |HACIENDO i = i + 1;
          #12i = #62i;
     |SIGUE;
     |GRABA 000#12n;
     |LIBERA #12;
     |BUCLE linpedi;
|FPRC;

|DEFBUCLE borrpedi;
#62#1002;
;
"     " ,       0;
"zzzzz" ,  999999;
e;
NULL , cabpedi;
|FIN;

|PROCESO Inicio; |TIPO 3;
     |SI #0#2 = "NO";    |ACABA;   |FINSI;

     |HAZ CargaDef;
     |SI swErr ! 0;
          aMensa = "0000Error al cargar:" + aDef;
          |MENAV aMensa;
          |HAZ DesCargaDef;
          |ACABA;
     |FINSI;
     |HAZ PathDat;

     |ABRE #4;
     |ABRE #5;

     |PINTA 2113 , "Pedidos Ventas ";
     |ABRE #12;
     |ABRE #13;
     |BUCLE borrpedi;
     |CIERRA #13;
     |CIERRA #12;


     |PINTA 2113 , "Pedidos Compras";
     |ABRE #23;
     |ABRE #24;
     |BUCLE borrapcomp;
     |CIERRA #23;
     |CIERRA #24;

     |CIERRA #4;
     |CIERRA #5;

     |HAZ DesCargaDef;

     |MENAV "0000Ejecute Recalculo de Maestros en la empresa destino...";
|FPRC;
