|FICHEROS;
    agiaudii #0;
    agiaudi1 #1;    || agiaudif (formato 1)
|FIN;

|VARIABLES;
     &eaHora = "";
     aAlfa = "";

    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;
    dbase = "";
    inkey = 0;

    d_fecha = 0;
    h_fecha = 0;
    nfich = "";
    origen = "";
    destin = "";
    borra = 0;
    operacion = "";
    formato = 1;
    gua_regis = 0;
    gua_fecha = @;
    sw_coloca = 0;
|FIN;

|PROCESO Impre;
     |SI #1#6 = 0;  || Quita operaciones 0 menos SERVIDOR OFF
          aAlfa = #1#9;
          aAlfa = aAlfa - "SERVIDOR OFF";
          |SI FSalida [ 0;
               |ACABA;
          |FINSI;
     |FINSI;

     eaHora = (#1#2 % 102) + ":" + (#1#2 % 302) + ":" + (#1#2 % 502);

     |PRINT;
|FPRC;

|DEFBUCLE Impre;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impre;
|FIN;

|PROCESO Impresion;
     |ABRE #1;
     |LEE 000#1p;
     |SI FSalida = 0;
          Impresora = "CrystalReport";
          |IMPRE -1;
          |SI FSalida = 0;
               |SI #0#6 = "S";
                    |INFOR "agiaudia";
               |SINO;
                    |INFOR "agiaudii";
               |FINSI;
               |SI FSalida = 0;
                    |BUCLE Impre;
                    |PIEINF;
                    |FININF;
               |SINO;
                    |SI #0#6 = "S";
                         |MENAV "0000Error en informe 'agiaudia'...";
                    |SINO;
                         |MENAV "0000Error en informe 'agiaudii'...";
                    |FINSI;
               |FINSI;
               |FINIMP;
          |FINSI;
     |SINO;
         |MENAV "0000Seleccion vacia...";
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO sel1;
    borra = 0;

|SI #0#2 > #1#3;    borra = 1;     |FINSI;   || desde usuario
|SI #0#3 < #1#3;    borra = 1;     |FINSI;   || hasta usuario
|SI #0#4 > #1#7;    borra = 1;     |FINSI;   || desde aplicacion
|SI #0#5 < #1#7;    borra = 1;     |FINSI;   || hasta aplicacion

|SI borra = 1;
    |BORRA 020#1a;
|FINSI;
|LIBERA #1;
|FPRC;


|DEFBUCLE sel;
 #1#1;
 ;
 #0#0,       0;
 #0#1, 9999999;
 be;
 NULL, sel1;
|FIN;

|PROCESO seleccion;
|SI #0#2 ! "          ";|O #0#3 ! "zzzzzzzzzz";|O #0#4 ! "        ";
                                               |O #0#5 ! "zzzzzzzz";

    |ATRI R;  alfa1 = "    Seleccionando ...";   |MENSA alfa1;  |ATRI 0;
    |BUCLE sel;
    |ATRI R;  |BLIN 4;  |ATRI 0;

|FINSI;
|FPRC;

|PROCESO recarga;
    d_fecha = #0#0;
    h_fecha = #0#1;
|PARA para1 = d_fecha; |SI para1 [ h_fecha; |HACIENDO para1 = para1 + 1;
        fech1 = para1;
        alfa1 = fech1;
        nfich = (alfa1 % -104) + (alfa1 % 402) + (alfa1 % 102) + ".dat";

        origen = dbase + "logs/" + nfich;

    |ATRI R;
        alfa1 = "    Cargando: " + origen;
    |MENSA alfa1;
    |ATRI 0;

    |AFEGIR_FICHERO origen, destin;
|SIGUE;
|ATRI R;  |BLIN 4;  |ATRI 0;

|ABRE #1;      || para que reindexe
|CIERRA #1;
|FPRC;

|PROCESO temporal_destino;
|DIRECTORIO dbase;
    nfich = Usuario;     |QBT nfich;
    nfich = (nfich + "zzzzzzzz") % 107;

|NOME_DAT #1 nfich;

|DFICE destin;
    destin = destin + nfich + ".dat";
|FPRC;

|PROCESO tipo3; |TIPO 3;
|HAZ temporal_destino;

|DELINDEX #1;

|HAZ recarga;
|HAZ seleccion;
|HAZ Impresion;

|DELINDEX #1;
|FPRC;
