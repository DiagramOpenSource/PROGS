|FICHEROS;
    agiaudit #0;
    agiaudi1 #1;    || agiaudif (formato 1)
    agiaudi2 #2;    || agiaudif (formato 2)
|FIN;

|VARIABLES;
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    para1 = 0;
    para2 = 0;
    para3 = 0;
    para4 = 0;
    fech1 = @;
    fech2 = @;
    fech3 = @;
    fech4 = @;
    elsw1 = 0;
    elsw2 = 0;
    elsw3 = 0;
    elsw4 = 0;
    FEstado = 0;
    seleccio = 0;
    modo = 0;
    sw_rup = 0;
    dbase = "";
    inkey = 0;

    d_fecha = 0;
    h_fecha = 0;
    nfich = "";
    origen = "";
    destin = "";
    borra = 0;
    operacion = "";
    formato = 1;
    gua_regis = 0;
    gua_fecha = @;
    sw_coloca = 0;
|FIN;
____________________________________/
|PROCESO tipo13; |TIPO 13;         || pintar mensaje en formato 1
|SI #1#6 = 0;  operacion = "INCIDENCIA GENERICA"; |FINSI;
|SI #1#6 = 1;  operacion = "ENTRADA USUARIO    "; |FINSI;
|SI #1#6 = 2;  operacion = "SALIDA USUARIO     "; |FINSI;
|SI #1#6 = 3;  operacion = "ENTRADA OPCION     "; |FINSI;
|SI #1#6 = 4;  operacion = "SALIDA OPCION      "; |FINSI;

|ATRI I;
|PINTA 2213, operacion;
|ATRI 0;
|FPRC;

|PROCESO tipo11; |TIPO 11;         || cambiar pantalla
    inkey = FSalida;
|SI inkey = 9;           || <F1>
    |SI formato = 2;
            gua_fecha = #2#1;
            gua_regis = #2#0;
            formato = 1;
    |SINO;
            gua_fecha = #1#1;
            gua_regis = #1#0;
            formato = 2;
    |FINSI;
        sw_coloca = 1;
    |PTEC 806;
|FINSI;
|FPRC;

|PROCESO coloca; |TIPO 7;
|SI sw_coloca = 1;
    |SI formato = 1;     #1#0 = gua_regis;   #1#1 = gua_fecha;   |FINSI;
    |SI formato = 2;     #2#0 = gua_regis;   #2#1 = gua_fecha;   |FINSI;
        sw_coloca = 0;
    |PTEC 802;
    |PTEC 802;
|FINSI;
|FPRC;
____________________________________/
|RUTINA min;
    #1#1 = #0#0;
    #1#0 = 0;

    #2#1 = #0#0;
    #2#0 = 0;
|FRUT;

|RUTINA max;
    #1#1 = #0#1;
    #1#0 = 9999999;

    #2#1 = #0#1;
    #2#0 = 9999999;
|FRUT;

|PROCESO edicion;
|ABRE #1;
|LEE 000#1p;
    FEstado = FSalida;
|CIERRA #1;

|SI FEstado = 0;
        inkey = 9;
    |PARA; |SI inkey = 9; |HACIENDO;
        |SI formato = 1;
            |PINPA #0#1;
            |ENTLINEAL #1#1, 2, 4, 20, 0, min, max;
        |FINSI;
        |SI formato = 2;
            |PINPA #0#2;
            |ENTLINEAL #1#2, 2, 4, 22, 0, min, max;
        |FINSI;
    |SIGUE;
|SINO;
    |MENAV "    Seleccion vacia ...";
|FINSI;
|FPRC;

|PROCESO sel1;
    borra = 0;

|SI #0#2 > #1#3;    borra = 1;     |FINSI;   || desde usuario
|SI #0#3 < #1#3;    borra = 1;     |FINSI;   || hasta usuario
|SI #0#4 > #1#7;    borra = 1;     |FINSI;   || desde aplicacion
|SI #0#5 < #1#7;    borra = 1;     |FINSI;   || hasta aplicacion

|SI borra = 1;
    |BORRA 020#1a;
|FINSI;
|LIBERA #1;
|FPRC;


|DEFBUCLE sel;
 #1#1;
 ;
 #0#0,       0;
 #0#1, 9999999;
 be;
 NULL, sel1;
|FIN;

|PROCESO seleccion;
|SI #0#2 ! "          ";|O #0#3 ! "zzzzzzzzzz";|O #0#4 ! "        ";
                                               |O #0#5 ! "zzzzzzzz";

    |ATRI R;  alfa1 = "    Seleccionando ...";   |MENSA alfa1;  |ATRI 0;
    |BUCLE sel;
    |ATRI R;  |BLIN 4;  |ATRI 0;

|FINSI;
|FPRC;

|PROCESO recarga;
    d_fecha = #0#0;
    h_fecha = #0#1;
|PARA para1 = d_fecha; |SI para1 [ h_fecha; |HACIENDO para1 = para1 + 1;
        fech1 = para1;
        alfa1 = fech1;
        nfich = (alfa1 % -104) + (alfa1 % 402) + (alfa1 % 102) + ".dat";

        origen = dbase + "logs/" + nfich;

    |ATRI R;
        alfa1 = "    Cargando: " + origen;
    |MENSA alfa1;
    |ATRI 0;

    |AFEGIR_FICHERO origen, destin;
|SIGUE;
|ATRI R;  |BLIN 4;  |ATRI 0;

|ABRE #1;      || para que reindexe
|CIERRA #1;
|FPRC;

|PROCESO temporal_destino;
|DIRECTORIO dbase;
    nfich = Usuario;     |QBT nfich;
    nfich = (nfich + "zzzzzzzz") % 107;

|NOME_DAT #1 nfich;
|NOME_DAT #2 nfich;

|DFICE destin;
    destin = destin + nfich + ".dat";
|FPRC;

|PROCESO tipo3; |TIPO 3;
|HAZ temporal_destino;

|ABRE #1;
|CIERRA #1;
|DELINDEX #1;

|HAZ recarga;
|HAZ seleccion;
|HAZ edicion;

|ABRE #1;
|CIERRA #1;
|FPRC;
