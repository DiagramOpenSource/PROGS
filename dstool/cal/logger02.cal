|FICHEROS;
     logger02 #0;
     agiaudi1 #1;
     agiaudi2 #2;
|FIN;

|VARIABLES;
     &eaHora = "";
     &eaMin  = "";
     &eaSeg  = "";
     &efFechaHoy = @;

     dbase = "";
     nfich = "";
     destin = "";
     origen = "";
     d_fecha = 0;
     h_fecha = 0;
     para1 = 0;
     fech1 = @;
     alfa1 = "";
|FIN;

|PROCESO sel1;
   |SI #0#0 [ #1#1; |Y #0#1 ] #1#1;
     |SI #0#2 [ #1#3; |Y #0#3 ] #1#3;
          |SI #0#4 [ #1#7; |Y #0#5 ] #1#7;
               |SI #1#6 = 6;
                    eaHora = #1#2 % 102;
                    eaMin  = #1#2 % 302;
                    eaSeg  = #1#2 % 502;
                    |PRINT;
               |FINSI;
          |FINSI;
     |FINSI;
   |FINSI;
|FPRC;


|DEFBUCLE sel;
 #1#1;
 ;
 #0#0,       0;
 #0#1, 9999999;
 be;
 NULL, sel1;
|FIN;

|PROCESO seleccion;
    |ATRI R;  alfa1 = "    Seleccionando ...";   |MENSA alfa1;  |ATRI 0;
    |BUCLE sel;
    |ATRI R;  |BLIN 4;  |ATRI 0;
|FPRC;


|PROCESO temporal_destino;
    |DIRECTORIO dbase;
    nfich = Usuario;     |QBT nfich;
    nfich = (nfich + "zzzzzzzz") % 107;

    |NOME_DAT #1 nfich;
    |NOME_DAT #2 nfich;

    |DFICE destin;
    destin = destin + nfich + ".dat";
|FPRC;

|PROCESO recarga;
    d_fecha = #0#0;
    h_fecha = #0#1;
    |PARA para1 = d_fecha; |SI para1 [ h_fecha; |HACIENDO para1 = para1 + 1;
        fech1 = para1;
        alfa1 = fech1;
        nfich = (alfa1 % -104) + (alfa1 % 402) + (alfa1 % 102) + ".dat";

        origen = dbase + "logs/" + nfich;

        |ATRI R;
        alfa1 = "    Cargando: " + origen;
        |MENSA alfa1;
        |ATRI 0;

        |AFEGIR_FICHERO origen, destin;
    |SIGUE;
    |ATRI R;  |BLIN 4;  |ATRI 0;

    |ABRE #1;      || para que reindexe
    |CIERRA #1;
|FPRC;

|PROCESO Imprime;
     |IMPRE 0;
     |SI FSalida = 0
          |INFOR "logger02";
          |SI FSalida = 0;
               efFechaHoy = ~;
               |HAZ seleccion;
               |PIEINF;
               |FININF;
          |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Accesos Fallidos";
     |PINPA #0#0;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0;  |GRABA 020#0b;  |FINSI;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |GRABA 020#0a;
          |HAZ temporal_destino;

          |ABRE #1;
          |CIERRA #1;
          |DELINDEX #1;

          |HAZ recarga;
          |HAZ Imprime;


     |FINSI;
     |CIERRA #0;
|FPRO;
